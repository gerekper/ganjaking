jQuery(function(d){d.fn.csp_scripts=function(){d(this).sw_select2(),d(this).find(".woocommerce-help-tip, .help_tip, .tips").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200})};var c=d("#restrictions_data"),s=c.find(".bulk_toggle_wrapper"),r=c.find(".wc-metaboxes"),a=c.find(".hr-section--conditions-and.temp-placeholder"),l=r.find(".woocommerce_restriction").length,o=!1;function _(e,t){"yes"===t.val()?(t.val("no"),e.removeClass("woocommerce-input-toggle--enabled").addClass("woocommerce-input-toggle--disabled")):(t.val("yes"),e.removeClass("woocommerce-input-toggle--disabled").addClass("woocommerce-input-toggle--enabled"))}""===wc_restrictions_admin_params.post_id?(c.closest("table.form-table").removeClass("form-table").addClass("restrictions-form-table"),d(".wccsp-delete-restriction-rule").on("click",function(){return window.confirm(wc_restrictions_admin_params.i18n_delete_rule_warning)}),d(".column-wc_actions a").on("mousedown",function(){d(this).triggerHandler("mouseleave")}),c.on("click",".wc-metabox > h3",function(){d(this).parent(".wc-metabox").toggleClass("closed").toggleClass("open"),d(this).next(".wc-metabox-content").stop().slideToggle(300)}),c.sw_select2(),d(".wc-metabox",c).each(function(){var e=d(this),t=e.find(".wc-metabox-content");e.hasClass("closed")&&t.hide()})):c.sw_select2(),c.on("click",".wc-metabox > h3",function(e){e.target.id}).on("click","#active-toggle",function(){var t=d(this),i=t.closest(".wc-metabox").find(".wc-metabox-content > input.enabled"),e=t.closest(".woocommerce_restriction"),o=e.data("restriction_id"),n=e.data("index");if(-1<e[0].className.indexOf("woocommerce_restriction--added"))return _(t,i),!1;t.addClass("woocommerce-input-toggle--loading");o={action:"woocommerce_toggle_restriction",value:i.val(),post_id:wc_restrictions_admin_params.post_id,hash:r.attr("data-hash"),index:n,restriction_id:o,security:wc_restrictions_admin_params.toggle_restriction_nonce};return d.ajax({url:wc_restrictions_admin_params.wc_ajax_url,data:o,method:"POST",dataType:"json",complete:function(){t.removeClass("woocommerce-input-toggle--loading")},success:function(e){0<e.errors.length?window.alert(e.errors.join("\n\n")):(_(t,i),r.attr("data-hash",e.hash))},error:function(){window.alert(wc_restrictions_admin_params.i18n_toggle_session_expired)}}),!1}).on("click",".remove_row",function(e){var t=d(this).closest(".wc-metabox");t.find("*").off(),t.remove(),o=!0,i(),e.preventDefault()}),c.on("keyup","input.short_description",function(){d(this).closest(".woocommerce_restriction").find("h3 .restriction_title_inner").text(d(this).val())}).on("click",".expand_all",function(){return r.find(".wc-metabox").each(function(){var e=d(this);e.find(".wc-metabox-content").show(),e.addClass("open").removeClass("closed")}),!1}).on("click",".close_all",function(){return r.find(".wc-metabox").each(function(){var e=d(this);e.find(".wc-metabox-content").hide(),e.addClass("closed").removeClass("open")}),!1}).on("change","select.csp_shipping_countries, select.csp_billing_countries",function(){var e,i,t=d(this),o=t.hasClass("csp_shipping_countries")?"shipping":"billing",n=(e=t,e=t.selectSW("data"),i=[],d.each(e,function(e,t){i.push({key:t.id,value:t.text})}),i),e=t.closest(".condition_content, .woocommerce_restriction_form"),t="shipping"==o?e.find("select.csp_shipping_states"):e.find("select.csp_billing_states"),e=t.find(":selected"),c=[],s="shipping"==o?wc_restrictions_admin_params.shipping_states_data:wc_restrictions_admin_params.billing_states_data,r=[];e.each(function(){c.push(d(this).val())}),d.each(n,function(e,t){var i=[],o=t.key,n=t.value,t=s[o]||!1;if(!t)return!0;d.each(t,function(e,t){e=o+":"+e;i.push({id:e,text:n+" â€” "+t,selected:-1!==d.inArray(e,c)})}),r.push({text:n,children:i})}),t.children().remove(),t.selectSW({data:r})}).on("click",".wccsp_select_all",function(){var e=d(this).closest(".select-field");return e.find("select option").prop("selected","selected"),e.find("select").trigger("change"),!1}).on("click",".wccsp_select_none",function(){var e=d(this).closest(".select-field");return e.find("select option").prop("selected",!1),e.find("select").trigger("change"),!1}).on("click","button.add_restriction",function(){var i=d("select.restriction_type",c),e=i.val(),t=r.find(".woocommerce_restriction_"+e),o=r.find(".woocommerce_restriction");if(""===e)return wc_restrictions_admin_params.post_id&&i.trigger("focus"),!1;c.block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var n={action:"woocommerce_add_checkout_restriction",post_id:wc_restrictions_admin_params.post_id,index:l,restriction_id:e,applied_count:t.length,count:o.length,security:wc_restrictions_admin_params.add_restriction_nonce};return l++,setTimeout(function(){d.post(wc_restrictions_admin_params.wc_ajax_url,n,function(e){var t;0<e.errors.length?window.alert(e.errors.join("\n\n")):(c.trigger("woocommerce_before_restriction_add",e),r.append(e.markup),(t=r.find(".woocommerce_restriction").last()).csp_scripts(),t.data("conditions_count",0),s.removeClass("disabled")),wc_restrictions_admin_params.post_id&&i.val(""),c.unblock(),c.trigger("woocommerce_restriction_added",e)},"json")},250),!1}).on("woocommerce_before_restriction_add",function(){c.removeClass("restrictions_data--empty")}).on("change","input.show_excluded_in_checkout",function(){var e=d(this),t=e.is(":checked"),e=e.closest(".woocommerce_restriction_data").find(".show-excluded-checked");t?e.show():e.hide()});var e,m={},n={};function p(e,t){var i=!1;return"object"==typeof n[e]&&"function"==typeof n[e][t]?i=n[e][t]:(i=wp.template("wc_csp_restriction_"+e+"_condition_"+t+"_content"),void 0===n[e]&&(n[e]={}),n[e][t]=i),i}function i(){var i=!1;r.find(".woocommerce_restriction").each(function(e,t){d(".position",t).val(e),d(".restriction_title_index",t).html(e+1),i=!0}),i?(s.removeClass("disabled"),c.removeClass("restrictions_data--empty")):(s.addClass("disabled"),c.addClass("restrictions_data--empty")),o&&c.addClass("restrictions_data--removed")}r.find(".woocommerce_restriction").each(function(){var e=d(this).find(".restriction_conditions .condition_row").length;d(this).data("conditions_count",e)}),c.on("mousedown",".condition_remove .trash",function(){d(this).triggerHandler("mouseleave")}).on("click",".condition_remove .trash",function(e){e.preventDefault();e=d(this).closest(".condition_row");return e.next(".hr-section--conditions-and").remove(),e.remove(),!0}).on("change",".condition_modifier select",function(){var e,t,i,n,c,o=d(this),s=o.closest(".condition_row_inner").find(".condition_value"),r=o.data("zero_config_mods"),a=o.hasClass("has_conditional_values");r&&(e=o.val(),t=s.filter(".condition--disabled"),i=s.not(".condition--disabled"),-1<r.indexOf(e)?(t.show(),i.hide()):(t.hide(),i.show())),a&&(n=o.val(),c=o.attr("data-value_input_name"),d.each(s,function(e,t){var i=d(t),o=i.attr("data-modifiers").split(","),t=d.inArray(n,o),o=i.find(".csp_date_time_input");i.hide(),o.attr("name",""),-1!==t&&(o.attr("name",c),i.show())}))}).on("change",".condition_add select.condition_type",function(){var e=d(this),t=e.val();if("add_condition"===t)return!1;var i=e.closest(".woocommerce_restriction"),o=i.data("restriction_id"),n=parseInt(i.data("index")),c=parseInt(i.data("conditions_count")),s=function(e){var t=!1;"function"==typeof m[e]?t=m[e]:(t=wp.template("wc_csp_restriction_"+e+"_condition_row"),m[e]=t);return t}(o),r=i.find(".restriction_conditions_list"),o=p(o,t);if(!s||!o)return!1;n=s({condition_index:c,condition_content:o({restriction_index:n,condition_index:c})});i.data("conditions_count",c+1),r.append(n);i=i.find(".restriction_conditions_list .condition_row").last();return a.clone().removeClass("temp-placeholder").appendTo(r),i.find('.condition_type option[value="'+t+'"]').prop("selected","selected"),i.csp_scripts(),e.find('option[value="add_condition"]').prop("selected","selected"),!1}).on("change",".restriction_conditions_list select.condition_type",function(){var e=d(this),t=e.val(),i=e.closest(".woocommerce_restriction"),o=i.data("restriction_id"),n=parseInt(i.data("index")),i=e.closest(".condition_row"),e=parseInt(i.data("condition_index")),t=p(o,t);if(!t)return!1;e=t({restriction_index:n,condition_index:e});i.find(".condition_content").html(e).addClass("added");i=i.find(".added");return i.csp_scripts(),i.removeClass("added"),!1}),(e=r.find(".woocommerce_restriction").get()).sort(function(e,t){e=parseInt(d(e).attr("data-index")),t=parseInt(d(t).attr("data-index"));return e<t?-1:t<e?1:0}),d(e).each(function(e,t){r.append(t)}),i(),r.sortable({items:".woocommerce_restriction",cursor:"move",axis:"y",handle:".sort-item",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(e,t){t.item.css("background-color","#f6f6f6")},stop:function(e,t){t.item.removeAttr("style"),i()}})});