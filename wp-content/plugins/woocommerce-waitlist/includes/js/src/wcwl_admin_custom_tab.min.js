jQuery(document).ready(function(t){!function c(w){w(".wcwl_variation_tab").on("click",".wcwl_header_wrap",function(){w(this).next(w(".wcwl_body_wrap")).slideToggle()});w("ul.wcwl_tabs").on("click","li",function(){w(".wcwl_notice").remove();var t=w(this).closest(".wcwl_body_wrap");w(t).find("ul.wcwl_tabs li, .wcwl_tab_content").removeClass("current");var i=w(this).data("tab");w(this).addClass("current"),w(t).find(".wcwl_tab_content."+i).addClass("current")});function i(t){t=w(t).find("tr.wcwl_user_row");return 0<t.length}function a(t){w(t).find(".wcwl_actions").hide(),w(t).find(".wcwl_waitlist_table").hide(),w(t).find(".wcwl_no_users_text ").show(),"archive"==w(t).data("panel")&&w(t).find(".wcwl_add_user_wrap").hide()}function e(t){w(t).find(".wcwl_waitlist_table").show(),w(t).find(".wcwl_no_users_text ").hide(),w(t).find("button.wcwl_email_add_user").is(":visible")||w(t).find(".wcwl_actions").show(),"archive"==w(t).data("panel")&&w(t).find(".wcwl_add_user_wrap ").show()}function n(t){(i(t)?e:a)(t),I()}w(".wcwl_tab_content").each(function(){n(this),I()});w(".wcwl_add_user_wrap").on("click",".wcwl_add",function(){var t=w(this).closest(".wcwl_tab_content");w(".wcwl_notice").remove(),w(this).hide(),t.find(".wcwl_no_users").hide(),t.find(".wcwl_add_user_content").show(),t.find(".wcwl_actions").hide()});w(".wcwl_add_user_wrap").on("click",".wcwl_back",function(t){w(".wcwl_notice").remove(),l(this)});function l(t){t=w(t).closest(".wcwl_tab_content");t.find(".wcwl_add_user_content").hide(),t.find(".wcwl_add").show(),t.find(".wcwl_email").val(""),i(t)?(t.find(".wcwl_actions").show(),t.find(".wcwl_no_users").hide()):t.find(".wcwl_no_users").show()}w(".wcwl_add_user_wrap").on("click",".wcwl_email_add_user",function(){var t=w(this).closest(".wcwl_tab_content").find("input.wcwl_email").val().split(","),a=j(this),i=w(this).data("nonce"),e=w('.wcwl_email_add_user[data-product-id="'+a+'"]'),c=w(this).closest(".wcwl_tab_content").data("panel"),n=!1;if(x(e),w.isArray(t))w.each(t,function(t,i){if(i=i.replace(/ /g,""),!g(i))return f("error",wcwl_tab.invalid_email,a,c),n=!0,y(c,"add_user",wcwl_tab.add_text),!1}),n||o(t,a,i,c);else{if(!g(t))return f("error",wcwl_tab.invalid_email,a,c),n=!0,y(c,"add_user",wcwl_tab.add_text),!1;o(t,a,i,c)}});w(".wcwl_waitlist_table").on("click",'input[name="wcwl_select_all"]',function(){var t=w(this).closest("tbody").find(".wcwl_user_checkbox"),i=w(this).prop("checked");w(t).each(function(){w(this).prop("checked",i)})});function o(t,a,i,e){i={action:"wcwl_add_user_to_waitlist",emails:t,product_id:a,wcwl_add_user_nonce:i};w.post(ajaxurl,i,function(t){w(".wcwl_notice").remove();var i=w('.wcwl_body_wrap[data-product-id="'+a+'"] .'+e+" .wcwl_waitlist_table");d(t.data.users,a,i,e),w("#wcwl_variation_"+a).length&&_(a),f(t.data.type,t.data.message,a,e),e=w('.wcwl_body_wrap[data-product-id="'+a+'"]').find("."+e),C(e,".wcwl_email_add_user"),l(e.find(".wcwl_waitlist_table"))})}function s(t,i,a,e){var c=t.join_date;"archive"==e&&(c=t.date);e='<tr class="wcwl_user_row" data-user-id="'+t.email+'">';e+='<td><input class="wcwl_user_checkbox" type="checkbox" name="wcwl_user_checkbox" value="'+t.email+'" data-user-email="'+t.email+'" data-date-added="'+c+'"/></td>',1<t.link.length?e+='<td><strong><a title="'+wcwl_tab.view_profile_text+'" href="'+t.link+'">'+t.email+"</a></strong></td>":e+="<td><strong>"+t.email+"</strong></td>",e+="<td>"+t.join_date+"</td></tr>",a.append(e)}function d(t,a,e,c){w.each(t,function(t,i){0==e.find('input[data-user-email="'+i.email+'"]').length&&(s(i,a,e,c),0<(i=w("#wcwl_variation_"+a)).length&&(_(a),i.removeClass("wcwl_hidden")))})}function _(t){var i=w("#wcwl_variation_"+t+" .wcwl_count"),t=w('.wcwl_body_wrap[data-product-id="'+t+'"] .waitlist tr.wcwl_user_row').length;i.text(parseInt(t))}w(".wcwl_actions").on("click","button.wcwl_action",function(){var t,i,a=w(this).prev("select.wcwl_action").val(),e=w(this).closest(".wcwl_tab_content").data("panel"),c=j(this);a?(i=w('.wcwl_body_wrap[data-product-id="'+c+'"] .'+e+" .wcwl_user_checkbox:checkbox:checked"),t="","wcwl_email_custom"==a?0<(t=r(i)).length?window.location="mailto:"+wcwl_tab.admin_email+"?bcc="+t:f("error",wcwl_tab.no_users_text,c,e):"wcwl_export"==a?0<(t=r(i)).length?(x(this),A(t,c,e)):f("error",wcwl_tab.no_users_text,c,e):(t=u(i),i=w(this).data("nonce"),x(this),p(a,c,t,i,e))):f("error",wcwl_tab.no_action_text,c,e)});function r(t){var i="";return w(t).each(function(){i+=w(this).data("user-email")+","}),i}function u(t){var i=[];return w(t).each(function(){var t={date:w(this).data("date-added"),email:w(this).val()};i.push(t)}),i}function p(a,e,t,i,c){i={action:a,product_id:e,users:t,wcwl_action_nonce:i};w.post(ajaxurl,i,function(t){w(".wcwl_notice").remove();var i="";"success"==t.data.type&&("wcwl_remove_waitlist"==a?(i=w('.wcwl_body_wrap[data-product-id="'+e+'"] .waitlist .wcwl_waitlist_table'),h(t.data.users,e,c,i),i.find("input").prop("checked",!1),"yes"==t.data.archive&&(i=w('.wcwl_body_wrap[data-product-id="'+e+'"] .archive .wcwl_waitlist_table'),d(t.data.users,e,i,"archive"),archive_panel=w('.wcwl_body_wrap[data-product-id="'+e+'"]').find(".archive"),C(archive_panel,".wcwl_action"))):"wcwl_remove_archive"==a?(i=w('.wcwl_body_wrap[data-product-id="'+e+'"] .archive .wcwl_waitlist_table'),h(t.data.users,e,c,i),i.find("input").prop("checked",!1)):"wcwl_return_to_waitlist"==a&&(i=w('.wcwl_body_wrap[data-product-id="'+e+'"] .waitlist .wcwl_waitlist_table'),d(t.data.users,e,i,"waitlist"),i=w('.wcwl_body_wrap[data-product-id="'+e+'"] .waitlist'),C(i,".wcwl_action"))),f(t.data.type,t.data.message,e,c);t=w('.wcwl_body_wrap[data-product-id="'+e+'"]').find("."+c);C(t,".wcwl_action")})}function h(t,a,e,c){w.each(t,function(t,i){c.find('tr[data-user-id="'+i.email+'"]').first().remove(),i.id&&c.find('tr[data-user-id="'+i.id+'"]').first().remove(),"waitlist"==e&&w("#wcwl_variation_"+a).length&&_(a)}),0==c.find("tr.wcwl_user_row").length&&(c.hide(),c.closest(".wcwl_tab_content").find(".wcwl_no_users").show(),"archive"==e&&w('.wcwl_body_wrap[data-product-id="'+a+'"] .'+e+" .wcwl_add_user_wrap").hide())}function f(t,i,a,e){w(".wcwl_notice").remove();i=m(t,i);"options"==e?w(i).insertBefore(w('.wcwl_body_wrap[data-product-id="'+a+'"] .options')):w(i).insertAfter(w('.wcwl_body_wrap[data-product-id="'+a+'"] .'+e+" .wcwl_actions")),"success"==t&&w(".wcwl_notice").delay(3e3).slideToggle(),b()}function m(t,i){t='<div class="wcwl_notice wcwl_notice_'+t+'">';return t+="<p>"+i+"</p>",t+='<span class="wcwl_dismiss dashicons dashicons-dismiss"></span></div>'}function b(){w(".wcwl_notice").on("click",".wcwl_dismiss",function(){w(this).closest(".wcwl_notice").remove(),w("ul.waitlist-tabs").css("margin-top","0")})}b();{var v;0<w(".wcwl_header_wrap").length&&(v=0,w(document).ajaxSuccess(function(t,i,a,e){"string"==typeof e&&e.substring(0,35).includes("woocommerce_variation")&&(w(".wcwl_notice").remove(),1<++v&&(w("#wcwl_waitlist_data").prepend(m("info",wcwl_tab.update_waitlist_notice)),b()))}))}w(".options").on("change",'input[name="enable_stock_trigger"]',function(){w(this).is(":checked")?(w(this).closest(".options").find('input[name="minimum_stock"]').removeAttr("disabled"),w(this).closest(".options").find('label[for="minimum_stock"]').removeClass("wcwl_disabled")):(w(this).closest(".options").find('input[name="minimum_stock"]').attr("disabled","disabled"),w(this).closest(".options").find('label[for="minimum_stock"]').addClass("wcwl_disabled"))});w(".options").on("click","button",function(){x(this);var t=w(this).closest(".wcwl_tab_content"),i=j(this),a=t.find('input[name="enable_stock_trigger"]').is(":checked"),e={enable_waitlist:t.find('input[name="enable_waitlist"]').is(":checked"),enable_stock_trigger:a},c=t.find('input[name="minimum_stock"]');e.minimum_stock=a?c.val():c.data("default-stock"),c.val(e.minimum_stock),k(t,i,e)});function k(i,a,t){var e=i.find("button"),e={action:"wcwl_update_waitlist_options",product_id:a,options:t,wcwl_update_nonce:e.data("nonce")};w.post(ajaxurl,e,function(t){w(".wcwl_notice").remove(),f(t.data.type,t.data.message,a,"options"),y(i,"update_options",wcwl_tab.update_button_text)})}function g(t){var i=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return i.test(t)}function x(t){w(t).text(""),w(t).append('<span class="wcwl_loading spinner is-active"></span>'),w(t).attr("disabled","disabled")}function y(t,i,a){var e="";e="add_user"==i?"button.wcwl_email_add_user":"update_options"==i?".options button":"button.wcwl_action",w(t).find(w(e)).text(a),w(e).removeAttr("disabled"),w(e).find("span.wcwl_loading").remove()}function C(t,i){var a=w(t).find("button"+i),e="";type=".wcwl_email_add_user"==i?(e=wcwl_tab.add_text,"add_user"):(e=wcwl_tab.go_text,"action"),y(t,type,e),w(a).prev(".wcwl_email").val(""),w(a).prev("select.wcwl_action").val("0"),n(t)}function j(t){return w(t).closest(".wcwl_body_wrap").data("product-id")}w("#wcwl_waitlist_data").on("keyup keypress",'input.wcwl_email, input[name="minimum_stock"]',function(t){var i=t.keyCode||t.which;13===i&&(t.preventDefault(),("minimum_stock"==w(this).attr("name")?w(this).closest(".options").find("button"):w(this).next("button")).trigger("click"))});function A(t,i,a){var e=a+"-export-"+i+".csv",t="data:text/csv;charset=utf-8,"+t,t=encodeURI(t),i=w('.wcwl_body_wrap[data-product-id="'+i+'"] .'+a),a=document.createElement("a");a.setAttribute("href",t),a.setAttribute("download",e),a.click(),y(i,"action",wcwl_tab.go_text)}var D=null;var z=null;function I(){w(".waitlist .wcwl_user_checkbox").click(function(t){M(w(".waitlist .wcwl_user_checkbox"),this,D,"waitlist",t)}),w(".archive .wcwl_user_checkbox").click(function(t){M(w(".archive .wcwl_user_checkbox"),this,z,"archive",t)})}function M(t,i,a,e,c){var n;a&&c.shiftKey&&(n=t.index(i),c=t.index(a),t.slice(Math.min(n,c),Math.max(n,c)+1).prop("checked",a.checked)),"waitlist"==e?D=i:z=i}0<w("#tribe_ticket_list_table").length&&w(document).ajaxSuccess(function(t,i,a,e){"string"==typeof a.data&&a.data.includes("action=tribe-ticket-edit")&&0<w("#ticket_form_table .accordion-header.woocommerce-waitlist").length&&(w("#ticket_form_table").on("click","#wcwl-tab",function(t){t.preventDefault(),w(this).addClass("is-active"),w(this).next("section").addClass("is-active")}),w("#ticket_form_table").on("click","#wcwl-tab.is-active",function(t){t.preventDefault(),w(this).removeClass("is-active"),w(this).next("section").removeClass("is-active")}),c(w))})}(t)});