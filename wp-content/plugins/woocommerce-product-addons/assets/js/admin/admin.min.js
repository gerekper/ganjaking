jQuery(function(n){"use strict";var e={getAddonOptions:function(){var a={security:wc_pao_params.nonce.get_addon_options,action:"wc_pao_get_addon_options"};return n.ajax({type:"POST",data:a,url:wc_pao_params.ajax_url})},getAddonField:function(){var a={security:wc_pao_params.nonce.get_addon_field,action:"wc_pao_get_addon_field"};return n.ajax({type:"POST",data:a,url:wc_pao_params.ajax_url})},refresh:function(){0<n(".wc-pao-addon").length?(n(".wc-pao-toolbar").addClass("wc-pao-has-addons"),n(".wc-pao-addons").addClass("wc-pao-has-addons")):(n(".wc-pao-toolbar").removeClass("wc-pao-has-addons"),n(".wc-pao-addons").removeClass("wc-pao-has-addons")),n(document.body).trigger("init_tooltips")},expandAllFields:function(){n("#product_addons_data .wc-pao-addon").removeClass("closed").addClass("open")},closeAllFields:function(){n("#product_addons_data .wc-pao-addon").removeClass("open").addClass("closed")},addonRowIndexes:function(){n(".wc-pao-addons .wc-pao-addon").each(function(a,o){n(".wc-pao-addon-position",o).val(parseInt(n(o).index(".wc-pao-addons .wc-pao-addon")))})},runFieldSortable:function(){n(".wc-pao-addons").sortable({items:".wc-pao-addon",cursor:"move",axis:"y",handle:".wc-pao-addon-header",scrollSensitivity:40,helper:function(a,o){return o},start:function(a,o){o.item.css("border-style","dashed").css("border-color","orange")},stop:function(a,o){o.item.removeAttr("style"),e.addonRowIndexes()}})},runOptionSortable:function(){n(".wc-pao-addon-content-options-container").sortable({items:".wc-pao-addon-option-row",cursor:"move",axis:"y",handle:".wc-pao-addon-sort-handle",scrollSensitivity:40,helper:function(a,o){return o},start:function(a,o){o.item.css("border-style","dashed").css("border-width","1px").css("border-color","orange")},stop:function(a,o){o.item.removeAttr("style"),e.addonRowIndexes()}})},validateSettings:function(a){n(".wc-pao-error-message").remove(),n(".updated").remove();var o,d=!0,e=!0;return n(".wc-pao-addons").find(".wc-pao-addon").each(function(a){0===n(this).find(".wc-pao-addon-content-name").val().length?(n(this).addClass("wc-pao-error").find(".wc-pao-addon-content-name").addClass("wc-pao-error"),e=d=!1):n(this).find(".wc-pao-addon-content-name").removeClass("wc-pao-error");var o=n(this).find(".wc-pao-addon-type-select").val();n(this).find(".wc-pao-addon-option-row").each(function(){"multiple_choice"!==o&&"checkbox"!==o||0!==n(this).find(".wc-pao-addon-content-label input").val().length?n(this).find(".wc-pao-addon-content-label input").removeClass("wc-pao-error"):(n(this).find(".wc-pao-addon-content-label input").addClass("wc-pao-error"),n(this).parents(".wc-pao-addon").eq(0).addClass("wc-pao-error"),e=d=!1)}),e&&n(this).removeClass("wc-pao-error")}),!1===d&&(o=n('<div class="notice notice-error wc-pao-error-message"><p>'+wc_pao_params.i18n.required_fields+"</p></div>"),"product"===a?n(".wc-pao-addons").before(o):"global"===a&&n(".global-addons-form").before(o),n("html, body").animate({scrollTop:n(".wc-pao-error-message").offset().top-200},600)),d},init:function(){var a=n("#product_addons_data"),o=n("<input>"),d=n("<input>");o.attr("type","hidden"),o.attr("name","pao_post_control_var"),o.val("1"),d.attr("type","hidden"),d.attr("name","pao_post_test_var"),d.val("1"),a.prepend(o),a.append(d),n(".post-type-product").on("click",'#publishing-action input[name="save"]',function(){return e.validateSettings("product")}),n(".product_page_addons").on("click",'input[type="submit"]',function(){return e.validateSettings("global")}),a.on("change",".wc-pao-addon-content-name",function(){n(this).val()?n(this).closest(".wc-pao-addon").find(".wc-pao-addon-name").text(n(this).val()):n(this).closest(".wc-pao-addon").find(".wc-pao-addon-name").text("")}).on("keyup",".wc-pao-addon-content-name, .wc-pao-addon-content-label input",function(){n(this).removeClass("wc-pao-error"),n(".wc-pao-error-message").remove()}).on("change","select.wc-pao-addon-type-select",function(){var a,o=n(this).val(),d=n(this).parents(".wc-pao-addon"),e=n(this).find('option[value="'+o+'"]').text();switch(d.find(".wc-pao-addon-header .wc-pao-addon-type").html(e),d.find(".wc-pao-addon-main-settings-2 .wc-pao-col1").removeClass("full"),d.find(".wc-pao-addon-main-settings-2 .wc-pao-col2").removeClass("hide").addClass("show"),d.find(".wc-pao-addon-content-image").removeClass("show").addClass("hide"),d.find(".wc-pao-addon-content-label").addClass("full"),d.find(".wc-pao-addon-restrictions-select").removeClass("show").addClass("hide"),d.find(".wc-pao-addon-main-settings-1 .wc-pao-col2-1").removeClass("show").addClass("hide"),d.find(".wc-pao-addon-main-settings-1 .wc-pao-col2-2").removeClass("show").addClass("hide"),d.find(".wc-pao-addon-main-settings-1 .wc-pao-col1").addClass("full"),d.find(".wc-pao-addon-content-option-rows").removeClass("show").addClass("hide"),d.find(".wc-pao-addon-content-non-option-rows").removeClass("hide").addClass("show"),d.find(".wc-pao-addon-required-setting").removeClass("hide").addClass("show"),o){case"multiple_choice":d.find(".wc-pao-addon-main-settings-1 .wc-pao-col2-1").removeClass("hide").addClass("show"),d.find(".wc-pao-addon-main-settings-1 .wc-pao-col1").removeClass("full"),d.find(".wc-pao-addon-content-option-rows").removeClass("hide").addClass("show"),d.find(".wc-pao-addon-content-non-option-rows").removeClass("show").addClass("hide"),"images"===d.find(".wc-pao-addon-display-select").val()&&(d.find(".wc-pao-addon-content-image").removeClass("hide").addClass("show"),d.find(".wc-pao-addon-content-label").removeClass("full"));break;case"checkbox":d.find(".wc-pao-addon-main-settings-1 .wc-pao-col2-1").removeClass("show").addClass("hide"),d.find(".wc-pao-addon-main-settings-1 .wc-pao-col1").addClass("full"),d.find(".wc-pao-addon-content-option-rows").removeClass("hide").addClass("show"),d.find(".wc-pao-addon-content-non-option-rows").removeClass("show").addClass("hide"),d.find(".wc-pao-addon-content-image").removeClass("show").addClass("hide"),d.find(".wc-pao-addon-content-label").addClass("full"),d.find(".wc-pao-addon-adjust-price-container").removeClass("show").addClass("hide"),d.find(".wc-pao-addon-restrictions-container").removeClass("show").addClass("hide");break;case"custom_price":a=wc_pao_params.i18n.limit_price_range,d.find(".wc-pao-addon-adjust-price-container").removeClass("show").addClass("hide"),d.find(".wc-pao-addon-min-max").removeClass("hide").addClass("show"),d.find(".wc-pao-addon-main-settings-1 .wc-pao-col2-1").removeClass("show").addClass("hide"),d.find(".wc-pao-addon-main-settings-1 .wc-pao-col1").addClass("full"),d.find(".wc-pao-addon-content-option-rows").removeClass("show").addClass("hide"),d.find(".wc-pao-addon-content-non-option-rows").removeClass("hide").addClass("show"),d.find(".wc-pao-addon-restrictions-select").removeClass("show").addClass("hide"),d.find(".wc-pao-addon-adjust-price-container").removeClass("show").addClass("hide"),d.find(".wc-pao-addon-restrictions-container").removeClass("hide").addClass("show");break;case"input_multiplier":d.find(".wc-pao-addon-adjust-price-container").removeClass("hide").addClass("show"),d.find(".wc-pao-addon-restrictions-container").removeClass("hide").addClass("show"),a=wc_pao_params.i18n.limit_quantity_range;break;case"custom_text":a=wc_pao_params.i18n.limit_character_length,d.find(".wc-pao-addon-main-settings-1 .wc-pao-col2-2").removeClass("hide").addClass("show"),d.find(".wc-pao-addon-restrictions-select").removeClass("hide").addClass("show"),d.find(".wc-pao-addon-content-option-rows").removeClass("show").addClass("hide"),d.find(".wc-pao-addon-content-non-option-rows").removeClass("hide").addClass("show"),d.find(".wc-pao-addon-adjust-price-container").removeClass("hide").addClass("show"),d.find(".wc-pao-addon-restrictions-container").removeClass("hide").addClass("show"),d.find(".wc-pao-addon-min-max").removeClass("hide").addClass("show"),"email"===d.find(".wc-pao-addon-restrictions-select").val()&&d.find(".wc-pao-addon-min-max").removeClass("show").addClass("hide");break;case"custom_textarea":a=wc_pao_params.i18n.limit_character_length,d.find(".wc-pao-addon-min-max").removeClass("hide").addClass("show"),d.find(".wc-pao-addon-adjust-price-container").removeClass("hide").addClass("show"),d.find(".wc-pao-addon-restrictions-container").removeClass("hide").addClass("show");break;case"file_upload":d.find(".wc-pao-addon-adjust-price-container").removeClass("hide").addClass("show"),d.find(".wc-pao-addon-restrictions-container").removeClass("show").addClass("hide");break;case"heading":d.find(".wc-pao-addon-required-setting").removeClass("show").addClass("hide"),d.find(".wc-pao-addon-adjust-price-container").removeClass("show").addClass("hide"),d.find(".wc-pao-addon-restrictions-container").removeClass("show").addClass("hide"),d.find(".wc-pao-addon-main-settings-2 .wc-pao-col1").addClass("full"),d.find(".wc-pao-addon-main-settings-2 .wc-pao-col2").removeClass("show").addClass("hide");break;default:d.find(".wc-pao-addon-main-settings-1 .wc-pao-col2-1").removeClass("show").addClass("hide"),d.find(".wc-pao-addon-main-settings-1 .wc-pao-col2-2").removeClass("show").addClass("hide"),d.find(".wc-pao-addon-main-settings-1 .wc-pao-col1").addClass("full"),d.find(".wc-pao-addon-content-option-rows").removeClass("show").addClass("hide"),d.find(".wc-pao-addon-content-non-option-rows").removeClass("hide").addClass("show"),a=wc_pao_params.i18n.restrictions,d.find(".wc-pao-addon-restrictions-container").removeClass("show").addClass("hide")}d.find(".wc-pao-addon-restriction-name").html(a);e=n(this).closest(".wc-pao-addon").find(".wc-pao-remove-option");e.length<2?e.attr("disabled","disabled"):e.removeAttr("disabled")}).on("change",".wc-pao-addon-display-select",function(){var a=n(this).val(),o=n(this).parents(".wc-pao-addon");"images"===a?(o.find(".wc-pao-addon-content-image").removeClass("hide").addClass("show"),o.find(".wc-pao-addon-content-label").removeClass("full")):(o.find(".wc-pao-addon-content-image").removeClass("show").addClass("hide"),o.find(".wc-pao-addon-content-label").addClass("full"))}).on("click","button.wc-pao-add-option",function(){var o=n(this).closest(".wc-pao-addon").index(".wc-pao-addon"),d=n(this).parents(".wc-pao-addon-content-option-rows").find(".wc-pao-addon-content-options-container");return n.when(e.getAddonOptions()).then(function(a){a=(a=a.html).replace(/{loop}/g,o),"images"===n(this).parents(".wc-pao-addon").find(".wc-pao-addon-display-select").val()&&(a=(a=a.replace(/wc-pao-addon-content-image hide/g,"wc-pao-addon-content-image show")).replace(/wc-pao-addon-content-label full/g,"wc-pao-addon-content-label")),n(a).appendTo(d),n("select.wc-pao-addon-type-select").change()}),!1}).on("click",".wc-pao-add-field",function(){var o=n(".wc-pao-addons .wc-pao-addon").length;return n.when(e.getAddonField()).then(function(a){a=(a=(a=a.html).replace(/{loop}/g,o)).replace(/closed/g,"open"),n(".wc-pao-addons").append(a),n("select.wc-pao-addon-type-select").change(),e.refresh(),e.runOptionSortable();a=n("select#product-type").val();n(".hide_if_"+a).hide(),n(".show_if_"+a).show()}),!1}).on("click",".wc-pao-remove-addon",function(){var a;return n(".wc-pao-error-message").remove(),confirm(wc_pao_params.i18n.confirm_remove_addon)&&(a=n(this).closest(".wc-pao-addon"),n(a).find("input").val(""),n(a).remove()),n(".wc-pao-addons .wc-pao-addon").each(function(a,o){var d=a;n(this).find(".product_addon_position").val(d),n(this).find("select, input, textarea").prop("name",function(a,o){return o.replace(/\[[0-9]+\]/g,"["+d+"]")})}),e.refresh(),!1}).on("click",".wc-pao-remove-option",function(){var a;return confirm(wc_pao_params.i18n.confirm_remove_option)&&(a=n(this).parents(".wc-pao-addon-content").find("select.wc-pao-addon-type-select"),n(this).parents(".wc-pao-addon-option-row").remove(),a.change()),!1}).on("click",".wc-pao-expand-all",function(a){a.preventDefault(),e.expandAllFields()}).on("click",".wc-pao-close-all",function(a){a.preventDefault(),e.closeAllFields()}).on("click",".wc-pao-addon-header",function(a){a.preventDefault();a=n(this).parents(".wc-pao-addon");a.hasClass("open")?a.removeClass("open").addClass("closed"):a.removeClass("closed").addClass("open")}).on("click",".wc-pao-addon-description-enable",function(){n(this).is(":checked")?n(this).parents(".wc-pao-addons-secondary-settings").find(".wc-pao-addon-description").removeClass("hide").addClass("show"):n(this).parents(".wc-pao-addons-secondary-settings").find(".wc-pao-addon-description").removeClass("show").addClass("hide")}).on("change",".wc-pao-addon-option-price-type",function(){switch(n(this).val()){case"flat_fee":case"quantity_based":n(this).parents(".wc-pao-addon-content-price-type").removeClass("full").next(".wc-pao-addon-content-price").eq(0).removeClass("hide").addClass("show")}}).on("click",".wc-pao-addon-add-image",function(){var d=n(this).parent(),a=wp.media.frames.mediaFrame=wp.media({title:wc_pao_params.i18n.add_image_swatch,button:{text:wc_pao_params.i18n.add_image},library:{type:"image"},multiple:!1});a.on("select",function(){a.state().get("selection").map(function(a){var o;(a=a.toJSON()).id&&(o=(a.sizes.thumbnail||a).url,d.find(".wc-pao-addon-option-image-id").val(a.id),d.find(".wc-pao-addon-image-swatch img").prop("src",o),d.find(".wc-pao-addon-image-swatch").removeClass("hide").addClass("show"),d.find(".wc-pao-addon-add-image").removeClass("show").addClass("hide"),d.find(".dashicons-plus").removeClass("show").addClass("hide"))})}),a.open()}).on("click",".wc-pao-addon-image-swatch",function(a){a.preventDefault();a=n(this).parent();a.find(".wc-pao-addon-option-image-id").val(""),a.find(".wc-pao-addon-image-swatch img").prop("src",""),a.find(".wc-pao-addon-image-swatch").removeClass("show").addClass("hide"),a.find(".wc-pao-addon-add-image").removeClass("hide").addClass("show"),a.find(".dashicons-plus").removeClass("hide").addClass("show")}).on("click",".wc-pao-addon-restrictions",function(){n(this).is(":checked")?n(this).parents(".wc-pao-addon-restrictions-container").find(".wc-pao-addon-restrictions-settings").removeClass("hide").addClass("show"):n(this).parents(".wc-pao-addon-restrictions-container").find(".wc-pao-addon-restrictions-settings").removeClass("show").addClass("hide")}).on("change",".wc-pao-addon-restrictions-select",function(){var a=n(this).val(),o=n(this).parents(".wc-pao-addon-restrictions-settings");"email"===a?o.find(".wc-pao-addon-min-max").removeClass("show").addClass("hide"):o.find(".wc-pao-addon-min-max").removeClass("hide").addClass("show")}).on("click",".wc-pao-addon-adjust-price",function(){n(this).is(":checked")?n(this).parents(".wc-pao-addon-adjust-price-container").find(".wc-pao-addon-adjust-price-settings").removeClass("hide").addClass("show"):n(this).parents(".wc-pao-addon-adjust-price-container").find(".wc-pao-addon-adjust-price-settings").removeClass("show").addClass("hide")}).find("select.wc-pao-addon-type-select").change(),n("#product_addons_data").on("click",".wc-pao-export-addons",function(){return n("#product_addons_data textarea.wc-pao-import-field").hide(),n("#product_addons_data textarea.wc-pao-export-field").slideToggle("300",function(){n(this).select()}),!1}),n("#product_addons_data").on("click",".wc-pao-import-addons",function(){return n("#product_addons_data textarea.wc-pao-export-field").hide(),n("#product_addons_data textarea.wc-pao-import-field").slideToggle("300",function(){n(this).val("")}),!1}),e.runFieldSortable(),e.runOptionSortable(),1<n(".wc-pao-addons .wc-pao-addon").length&&n(".wc-pao-toolbar").show(),n('[name*="addon_wc_booking_person_qty_multiplier"]').on("change",function(){var a=n(this).attr("name"),o=n(this).is(":checked");n('[name*="'+a+'"]').prop("checked",o)})}};e.init()});