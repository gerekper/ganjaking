"use strict";jQuery(function(r){var l,i,n,a=null!==window.wc_memberships_admin?window.wc_memberships_admin:{};"admin_page_wc_memberships_profile_fields"===(null!==window.pagenow?window.pagenow:"")&&(l=function(){r("#profile-field-options").sortable({axis:"y",handle:r(".wc-memberships-profile-field-sort-handle"),update:function(){r(".profile-field-option-row").not("#profile-field-option--template").each(function(e,i){var t=e;r(i).find("input").each(function(e,i){r(i).hasClass("multi-default-field")?(r(i).attr("name","default_options["+t+"]"),r(i).attr("value",t)):r(i).hasClass("default-field")?r(i).attr("value",t):r(i).hasClass("name-field")&&r(i).attr("name","options["+t+"]")})})}})},i=function(){var e=r("#visibility").val(),i="customer"===r('input[name="editable_by"]:checked').val(),e=e&&1===e.length&&"profile-fields-area"===e[0];i&&!e?r("#required").closest("p").show():r("#required").closest("p").hide()},r("#the-list").sortable({axis:"y",handle:r(".wc-memberships-profile-field-sort-handle").not(".disabled"),update:function(){var e=r(".table-view-list "),i=[];e.block({message:null,overlayCSS:{opacity:.6}}),e.find('input[name="bulk_action[]"]').each(function(){i.push(r(this).val())}),r.post(a.ajax_url,{action:"wc_memberships_sort_profile_fields",security:a.sort_profile_fields_nonce,profile_fields:i},function(){}).always(function(){e.unblock()})}}),r(".wc-memberships-profile-field-switch > input").on("click change",function(e){e.preventDefault();var i=r(this),o=i.is(":checked");"editable_by"===r(this).data("prop")&&r(this).data("profile-field").length&&(e={action:"wc_memberships_toggle_profile_field_editable_by",security:a.toggle_profile_field_editable_by_nonce,profile_field:r(this).data("profile-field")},r.post(a.ajax_url,e,function(e){var t;e&&e.success?(t=i.closest("tr").find("td.visibility"),i.prop("checked","customer"===e.data.editable_by),t.html(""),0===e.data.visibility.length?t.append("<span>&mdash;</span>"):r(e.data.visibility).each(function(e,i){t.append("<span>"+a.profile_fields_visibility_options[i]+"</span>")})):(i.prop("checked",o),console.log(e))}))}),r("#membership_plan_ids").on("change",function(e){var i,t=r("#visibility"),o=r("#membership_plan_ids").find("option:selected"),l=window.wc_memberships_admin.profile_fields_visibility_options,n=[];if(o&&0!==o.length)for(var a in o.each(function(){var e=r(this).data("visibility-options").split(",");r(e).each(function(e,i){n.push(i)})}),l)i=t.find('option[value="'+a+'"]'),l.hasOwnProperty(a)&&n.includes(a)?i&&0!==i.length||t.append('<option value="'+a+'">'+l[a]+"</option>"):i&&0<i.length&&i.remove();else for(var s in l)i=t.find('option[value="'+s+'"]'),!l.hasOwnProperty(s)||i&&0!==i.length||t.append('<option value="'+s+'">'+l[s]+"</option>");t.trigger("change")}).trigger("change"),r(".handlediv").on("click",function(e){e.preventDefault();e=r(this).closest(".postbox");e.toggleClass("closed"),r(this).attr("aria-expanded",e.hasClass("closed")?"false":"true")}),r("ul.wc-tabs > li a").on("click",function(e){if(e.preventDefault(),r(e.target).closest("li").hasClass("disabled"))return!1;var i=r(e.target).closest("li"),e=r(r(e.target).attr("href"));r(".panel").hide(),e.show(),r(".wc-tab").removeClass("active"),i.addClass("active")}).first().trigger("click"),r("#type").on("change",function(e){var i=r(this).val();"checkbox"!==i?r('input[name="default_value"]').closest("p").hide():r('input[name="default_value"]').closest("p").show(),-1!==r.inArray(i,["select","radio","multiselect","multicheckbox"])?r(".field_options_tab").removeClass("disabled"):r(".field_options_tab").addClass("disabled"),-1!==r.inArray(i,["multiselect","multicheckbox"])?(r('.profile-field-option-default > input[type="radio"]').hide(),r('.profile-field-option-default > input[type="checkbox"]').show()):(r('.profile-field-option-default > input[type="radio"]').show(),r('.profile-field-option-default > input[type="checkbox"]').hide())}).trigger("change"),r("#visibility").on("change",function(e){i()}).trigger("change"),r('input[name="editable_by"]').on("change",function(e){"admin"===r(this).attr("value")&&r(this).is(":checked")?r("#label, #description, #visibility").closest("p").hide():"customer"===r(this).attr("value")&&r(this).is(":checked")&&r("#label, #description, #visibility").closest("p").show(),i()}).trigger("change"),r("button.add-profile-field-option").on("click",function(e){var i=r("#profile-field-option--template"),t=r(".profile-field-option-row:not(#profile-field-option--template)").length,o=i.clone().attr("id","");o.find(".profile-field-option-field").each(function(e,i){r(i).attr("name",r(i).attr("name").replace("template",t)),"default_option"===r(i).attr("name")&&r(i).attr("value",t)}),o.appendTo(i.closest("tbody")),r(".profile-field-no-options").hide(),r(".remove-profile-field-options").show(),(o=r("#profile-field-options")).sortable("destroy"),o.find("li").removeClass("ui-state-default"),o.find("li span").remove(),l()}),r("button.remove-profile-field-options").on("click",function(e){r(".profile-field-option-row th.check-column input:checked").closest(".profile-field-option-row").remove(),0===r(".profile-field-option-row").not("#profile-field-option--template").length?(r(".profile-field-no-options").show(),r(".remove-profile-field-options").hide()):(r(".profile-field-no-options").hide(),r(".remove-profile-field-options").show())}),l(),n=!1,r("#mainform").on("submit",function(e){if(r("#filter_action").length)return!0;var i,t,o;n||(e.preventDefault(),e=r("#title"),i=r("#visibility"),t=r(".wc-tab.general_tab > a"),o=r(".wc-tab.field_options_tab > a"),""===e.val().trim()?(r(".show-if-no-name").show(),t.trigger("click"),e.fadeOut(150).fadeIn(150).fadeOut(150).fadeIn(150).fadeOut(150).fadeIn(150)):"customer"!==r('input[name="editable_by"]:checked').val()||i.val()&&0!==i.val().length?-1!==r.inArray(r("#type").val(),["select","radio","multiselect","multicheckbox"])?"table-row"===(e=r(".profile-field-no-options")).css("display")?(o.trigger("click"),r(".show-if-options-required").show(),r(".show-if-options-empty").hide(),r(".field_options_tab > a").trigger("click"),e.fadeOut(150).fadeIn(150).fadeOut(150).fadeIn(150).fadeOut(150).fadeIn(150)):(n=!0,r(".profile-field-option-row").not("#profile-field-option--template").find(".name-field").each(function(e,i){if(""===r(i).val().trim())return o.trigger("click"),r(".show-if-options-required").hide(),r(".show-if-options-empty").show(),r(".field_options_tab > a").trigger("click"),r(i).fadeOut(150).fadeIn(150).fadeOut(150).fadeIn(150).fadeOut(150).fadeIn(150),n=!1})):n=!0:(t.trigger("click"),0===r(".show-if-no-visibility").length&&r("p.visibility_field").append('<span class="description show-if-no-visibility profile-field-validation-error" style="display:block;clear:both;">'+a.i18n.profile_field_no_visibility+" </span>"),i.closest("p").fadeOut(150).fadeIn(150).fadeOut(150).fadeIn(150).fadeOut(150).fadeIn(150)),n&&r("#mainform").trigger("submit"))}),window.WC_Memberships_Modal_View_Profile_Fields_Confirm_Deletion=WC_Memberships_Modal_View.extend({template_id:"wc-memberships-modal-confirm-profile-field-deletion",initialize:function(e){var i=this;WC_Memberships_Modal_View_Profile_Fields_Confirm_Deletion.__super__.initialize.apply(this,arguments),r("#wc-memberships-modal-confirm-profile-field-deletion").on("click","#btn-hide",function(e){return i.hideButton(e)}).on("click","#btn-delete",function(e){return i.deleteButton(e)}).on("click","#btn-cancel",function(){return i.close()})},hideButton:function(e){e.preventDefault(),r('input[name="editable_by"][value="admin"]').prop("checked",!0).trigger("change"),r('select[name="visibility[]"]').val(null).trigger("change"),r("#mainform").trigger("submit")},deleteButton:function(e){e.preventDefault(),document.location.href=r("#delete-action .submitdelete").attr("href")}}),a.profile_field_is_in_use)&&r("#delete-action .submitdelete").on("click.memberships",function(e){e.preventDefault(),new window.WC_Memberships_Modal_View_Profile_Fields_Confirm_Deletion})});