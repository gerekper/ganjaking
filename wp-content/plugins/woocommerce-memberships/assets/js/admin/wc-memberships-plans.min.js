"use strict";(function(){jQuery(document).ready(function(o){var e,s,l=null!=(e=window.wc_memberships_admin)?e:{};if("wc_membership_plan"===(null!=(s=window.pagenow)?s:""))return o.each(["content-restriction","product-restriction","purchasing-discount"],function(e,s){return l.initializeRuleset(s)}),l.initializeEnhancedSelect(o(".js-ajax-select-products"),{action:"woocommerce_json_search_products_and_variations",security:l.search_products_nonce,screen:"wc_membership_plan"}),o(".js-access-method-selector").on("change",function(e){var s=o(".js-access-method-selector:checked",".plan-access-method-field").val(),t=o(this).closest(".options_group").find(".js-show-if-access-method-purchase"),n=o(".misc-pub-grant-access"),a=o("span.grant-access-purchase"),i=o("span.grant-access-signup"),c=o("#wp-WC_Memberships_User_Membership_Renewal_Reminder_Email-wrap").parent(".options_group");return"purchase"===s?(t.removeClass("hide"),n.show(),a.show(),i.hide(),c.show()):("signup"===s?(n.show(),i.show(),a.hide()):n.hide(),t.addClass("hide"),c.hide())}).change(),o(".plan-access-length-field").on("change",".js-access-length-type-selector",function(e){var s,t=o(".js-access-length-type-selector:checked",".plan-access-length-field").val(),n=o(this).closest(".form-field"),a=n.find(".js-show-if-access-length-type-specific"),i=n.find(".js-show-if-access-length-type-fixed");if("specific"===t?(a.removeClass("hide"),i.addClass("hide")):"fixed"===t?(a.addClass("hide"),i.removeClass("hide")):(a.addClass("hide"),i.addClass("hide")),(s=n.find(".access_length-amount")).val()||s.val(1),o(this).hasClass("js-access-length-type"))return s.focus()}),o(".js-plan-access-set-date").datepicker({defaultDate:"",dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:!0,showOn:"button",buttonImage:l.calendar_image,buttonImageOnly:!0}),o("ul.wc-tabs").show(),o("div.panel-wrap").each(function(){return o(this).find("div.panel:not(:first)").hide()}),o("ul.wc-tabs a").click(function(){var e=o(this).attr("href"),s=o(this).closest("div.panel-wrap"),t=o("#wc-memberships-membership-plan-email-content-merge-tags");switch(o("ul.wc-tabs li",s).removeClass("active"),o(this).parent().addClass("active"),o("div.panel",s).hide(),o(e).show(),"#membership-plan-email-content"===o(this).attr("href")?t.show():t.hide(),o(".js-memberships-restrict-notice").hide(),e){case"#membership-plan-data-restrict-content":o(".js-memberships-restrict-content-notice").show();break;case"#membership-plan-data-restrict-products":o(".js-memberships-restrict-products-notice").show()}return!1}),o("ul.wc-tabs li:visible").eq(0).find("a").click(),o('input[name="save"], input[name="publish"]').on("click",function(e){var s,t,n,a;return e.preventDefault(),s=o(this),a=[],n="",t=null,o("tbody.purchasing-discount-rule").each(function(){if("none"!==o(this).css("display")&&!o(this).hasClass("purchasing-discount-rule-__INDEX__")&&!o(this).find("select.js-object-ids").val()&&o(this).find('input[type="checkbox"]').is(":checked"))return t=o(this),n="discounts",a.push("\n- "+l.i18n.confirm_blanket_product_discount_rule),!1}),o("tbody.content-restriction-rule").each(function(){var e;if("none"!==o(this).css("display")&&!o(this).hasClass("content-restriction-rule-__INDEX__")&&!o(this).find("select.js-object-ids").val())return t=o(this),e=o(this).find("select.js-content-type option:selected"),n=e.val(),a.push("\n- "+l.i18n.blanket_content_restriction_rule),!1}),o("tbody.product-restriction-rule").each(function(){var e;if("none"!==o(this).css("display")&&!o(this).hasClass("product-restriction-rule-__INDEX__")&&!o(this).find("select.js-object-ids").val())return t=o(this),e=o(this).find("select.js-content-type option:selected"),n=e.val(),a.push("\n- "+l.i18n.blanket_product_restriction_rule),!1}),t&&""!==a&&!confirm(l.i18n.blanket_rule_warning+"\n"+a.join("\n")+"\n\n"+l.i18n.blanket_rule_confirmation)?("discounts"===n?o("li.purchasing_discounts_tab a").click():"post_type|product"===n||"taxonomy|product_cat"===n?o("li.restrict_products_tab a").click():o("li.restrict_content_tab a").click(),t.fadeOut(150).fadeIn(150).fadeOut(150).fadeIn(150).fadeOut(150).fadeIn(150),!1):(s.prop("disabled",!0),o("div#publishing-action span.spinner").addClass("is-active"),window.jQuery(window).off("beforeunload.edit-post"),"publish"===s.attr("name")?o("form#post").append('<input type="hidden" name="publish" value="'+s.val()+'" />').submit():o("form#post").submit(),!0)}),o("button.grant-access-modal").on("click",function(e){var s,t;return e.preventDefault(),s=o(this),t={action:"wc_memberships_get_batch_job",security:l.get_memberships_batch_job_nonce,job_name:"grant_retroactive_access",job_id:s.data("plan-id"),process:!0},o.post(l.ajax_url,t,function(e){return e.success?new WC_Memberships_Modal_View_Grant_Access_Membership_Plan({data:{job:null,error:null,plan:{id:s.data("plan-id"),name:s.data("plan-name"),access:s.data("plan-access")}}}):console.log(e)})}),window.WC_Memberships_Modal_View_Grant_Access_Membership_Plan=WC_Memberships_Modal_View.extend({template_id:"wc-memberships-modal-grant-access-membership-plan",initialize:function(e){var s,t=this,n=e.data.job?e.data.job:null,a=e.data.error?e.data.error:null,i=parseInt(e.data.plan.id,10),c=e.data.plan.name,r=e.data.plan.access;return WC_Memberships_Modal_View_Grant_Access_Membership_Plan.__super__.initialize.apply(this,arguments),t.unblock(),n&&n.id?"completed"===n.status||a?window.onbeforeunload=null:(a||(window.onbeforeunload=function(){return l.i18n.confirm_stop_batch_job}),s={action:"wc_memberships_get_batch_job",security:l.get_memberships_batch_job_nonce,job_name:n.name,job_id:n.id,process:!0},o.post(l.ajax_url,s,function(e){return e.data?(t.close(),new WC_Memberships_Modal_View_Grant_Access_Membership_Plan({data:{job:e.success?e.data:null,error:e.success?null:e.data,plan:{id:i,name:c,access:r}}})):console.log(e)})):o("#btn-start").on("click",function(e){return e.preventDefault(),t.block(),s={action:"wc_memberships_grant_retroactive_access",security:l.grant_retroactive_access_nonce,plan_id:i},o.post(l.ajax_url,s,function(e){return e.data?(t.close(),new WC_Memberships_Modal_View_Grant_Access_Membership_Plan({data:{job:e.success?e.data:null,error:e.success?null:e.data,plan:{id:i,name:c,access:r}}})):console.log(e)})})}})})}).call(void 0);