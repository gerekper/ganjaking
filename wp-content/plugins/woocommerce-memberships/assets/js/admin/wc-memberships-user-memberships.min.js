"use strict";!function(){jQuery(function(m){var s,f,i,r,n,l,a,u=null!=(e=window.wc_memberships_admin)?e:{},e=(window.typenow,null!=(e=window.pagenow)?e:"");return"edit-wc_user_membership"!==e&&"wc_user_membership"!==e||(m(".delete-membership").on("click",function(e){return confirm(u.i18n.delete_membership_confirm)}),m("input.action").on("click",function(e){return e.preventDefault(),"delete"!==(e=m(this).parent("div").find("select")).val()?"export"!==e.val():confirm(u.i18n.delete_memberships_confirm)?m("#posts-filter").submit():void 0}),m(".delete-membership-and-subscription").on("click",function(e){if(e.preventDefault(),confirm(u.i18n.delete_membership_confirm))return e={action:"wc_memberships_delete_membership_and_subscription",security:u.delete_user_membership_subscription_nonce,user_membership_id:m(this).data("user-membership-id"),subscription_id:m(this).data("subscription-id")},m.post(u.ajax_url,e,function(e){return console.log(e),window.location.href=u.user_membership_url})}),r=m(".js-user-membership-date").datepicker({defaultDate:"",dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:!0,showOn:"button",buttonImage:u.calendar_image,buttonImageOnly:!0,onSelect:function(e){var i=m(this).is("#_start_date")?"minDate":"maxDate",t=m(this).data("datepicker"),e=m.datepicker.parseDate(t.settings.dateFormat||m.datepicker._defaults.dateFormat,e,t.settings);return r.not(this).datepicker("option",i,e)}}),l={opacity:.6},m("#wc-memberships-user-membership-data").on("click","a.js-calc-plan-date",function(e){var i,t,r,s;return e.preventDefault(),e=m(this).hasClass("js-calc-plan-start-date")?(s="start","wc_memberships_get_membership_plan_start_date"):(s="end","wc_memberships_get_membership_plan_end_date"),t=m("#post_parent"),r=m("#_start_date"),i=m("#_end_date"),e={action:e,security:u.get_membership_date_nonce,plan:t.val(),start_date:r.val()},m.post(u.ajax_url,e,function(e){if(e)return("start"===s?r:i).val(e.data.substring(0,10))})}),m("#post_parent").on("change",function(e){var i,t,r,s=m(this).val();if(s)return t=m("#_start_date"),i=m("#_end_date"),r={action:"wc_memberships_get_membership_plan_start_date",security:u.get_membership_date_nonce,plan:s,start_date:t.val()},m.post(u.ajax_url,r,function(e){if(e)return t.val(e.data.substring(0,10))}),r={action:"wc_memberships_get_membership_plan_end_date",security:u.get_membership_date_nonce,plan:s,start_date:t.val()},m.post(u.ajax_url,r,function(e){if(e)return i.val(e.data.substring(0,10))})}),m(".post_status_field").on("change","select#post_status",function(e){var i;if("wcm-expired"===m(this).val())return(i=m("#_end_date")).datepicker(),i.datepicker("setDate",new Date)}),m("#wc-memberships-user-membership-notes").on("click","a.js-add-note",function(e){if(e.preventDefault(),e=m("textarea#user-membership-note").val())return m("#wc-memberships-user-membership-notes").block({message:null,overlayCSS:l}),e={action:"wc_memberships_add_user_membership_note",post_id:m("#post_ID").val(),note:e,notify:m("#note-notify").is(":checked"),security:u.add_user_membership_note_nonce},m.post(u.ajax_url,e,function(e){e=m(e);return m("ul.wc-user-membership-notes").prepend(e.find("#notes").html()),m("ul.wc-user-membership-recent-activity").prepend(e.find("#recent-activity").html()),m("#wc-memberships-user-membership-notes").unblock(),m("textarea#user-membership-note").val(""),m("#note-notify").prop("checked",!1)})}).on("click","a.js-delete-note",function(e){var i;return e.preventDefault(),i=m(this).closest("li.note"),m(i).block({message:null,overlayCSS:l}),e={action:"wc_memberships_delete_user_membership_note",note_id:m(i).attr("rel"),security:u.delete_user_membership_note_nonce},m.post(u.ajax_url,e,function(e){return m(i).remove()})}),a=!1,window.WC_Memberships_Modal_View_Profile_Fields_Confirm_Editing=WC_Memberships_Modal_View.extend({template_id:"wc-memberships-modal-edit-member-profile-fields",initialize:function(e){return WC_Memberships_Modal_View_Profile_Fields_Confirm_Editing.__super__.initialize.apply(this,arguments),m("#wc-memberships-modal-edit-member-profile-fields").on("click","#btn-ok",function(e){return"form"===a?(a=!1,m("form#post").submit()):"meta-box"===a?(a=!1,m("#save-profile-fields").trigger("click")):void 0})}}),(i=m("#wc-memberships-user-membership-profile-fields")).on("click","#edit-profile-fields",function(e){return e.preventDefault(),(e=m("[data-editable-by=customer]")).length&&(e.on("change",function(e){return a="form"}),m("form#post").submit(function(e){if(!1!==a)return e.preventDefault(),new window.WC_Memberships_Modal_View_Profile_Fields_Confirm_Editing})),m(".wc-memberships-profile-field-value").toggle(),m(".wc-memberships-profile-field-input").toggle(),m("#edit-profile-fields").hide()}),m("#save-profile-fields").on("click",function(e){var t,r;if(e.preventDefault(),i.find(".wc-memberships-profile-field-error").remove(),!1===a)return i.block({message:null,overlayCSS:l}),t=[],r={action:"wc_memberships_save_profile_fields",security:u.save_profile_fields_nonce,user_membership_id:m("#post_ID").val(),profile_fields:[]},i.find("input[data-slug], textarea[data-slug], select[data-slug]").each(function(){var e=m(this).data("slug"),i=[];if(e&&-1===m.inArray(e,t)&&(!m(this).is(":hidden")||"file"===m(this).data("field-type")))return m(this).is("input:radio")?i=m(this).closest(".wc-memberships-profile-field-input").find("input:checked").val():m(this).is("input:checkbox")?m(this).closest("fieldset").find('input[type="checkbox"]:checked').each(function(){return i.push(m(this).val())}):i=m(this).val(),r.profile_fields.push({slug:e,value:i}),t.push(e)}),m.post(u.ajax_url,r,function(e){return!e.success&&e.data&&e.data.errors?m(e.data.errors).each(function(){return m('[data-slug="'+this.slug+'"]').after('<span class="wc-memberships-profile-field-error">'+this.error+"</span>")}):(e.success&&e.data&&e.data.updated&&m(e.data.updated).each(function(){return i.find("span[data-profile-field="+this.slug+"]").html(this.formatted_value)}),i.find(".wc-memberships-profile-field-value").each(function(){return m(this).show(),m(this).next().hide()}),m("#edit-profile-fields").show(),m("#save-profile-fields").hide())}).always(function(){return i.unblock()});a="meta-box",new window.WC_Memberships_Modal_View_Profile_Fields_Confirm_Editing}),f=m("ul.wc-memberships-user-membership-advanced-filters-list"),s=m('input[name="profile_fields"'),u.initializeProfileFieldFilter=function(c){var p=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"is",d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"";return c.find(".wc-memberships-filter-slug").on("change",function(e){var i,t=c.find(".wc-memberships-filter-text-entry"),r=c.find(".wc-memberships-filter-select-entry-wrapper"),s=c.find(".wc-memberships-filter-select-entry"),n=c.find(".wc-memberships-filter-comparator"),l=[],a=m(this).find("option:selected").attr("data-type"),o=m(this).find("option:selected").val();return l="text"===a||"textarea"===a||"file"===a?(i="text",[{value:"is",label:u.i18n.profile_field_filter_comparators.is},{value:"is_not",label:u.i18n.profile_field_filter_comparators.is_not},{value:"includes",label:u.i18n.profile_field_filter_comparators.includes},{value:"doesnt_include",label:u.i18n.profile_field_filter_comparators.doesnt_include},{value:"is_empty",label:u.i18n.profile_field_filter_comparators.is_empty}]):"select"===a||"multiselect"===a||"multicheckbox"===a||"radio"===a?(i="select",[{value:"is",label:u.i18n.profile_field_filter_comparators.is},{value:"is_not",label:u.i18n.profile_field_filter_comparators.is_not}]):(i="select",[{value:"is",label:u.i18n.profile_field_filter_comparators.is}]),n.find("option").remove(),l.forEach(function(e){return n.append(new Option(e.label,e.value))}),n.val(p),n.prop("disabled",void 0===a||"checkbox"===a),t.prop("disabled",void 0===a||"text"!==i||"is_empty"===n.val()),n.on("change",function(e){if("is_empty"===m(this).val()?t.prop("disabled",!0):t.prop("disabled",!1),"checkbox"===a)return m(this).val("is")}).trigger("change"),"select"===i?(u.populateFilterOptions(a,s,o),t.hide(),s.val(d),r.show()):(t.val(d).show(),s.val(""),r.hide()),f.trigger("change"),t.on("change keyup",function(e){return f.trigger("change")}),s.on("change",function(e){return f.trigger("change")})}).trigger("change"),c.find(".wc-memberships-filter-remove-row").on("click",function(e){return c.remove(),f.trigger("change"),u.controlClearAllFiltersButtonVisibility()})},u.populateFilterOptions=function(e,i,t){var r;return i.find("option").remove(),r=u.i18n.profile_field_filter_placeholder_single,"checkbox"===e?(i.removeAttr("multiple"),i.append(new Option(u.i18n.profile_field_filter_checkbox.yes,"yes")),i.append(new Option(u.i18n.profile_field_filter_checkbox.no,"no"))):(t=t.replace("-","_"),u.profile_field_definitions_options[t]&&u.profile_field_definitions_options[t].length&&(u.profile_field_definitions_options[t].forEach(function(e){return i.append(new Option(e,e))}),i.attr("multiple","multiple"),r=u.i18n.profile_field_filter_placeholder_multiple)),i.val(null).trigger("change").select2({placeholder:r,dropdownCssClass:"wc-memberships-profile-field-filter-dropdown"})},u.controlClearAllFiltersButtonVisibility=function(){var e=m(".wc-memberships-user-memberships-advanced-filters-clear");return m(".wc-memberships-user-membership-advanced-filters-list-item:visible").length?e.show():e.hide()},n=0,f.find("> li").not("#wc-memberships-user-membership-advanced-filter-template").each(function(){var e=m(this),i=e.find(".wc-memberships-filter-slug option:selected").data("type"),t=e.find(".wc-memberships-filter-comparator").val(),i=(-1!==m.inArray(i,["text","textarea","file"])?e.find(".wc-memberships-filter-text-entry"):e.find(".wc-memberships-filter-select-entry")).val();return u.initializeProfileFieldFilter(e,t,i),e.find("select").select2({dropdownCssClass:"wc-memberships-profile-field-filter-dropdown"}),++n}),m(".wc-memberships-user-memberships-advanced-filters-add-filter button").on("click",function(e){var i="wc-memberships-user-membership-advanced-filters-list-item-"+ ++n;return m("#wc-memberships-user-membership-advanced-filter-template").clone().attr("id",i).appendTo(f).find("select").select2({dropdownCssClass:"wc-memberships-profile-field-filter-dropdown"}),u.initializeProfileFieldFilter(m("#"+i)),f.trigger("change"),u.controlClearAllFiltersButtonVisibility()}),f.on("change",function(e){var r,i=m(this).find("> li").not("#wc-memberships-user-membership-advanced-filter-template"),t=m(".wc-memberships-user-memberships-advanced-filters-footer button");if(i&&0!==i.length)return r={operand:m('select[name="profile_fields_operand"]').val(),rules:[]},i.each(function(){var e=m(this).find("select.wc-memberships-filter-slug"),i=m(this).find("select.wc-memberships-filter-comparator").val(),t=e.find("option:selected").data("type"),e=e.val(),t=""===t?"":(-1!==m.inArray(t,["text","textarea","file"])?m(this).find(".wc-memberships-filter-text-entry"):m(this).find(".wc-memberships-filter-select-entry")).val();return r.rules.push({slug:e,value:t,comparator:i})}),s.val(JSON.stringify(r)),t.prop("disabled",!1),t.not(":disabled").on("click",function(e){return m("#post-query-submit").trigger("click")});s.val(""),t.prop("disabled",!0)}).trigger("change")),m("form#posts-filter").submit(function(e){return m(".wc-memberships-filter-select-entry-wrapper:visible").find("select").each(function(){if(0===m(this).find(":selected").length)return m(this).closest("li.wc-memberships-user-membership-advanced-filters-list-item").remove()}),f.trigger("change")}),u.controlClearAllFiltersButtonVisibility()})}.call(void 0);