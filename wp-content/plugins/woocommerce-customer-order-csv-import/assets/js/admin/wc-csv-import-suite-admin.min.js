"use strict";(function(){jQuery(document).ready(function(d){var m=function(t){return d.get(ajaxurl,{action:"wc_plugin_framework_csv_import_suite_dismiss_notice",messageid:"wc_csv_import_suite_finished_"+t})};return wc_csv_import_suite.draw_results_chart=function(t){var e,s=[];if(wc_csv_import_suite.status_counts&&(e=d(".chart-placeholder.import-results")).length)return d.each(wc_csv_import_suite.status_counts,function(t,e){return s.push({label:wc_csv_import_suite.chart_legends[t].title,color:wc_csv_import_suite.chart_legends[t].color,data:e})}),"undefined"!==t&&s[t]&&(s[t].color="#9c5d90"),d.plot(e,s,{grid:{hoverable:!0},series:{pie:{show:!0,radius:1,innerRadius:.6,label:{show:!1}},enable_tooltip:!0,append_tooltip:wc_csv_import_suite.i18n.chart_tooltip.replace("%s","")},legend:{show:!1}})},wc_csv_import_suite.display_import_progress=function(c){var o,t=wc_csv_import_suite.results?Object.keys(wc_csv_import_suite.results):[],u=t?t.length:0,n=t.length?Number(t.pop()):0,_=wc_csv_import_suite.file_size,a=(wc_csv_import_suite.progress,0),l=!1,p=!1,e={action:"wc_csv_import_suite_get_progress",security:wc_csv_import_suite.progress_nonce,job_id:c},v={bar:d("#wc-csv-import-suite-progress .bar"),count:d("#wc-csv-import-suite-progress .processed-count"),percentage:d("#wc-csv-import-suite-progress .percentage"),results:d("#wc-csv-import-suite-results")};return o=setInterval(function(){if(!l)return l=!0,e.results_from=n+1,d.get(ajaxurl,e).done(function(t){var e,i,s,r;return"string"==typeof t?(i=wc_csv_import_suite.i18n.unexpected_error_message,d(".wrap h2:first").after('<div class="notice notice-error"><p>'+i+"</p></div>"),clearInterval(o)):(a=t.progress||0,s=Math.round(a/_*100),t.results&&(n=Number(Object.keys(t.results).pop()),d.each(t.results,function(t,e){var s;if(!v.results.find("tr.line-"+t).length)return s=d("<span />").text(e.status).text(),i=d("<span />").text(e.message).text(),wc_csv_import_suite.status_counts[s]++,u++,v.results.find("li."+s+" .amount").text(wc_csv_import_suite.status_counts[s]),"skipped"!==s&&"failed"!==s||(v.results.find(".results-details > tbody").append('<tr class="line-'+t+" "+s+'"><td>'+t+"</td><td>"+wc_csv_import_suite.chart_legends[s].label+"</td><td>"+i+"</td></tr>"),p)?void 0:(v.results.find(".js-wc-csv-import-suite-results-details-link-widget").show(),p=!0)})),v.count.text(u),v.percentage.text(s+" %"),v.bar.css("width",s+"%"),wc_csv_import_suite.draw_results_chart(),l=!1,_<=a?(clearInterval(o),e=(r=wc_csv_import_suite.status_counts.failed||wc_csv_import_suite.status_counts.skipped)?"notice-warning":"notice-success",i=wc_csv_import_suite.i18n.import_complete,r&&(i+=" "+wc_csv_import_suite.i18n.skipped_or_failed_lines),d("h2:first").after('<div class="notice '+e+'"><p>'+i+"</p></div>"),d(".notice-dry-run p").html(wc_csv_import_suite.i18n.dry_run_complete),d(".progress-bar .js-spinner").fadeOut(),d(".js-notice-safe-to-leave-screen").remove(),m(c)):void 0)}).fail(function(t,e,s){var i=wc_csv_import_suite.i18n.unexpected_error_message;return d(".wrap h2:first").after('<div class="notice notice-error"><p>'+i+"</p></div>")})},1e3)},d(".js-wc-csv-import-suite-toggle-results-details").click(function(t){var e;return t.preventDefault(),d("#wc-csv-import-suite-results").find(".results-details").toggle(),e=d("#wc-csv-import-suite-results").find(".results-details").is(":visible"),d(this).find(".js-wc-csv-import-suite-toggle-results-details-text").text(e?wc_csv_import_suite.i18n.hide_details:wc_csv_import_suite.i18n.show_details)}),d(".js-wc-csv-import-suite-highlight-series").hover(function(){return wc_csv_import_suite.draw_results_chart(d(this).data("series"))},function(){return wc_csv_import_suite.draw_results_chart()}),d(window).resize(function(){var t;return clearTimeout(t),t=setTimeout(function(){return t=null,wc_csv_import_suite.draw_results_chart()},100)}),d("body").on("click","input.js-wc-csv-import-suite-merge",function(t){var e=d(this).is(":checked")?"show":"hide";return d("#wc-csv-import-suite-insert-non-matching").closest("tr")[e]()}),d("body").on("change","select.js-wc-csv-import-suite-delimiter",function(t){var e,s=d(this).val();return d(".wc-csv-import-suite-preview-container").block({message:null,overlayCSS:{opacity:.3}}),e={action:"wc_csv_import_suite_get_preview",security:wc_csv_import_suite.preview_nonce,delimiter:s,file:d(".js-wc-csv-import-suite-file").val()},d.get(ajaxurl,e,function(t){return d("#wc-csv-import-suite-preview").html(t),d(".wc-csv-import-suite-preview-container").unblock()})})})}).call(void 0);