!function(l){var i,n=window.GetDiscount;function o(t,r,n,o){var a,e=null==(a=o)||"number"==typeof a||"boolean"==typeof a?o:n(o),i=r.get(e);return void 0===i&&(i=t.call(this,o),r.set(e,i)),i}function a(t,r,n){var o=Array.prototype.slice.call(arguments,3),a=n(o),e=r.get(a);return void 0===e&&(e=t.apply(this,o),r.set(a,e)),e}function e(t,r,n,o,a){return n.bind(r,t,o,a)}function t(t,r){return e(t,this,1===t.length?o:a,r.cache.create(),r.serializer)}function r(){return JSON.stringify(arguments)}function u(){this.cache=Object.create(null)}window.GetDiscount=function(){for(var t=arguments.callee.caller;"PopulateDiscountInfo"!==t.name&&"function"==typeof t.caller;)t=t.caller;"PopulateDiscountInfo"===t.name&&(i=t.arguments[1]);var r=n.apply(this,arguments);return i=void 0,r},u.prototype.has=function(t){return t in this.cache},u.prototype.get=function(t){return this.cache[t]},u.prototype.set=function(t,r){this.cache[t]=r};var c={create:function(){return new u}};function d(t){t=function(t,r){for(key in r)r.hasOwnProperty(key)&&void 0===t[key]&&(t[key]=r[key]);return t}(t,{intent:"",total:0,formId:null,amount:null,amountType:null,products:null,productsType:null,includeShipping:!0,includeDiscounts:!1,calculateByProduct:!1});var r,n=0,o=l.isArray(t.products)&&0<t.products.length?m(t.formId,t.products,t.includeDiscounts):0;switch(t.amount||(t.amount=0),t.includeShipping||(t.total-=(r=t.formId,gformGetShippingPrice(r))),t.productsType){case"include":t.total=o;break;case"exclude":t.total-=o}switch(t.amountType){case null:n=t.total;break;case"percent":n=t.total*(t.amount/100);break;default:var a=t.amount;if(t.calculateByProduct){var e=h(t.formId);a*=100*t.total/e/100}n=a}return n=Math.max(0,parseFloat(n))}gform.addFilter("gform_calculation_formula",function(t,r,n,o){if(!I(t))return t;var a=l("#field_{0}_{1}".format(n,r.field_id)).hasClass("gfield_price");if(a&&(!window._gformPriceFields||!window._gformPriceFields.length))return t=(t=(t=t.replace(/{coupons}/gi,0)).replace(/{discounts}/gi,0)).replace(/{subtotal}/gi,0);var e=""!=(gformIsHidden(l("#gf_coupon_code_"+n))?"":l("#gf_coupon_codes_"+n).val())||""!=l("#gf_coupons_"+n).val(),i=l("#gf_total_no_discount_"+n).val(),u=0,c=-1*v(n,h(n));return void 0!==i&&e&&window.PopulateDiscountInfo&&(u=PopulateDiscountInfo(i,n)),t=(t=(t=t.replace(/{coupons}/gi,parseFloat(u))).replace(/{discounts}/gi,parseFloat(c+u))).replace(/{subtotal}/gi,parseFloat(h(n,a?[r.field_id]:null)))}),gform.addFilter("gform_coupons_discount_amount",function(t,r,n,o,a){if(!i)return t;var e=gformGetShippingPrice(i);o=Math.max(0,o-e);return"percentage"==r?t=o*Number(n/100):"flat"==r&&o<(t=Number(n))&&(t=o),t}),gform.addFilter("gform_product_total",function(n,o){return l("#gform_wrapper_"+o+" .ginput_subtotal_input").each(function(){var t=l(this).val();if(gformIsHidden(l(this)))return 0!==t&&"0"!==t&&l(this).val(0).change(),!0;var r=d({intent:"Calculating subtotal for Subtotal field {0}".format(l(this).attr("id")),total:n,formId:o,amount:null,amountType:null,productsType:l(this).data("productstype"),products:l(this).data("products"),includeShipping:!1});String(t)!=String(r)&&l(this).val(r).change()}),n},48),gform.addFilter("gform_product_total",function(t,r){return t+=v(r,t),Math.max(0,t)},49),"true"===window.GPECF.ppcpRequiresDiscountFilter&&gform.addFilter("gform_ppcp_discount_total",function(t,r){return t+-1*v(r,h(r))}),gform.addFilter("gform_product_total",function(n,o){var t=l("#gform_wrapper_"+o+" .ginput_tax_input"),a=0;return t.each(function(){var t,r=l(this).val();if(gformIsHidden(l(this)))return 0!==r&&"0"!==r&&l(this).val(0).change(),!0;t=0==n&&"exclude"===l(this).data("productstype")?0:d({intent:"Calculating tax for Tax field {0}".format(l(this).attr("id")),total:n,formId:o,amount:l(this).data("amount"),amountType:l(this).data("amounttype"),products:l(this).data("products"),productsType:l(this).data("productstype"),includeDiscounts:!0}),String(r)!==String(t)&&l(this).val(t).change(),a+=F(t,2)}),F(n+=a,2)},51),gform.addFilter("gform_product_total",function(t,r){var n=l("#gf_coupon_codes_{0}".format(r));return n.data("gpecfChanged")&&(n.data("gpecfChanged",!1),l(document).trigger("gform_post_conditional_logic")),t}),l(document).on("gform_post_render",function(t,r){var i;!function(){if(window.gform){var t=window.gform.hooks.filter.gform_product_total;for(var r in t)t.hasOwnProperty(r)&&-1!==t[r].callable.toString().indexOf("update_dynamic_price_ajax")&&(t[r].priority=52)}}(),l("#gf_coupon_codes_{0}".format(r)).change(function(){l(this).data("gpecfChanged",!0)}),l(document).on("gform_price_change",function(t,r,n){w(r.formId)}),gform.addAction("gpcp_after_update_pricing",function(t,r){w(r._formId)}),gform.addAction("gform_input_change",function(t,r,n){if(window!==t){var o=l(t),a=o.attr("id")&&0===o.attr("id").indexOf("ginput_base_price"),e=o.parents(".gfield").hasClass("gfield_calculation");l(t).data("gpecfIsCalculating")||a&&e&&(l(t).data("gpecfIsCalculating",!0),i&&(clearTimeout(i),i=void 0),i=setTimeout(function(){w(r),l(t).data("gpecfIsCalculating",!1)},5))}});var n=setInterval(function(){window._gformPriceFields&&window._gformPriceFields[r]&&(w(r),clearInterval(n))});l("#gform_wrapper_"+r).find(".ginput_subtotal_input, .ginput_discount_input, .ginput_tax_input").change()});var f,s,p,g,m=function(t,r,n){return window._gformPriceFields&&window._gformPriceFields[t]?_(parseInt(t),r,n,jQuery("form#gform_"+t).serializeArray()):0},_=(f=function(t,r,n,o){if(void 0===r&&window._gformPriceFields?r=_gformPriceFields[t]:l.isArray(r)||(r=[r]),!r)return 0;for(var a=0,e=0;e<r.length;e++){var i=gformCalculateProductPrice(t,r[e]);if(a+=i,n)a-=Math.abs(v(t,i,r[e]))+(jQuery("#gf_coupons_"+t).val()?y(t,i):0)}return a},p=s&&s.cache?s.cache:c,g=s&&s.serializer?s.serializer:r,(s&&s.strategy?s.strategy:t)(f,{cache:p,serializer:g}));function h(t,r){return m(t)-(void 0!==r&&r?m(t,r):0)}function v(e,i,u){var t=l("#gform_wrapper_"+e+" .ginput_discount_input"),c=0;return t.each(function(){var t=l(this).val(),r=l(this).data("products"),n=l(this).data("productstype");if(gformIsHidden(l(this)))return 0!==t&&"0"!==t&&l(this).val(0).change(),!0;if(u&&r){if("include"==n&&(-1===l.inArray(u,r)||0===parseInt(i)))return!0;if("exclude"==n&&(-1!==l.inArray(u,r)||0===parseInt(i)))return!0}var o=u&&0<u,a=d({intent:"Calculating discount for Discount field {0}".format(l(this).attr("id")),total:i,formId:e,amount:l(this).data("amount"),amountType:l(this).data("amounttype"),products:r,productsType:n,includeShipping:!1,calculateByProduct:o});"include"===n&&0<r.length&&(a=Math.min(m(e,r,!1),a)),a*=-1,a=gform.applyFilters("gpecf_discount_total",a,l(this)),o||String(t)===String(a)||l(this).val(a).change(),c+=a}),c}function y(t,r){var n,o,a=window["gf_coupons"+t],e=0;for(n in a)a.hasOwnProperty(n)&&(o=a[n],e+=GetDiscount(o.type,o.amount,r,e));return e}var w=function(t){var r=rgars(window,"gf_global/gfcalc/{0}".format(t));if(r){for(var n=[],o=0;o<r.formulaFields.length;o++){var a=r.formulaFields[o];I(a.formula)&&n.push(a)}n.length&&r.runCalcs(t,n)}};function I(t){var r=-1!=t.search("{coupons}"),n=-1!=t.search("{discounts}"),o=-1!=t.search("{subtotal}");return r||n||o}function F(t,r){return Number(Math.round(t+"e"+r)+"e-"+r)}}(jQuery);
//# sourceMappingURL=gp-ecommerce-fields.js.map