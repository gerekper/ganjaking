!function(d,s){d(function(){function e(){d("#wc-photography-image-edit .postbox").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})}function o(){d("#wc-photography-image-edit .postbox").unblock()}function p(a){(a=a||d(".wc-photography-collections-select")).trigger("change.select2"),a=d(a).filter(":not(.enhanced)");var e={placeholder:WCPhotographyBatchUploadParams.search_placeholder,minimumInputLength:2,multiple:!0,ajax:{url:WCPhotographyBatchUploadParams.ajax_url,dataType:"json",quietMillis:200,data:function(a){return{term:a.term,action:"wc_photography_search_collections",security:WCPhotographyBatchUploadParams.search_collections_nonce}},processResults:function(a){return{results:a}}}};a.select2(e).addClass("enhanced")}d("#wc-photography-uploader .drag-drop-inside").append('<div class="wc-photography-progress-bar"><div></div></div>'),p();var l=1,a=new plupload.Uploader(WCPhotographyBatchUploadParams.plupload),r=d("#wc-photography-uploader .wc-photography-progress-bar"),t=d("#wc-photography-uploader .wc-photography-progress-bar div"),c=d("#wc-photography-uploader-output");function i(a,e,o){o=o?pluploadL10n.big_upload_queued.replace("%s",e.name)+" "+pluploadL10n.big_upload_failed.replace("%1$s",'<a class="uploader-html" href="#">').replace("%2$s","</a>"):pluploadL10n.file_exceeds_size_limit.replace("%s",e.name);d("#wc-photography-uploader-error").html('<div class="error"><p>'+o+"</p></div>"),a.removeFile(e)}a&&(a.bind("init",function(a){var e=d("#wc-photography-uploader-upload-ui");a.features.dragdrop&&!d(document.body).hasClass("mobile")?(e.addClass("drag-drop"),d("#wc-photography-drag-drop-area").on("dragover.wp-uploader",function(){e.addClass("drag-over")}).on("dragleave.wp-uploader, drop.wp-uploader",function(){e.removeClass("drag-over")})):(e.removeClass("drag-drop"),d("#wc-photography-drag-drop-area").off(".wp-uploader")),"html4"===a.runtime&&d(".upload-flash-bypass").hide()}),a.init(),a.bind("filesAdded",function(e,a){var o=104857600,t=parseInt(e.settings.max_file_size,10);d("#wc-photography-uploader-error").html(""),d("#wc-photography-uploader .form-table :input").prop("disabled",!0),d(r).show().css("display","block"),plupload.each(a,function(a){o<t&&a.size>o&&"html5"!==e.runtime&&i(e,a,!0)}),e.refresh(),e.start()}),a.bind("uploadProgress",function(a){d(t).css("width",a.total.percent+"%")}),a.bind("fileUploaded",function(a,e,o){var t=d("#wc-photography-batch-collection").select2("data"),r=[];t.forEach(function(a){r.push(a.id)}),r=r.join(","),d.ajax({url:WCPhotographyBatchUploadParams.ajax_url,data:{action:"wc_photography_batch_upload",security:WCPhotographyBatchUploadParams.batch_upload_nonce,image_id:o.response,sku_pattern:d("#wc-photography-batch-sku").val(),price:accounting.unformat(d("#wc-photography-batch-price").val(),woocommerce_admin.mon_decimal_point),collections:r},type:"POST",dataType:"json",success:function(a){d(c).append(a);var e=s.template(d("script#wc-photography-image-template").html());a.index=l,d("#wc-photography-image-edit .wc-metaboxes").append(e(a)),p(),l++}})}),a.bind("uploadComplete",function(){d(r).hide().css("display","none"),d(t).removeAttr("style"),d("#wc-photography-image-edit").css("display","block"),d("#wc-photography-uploader .form-table :input").prop("disabled",!1)}),a.bind("error",function(a,e){var o=104857600,t=d("#wc-photography-uploader-error");switch(e.code){case plupload.FAILED:case plupload.FILE_EXTENSION_ERROR:t.html('<p class="error">'+pluploadL10n.upload_failed+"</p>");break;case plupload.FILE_SIZE_ERROR:i(a,e.file);break;case plupload.IMAGE_FORMAT_ERROR:wpFileError(a,pluploadL10n.not_an_image);break;case plupload.IMAGE_MEMORY_ERROR:wpFileError(a,pluploadL10n.image_memory_exceeded);break;case plupload.IMAGE_DIMENSIONS_ERROR:wpFileError(a,pluploadL10n.image_dimensions_exceeded);break;case plupload.GENERIC_ERROR:wpQueueError(pluploadL10n.upload_failed);break;case plupload.IO_ERROR:o<parseInt(plupload.settings.max_file_size,10)&&a.size>o?wpFileError(a,pluploadL10n.big_upload_failed.replace("%1$s",'<a class="uploader-html" href="#">').replace("%2$s","</a>")):wpQueueError(pluploadL10n.io_error);break;case plupload.HTTP_ERROR:wpQueueError(pluploadL10n.http_error);break;case plupload.INIT_ERROR:d(".media-upload-form").addClass("html-uploader");break;case plupload.SECURITY_ERROR:wpQueueError(pluploadL10n.security_error);break;default:wpFileError(a,pluploadL10n.default_error)}a.refresh()}),d(".wc-metaboxes-wrapper").on("click",".wc-metabox h3",function(){d(this).next(".wc-metabox-content").toggle()}).on("click",".expand_all",function(){return d(this).closest(".wc-metaboxes-wrapper").find(".wc-metabox > .wc-metabox-content").show(),!1}).on("click",".close_all",function(){return d(this).closest(".wc-metaboxes-wrapper").find(".wc-metabox > .wc-metabox-content").hide(),!1}),d(".wc-metabox.closed").each(function(){d(this).find(".wc-metabox-content").hide()}),d("body").on("click","#wc-photography-image-edit .wc-metabox .remove",function(){var a=d(this).closest(".wc-metabox");return e(),d.ajax({url:WCPhotographyBatchUploadParams.ajax_url,data:{action:"wc_photography_delete_image",security:WCPhotographyBatchUploadParams.delete_image_nonce,id:a.attr("data-id")},type:"POST",success:function(){a.remove(),0===d("#wc-photography-image-edit .wc-metabox").length&&d("#wc-photography-image-edit").hide(),o()}}),!1}).on("click","#wc-photography-image-edit .submit .button",function(){var a=d("#wc-photography-image-edit .wc-metaboxes :input").serialize();return e(),d.ajax({url:WCPhotographyBatchUploadParams.ajax_url,data:{action:"wc_photography_save_images",security:WCPhotographyBatchUploadParams.save_images_nonce,images:a},type:"POST",success:function(){var a=d("#wc-photography-image-edit");d("div.updated",a).remove(),a.prepend('<div class="updated"><p>'+WCPhotographyBatchUploadParams.edit_success_message+"</p></div>"),d("html, body").animate({scrollTop:a.offset().top-100},500),o()}}),!1}).on("keyup","#wc-photography-image-edit .sku-field",function(){var a=d(this).closest(".wc-metabox"),e=a.attr("data-index");d(".image-name",a).html(e+". "+d(this).val())}).on("click",".photography-add-collection a",function(){return d(this).next(".fields").toggle(),!1}).on("click",".photography-add-collection .button",function(){var o=d(this),a=o.closest(".collection-form-field"),t=d("input.new-collection",a),a=t.val();return""===a?t.trigger("focus"):(t.prop("disabled",!0),o.prop("disabled",!0).next(".message").remove(),o.after(' <i class="loading">'+WCPhotographyBatchUploadParams.loading+"</i>"),d.ajax({url:WCPhotographyBatchUploadParams.ajax_url,data:{action:"wc_photography_add_collection",security:WCPhotographyBatchUploadParams.add_collection_nonce,name:a},type:"POST",dataType:"json",success:function(a){var e;t.val(""),t.prop("disabled",!1),o.prop("disabled",!1).next(".loading").remove(),a.success?(e=d(".wc-photography-collections-select"),(a=new Option(a.data.text,a.data.id)).selected=!0,e.append(a)):o.after('<div class="error inline message">'+WCPhotographyBatchUploadParams.collection_error+"</div>")}})),!1}).on("select2-selecting",".wc-photography-collections-select",function(a){var e=d(this).prev(".wc-photography-collections-select"),o=[];d(".selected-option",e).each(function(a,e){e=d(e);o.push({id:e.attr("data-id"),text:e.text()})}),o.push({id:a.choice.id,text:a.choice.text}),d(this).attr("data-selected",JSON.stringify(o))}).on("select2-removed",".wc-photography-collections-select",function(){var a=d(this).prev(".wc-photography-collections-select"),o=[];d(".selected-option",a).each(function(a,e){e=d(e);o.push({id:e.attr("data-id"),text:e.text()})}),d(this).attr("data-selected",JSON.stringify(o))}))})}(jQuery,_);