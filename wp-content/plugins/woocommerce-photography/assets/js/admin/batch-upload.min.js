!function(s,d){s(function(){var p=1;function e(){var a="";WCPhotographyBatchUploadParams.ajax_loading_image&&(a=" url("+WCPhotographyBatchUploadParams.ajax_loading_image+") no-repeat center"),s("#wc-photography-image-edit .postbox").block({message:null,overlayCSS:{background:"#fff"+a,opacity:.6}})}function o(){s("#wc-photography-image-edit .postbox").unblock()}function i(a){(a=a||s(".wc-photography-collections-select")).trigger("change.select2"),a=s(a).filter(":not(.enhanced)");var e={placeholder:WCPhotographyBatchUploadParams.search_placeholder,minimumInputLength:2,multiple:!0,ajax:{url:WCPhotographyBatchUploadParams.ajax_url,dataType:"json",quietMillis:200,data:function(a){return{term:WCPhotographyBatchUploadParams.isLessThanWC30?a:a.term,action:"wc_photography_search_collections",security:WCPhotographyBatchUploadParams.search_collections_nonce}},processResults:function(a){return{results:a}}}};WCPhotographyBatchUploadParams.isLessThanWC30&&(e.initSelection=function(a,e){return e(JSON.parse(a.attr("data-selected")))},e.formatSelection=function(a){return'<div class="selected-option" data-id="'+a.id+'">'+a.text+"</div>"},e.ajax.results=e.ajax.processResults),a.select2(e).addClass("enhanced")}s("#wc-photography-uploader .drag-drop-inside").append('<div class="wc-photography-progress-bar"><div></div></div>'),i();var a=new plupload.Uploader(WCPhotographyBatchUploadParams.plupload),r=s("#wc-photography-uploader .wc-photography-progress-bar"),t=s("#wc-photography-uploader .wc-photography-progress-bar div"),l=s("#wc-photography-uploader-output");function c(a,e,o){var t;t=o?pluploadL10n.big_upload_queued.replace("%s",e.name)+" "+pluploadL10n.big_upload_failed.replace("%1$s",'<a class="uploader-html" href="#">').replace("%2$s","</a>"):pluploadL10n.file_exceeds_size_limit.replace("%s",e.name),s("#wc-photography-uploader-error").html('<div class="error"><p>'+t+"</p></div>"),a.removeFile(e)}a&&(a.bind("init",function(a){var e=s("#wc-photography-uploader-upload-ui");a.features.dragdrop&&!s(document.body).hasClass("mobile")?(e.addClass("drag-drop"),s("#wc-photography-drag-drop-area").on("dragover.wp-uploader",function(){e.addClass("drag-over")}).on("dragleave.wp-uploader, drop.wp-uploader",function(){e.removeClass("drag-over")})):(e.removeClass("drag-drop"),s("#wc-photography-drag-drop-area").off(".wp-uploader")),"html4"===a.runtime&&s(".upload-flash-bypass").hide()}),a.init(),a.bind("filesAdded",function(e,a){var o=104857600,t=parseInt(e.settings.max_file_size,10);s("#wc-photography-uploader-error").html(""),s("#wc-photography-uploader .form-table :input").prop("disabled",!0),s(r).show().css("display","block"),plupload.each(a,function(a){o<t&&a.size>o&&"html5"!==e.runtime&&c(e,a,!0)}),e.refresh(),e.start()}),a.bind("uploadProgress",function(a){s(t).css("width",a.total.percent+"%")}),a.bind("fileUploaded",function(a,e,o){var t=s("#wc-photography-batch-collection");if(WCPhotographyBatchUploadParams.isLessThanWC30)t=t.val();else{var r=t.select2("data");t=[],r.forEach(function(a){t.push(a.id)}),t=t.join(",")}s.ajax({url:WCPhotographyBatchUploadParams.ajax_url,data:{action:"wc_photography_batch_upload",security:WCPhotographyBatchUploadParams.batch_upload_nonce,image_id:o.response,sku_pattern:s("#wc-photography-batch-sku").val(),price:accounting.unformat(s("#wc-photography-batch-price").val(),woocommerce_admin.mon_decimal_point),collections:t},type:"POST",dataType:"json",success:function(a){s(l).append(a);var e=d.template(s("script#wc-photography-image-template").html());a.index=p,s("#wc-photography-image-edit .wc-metaboxes").append(e(a)),i(),p++}})}),a.bind("uploadComplete",function(){s(r).hide().css("display","none"),s(t).removeAttr("style"),s("#wc-photography-image-edit").css("display","block"),s("#wc-photography-uploader .form-table :input").prop("disabled",!1)}),a.bind("error",function(a,e){var o=104857600,t=s("#wc-photography-uploader-error");switch(e.code){case plupload.FAILED:case plupload.FILE_EXTENSION_ERROR:t.html('<p class="error">'+pluploadL10n.upload_failed+"</p>");break;case plupload.FILE_SIZE_ERROR:c(a,e.file);break;case plupload.IMAGE_FORMAT_ERROR:wpFileError(a,pluploadL10n.not_an_image);break;case plupload.IMAGE_MEMORY_ERROR:wpFileError(a,pluploadL10n.image_memory_exceeded);break;case plupload.IMAGE_DIMENSIONS_ERROR:wpFileError(a,pluploadL10n.image_dimensions_exceeded);break;case plupload.GENERIC_ERROR:wpQueueError(pluploadL10n.upload_failed);break;case plupload.IO_ERROR:o<parseInt(plupload.settings.max_file_size,10)&&a.size>o?wpFileError(a,pluploadL10n.big_upload_failed.replace("%1$s",'<a class="uploader-html" href="#">').replace("%2$s","</a>")):wpQueueError(pluploadL10n.io_error);break;case plupload.HTTP_ERROR:wpQueueError(pluploadL10n.http_error);break;case plupload.INIT_ERROR:s(".media-upload-form").addClass("html-uploader");break;case plupload.SECURITY_ERROR:wpQueueError(pluploadL10n.security_error);break;default:wpFileError(a,pluploadL10n.default_error)}a.refresh()}),s(".wc-metaboxes-wrapper").on("click",".wc-metabox h3",function(){s(this).next(".wc-metabox-content").toggle()}).on("click",".expand_all",function(){return s(this).closest(".wc-metaboxes-wrapper").find(".wc-metabox > .wc-metabox-content").show(),!1}).on("click",".close_all",function(){return s(this).closest(".wc-metaboxes-wrapper").find(".wc-metabox > .wc-metabox-content").hide(),!1}),s(".wc-metabox.closed").each(function(){s(this).find(".wc-metabox-content").hide()}),s("body").on("click","#wc-photography-image-edit .wc-metabox .remove",function(){var a=s(this).closest(".wc-metabox");return e(),s.ajax({url:WCPhotographyBatchUploadParams.ajax_url,data:{action:"wc_photography_delete_image",security:WCPhotographyBatchUploadParams.delete_image_nonce,id:a.attr("data-id")},type:"POST",success:function(){a.remove(),0===s("#wc-photography-image-edit .wc-metabox").length&&s("#wc-photography-image-edit").hide(),o()}}),!1}).on("click","#wc-photography-image-edit .submit .button",function(){var a=s("#wc-photography-image-edit .wc-metaboxes :input").serialize();return e(),s.ajax({url:WCPhotographyBatchUploadParams.ajax_url,data:{action:"wc_photography_save_images",security:WCPhotographyBatchUploadParams.save_images_nonce,images:a},type:"POST",success:function(){var a=s("#wc-photography-image-edit");s("div.updated",a).remove(),a.prepend('<div class="updated"><p>'+WCPhotographyBatchUploadParams.edit_success_message+"</p></div>"),s("html, body").animate({scrollTop:a.offset().top-100},500),o()}}),!1}).on("keyup","#wc-photography-image-edit .sku-field",function(){var a=s(this).closest(".wc-metabox"),e=a.attr("data-index");s(".image-name",a).html(e+". "+s(this).val())}).on("click",".photography-add-collection a",function(){return s(this).next(".fields").toggle(),!1}).on("click",".photography-add-collection .button",function(){var p=s(this),l=p.closest(".collection-form-field"),c=s("input.new-collection",l),a=c.val();return""===a?c.trigger("focus"):(c.prop("disabled",!0),p.prop("disabled",!0).next(".message").remove(),p.after(' <i class="loading">'+WCPhotographyBatchUploadParams.loading+"</i>"),s.ajax({url:WCPhotographyBatchUploadParams.ajax_url,data:{action:"wc_photography_add_collection",security:WCPhotographyBatchUploadParams.add_collection_nonce,name:a},type:"POST",dataType:"json",success:function(a){if(c.val(""),c.prop("disabled",!1),p.prop("disabled",!1).next(".loading").remove(),a.success)if(WCPhotographyBatchUploadParams.isLessThanWC30){var e=s("input.wc-photography-collections-select",l),t=[],r=[];s(".selected-option",l).each(function(a,e){var o=s(e);t.push({id:o.attr("data-id"),text:o.text()}),r.push(o.attr("data-id"))}),t.push(a.data),r.push(a.data.id),e.attr("data-selected",JSON.stringify(t)).val(r.toString()),i(e),s(".fields",l).toggle()}else{e=s(".wc-photography-collections-select");var o=new Option(a.data.text,a.data.id);o.selected=!0,e.append(o)}else p.after('<div class="error inline message">'+WCPhotographyBatchUploadParams.collection_error+"</div>")}})),!1}).on("select2-selecting",".wc-photography-collections-select",function(a){var e=s(this).prev(".wc-photography-collections-select"),t=[];s(".selected-option",e).each(function(a,e){var o=s(e);t.push({id:o.attr("data-id"),text:o.text()})}),t.push({id:a.choice.id,text:a.choice.text}),s(this).attr("data-selected",JSON.stringify(t))}).on("select2-removed",".wc-photography-collections-select",function(){var a=s(this).prev(".wc-photography-collections-select"),t=[];s(".selected-option",a).each(function(a,e){var o=s(e);t.push({id:o.attr("data-id"),text:o.text()})}),s(this).attr("data-selected",JSON.stringify(t))}))})}(jQuery,_);
