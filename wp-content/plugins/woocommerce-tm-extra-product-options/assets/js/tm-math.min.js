!function(s){"use strict";function c(t){for(var r,n=[void 0,null,!1,0,"","0"],e=0,a=n.length;e<a;e++)if(t===n[e])return 1;if("object"==typeof t){for(r in t)if(t.hasOwnProperty(r))return;return 1}}function f(t,r){return!(!r||r.constructor!==Array&&r.constructor!==Object)&&t in r}function l(t){return{}.toString.call(t).split(" ")[1].slice(0,-1).toLowerCase()}function h(t,r){var n;return"string"!=typeof t&&"number"!=typeof t||isNaN(t)?void 0!==r?r:0:(n=parseFloat(t),isNaN(n)?void 0!==r?r:t:n)}function n(t,r){return t===r?0:r<t?1:-1}function t(t){return t=(t+"").replace(/[^01]/gi,""),parseInt(t,2)}function r(t){return t<0&&(t=4294967295+t+1),parseInt(t,10).toString(2)}function e(t){return t<0&&(t=4294967295+t+1),parseInt(t,10).toString(16)}function a(t){return t<0&&(t=4294967295+t+1),parseInt(t,10).toString(8)}function i(t){return.017453292519943295*t}function o(t,r=0){var n=0<=t?1:-1;return 0===r?Math.round(t):parseFloat((Math.round(t*Math.pow(10,r)+1e-4*n)/Math.pow(10,r)).toFixed(r))}function _(t){return t=(t+"").replace(/[^a-f0-9]/gi,""),parseInt(t,16)}function p(t){return t=(t+"").replace(/[^0-7]/gi,""),parseInt(t,8)}function g(t,r){var n;return t=Math.abs(t),r=Math.abs(r),n=Math.min(t,r),n/=t=Math.max(t,r),t*Math.sqrt(1+n*n)||null}var u={variables:{},on_var_not_found:void 0,on_var_validation:void 0,operators:{},functions:{},cache:{},construct:function(){return this.add_defaults(),this.set_division_by_zero_to_zero(),this},add_operator:function(t){return this.operators[t.operator]=t,this},evaluate:function(t,r=!0){return this.execute(t,r)},execute:function(t,r=!0){var n,e=t;return f(e,this.cache)?n=this.cache[e]:(n=(n=new v(t,this.operators)).tokenize().build_reverse_polish_notation(),r&&(this.cache[e]=n)),t=new E(this.functions,this.operators).calculate(n,this.variables,this.on_var_not_found,this),t="number"===l(t)&&!isNaN(t)?t:0},add_function:function(t,r){return this.functions[t]=new y(t,r),this},get_vars:function(){return this.variables},get_var:function(t){return f(t,this.variables)?this.variables[t]:(this.on_var_not_found&&"function"==typeof this.on_var_not_found&&this.on_var_not_found(t),A.trigger("Variable ("+t+") not set","UnknownVariableError",0))},set_var:function(t,r){return this.on_var_validation&&"function"==typeof this.on_var_validation&&(r=this.on_var_validation(t,r)),this.variables[t]=r,this},var_exists:function(t){return f(t,this.variables)},set_vars:function(t,r=!0){var n=this;return r&&this.remove_vars(),t.forFach(function(t,r){n.set_var(r,t)}),this},set_var_not_found_handler:function(t){return this.on_var_not_found=t,this},set_var_validation_handler:function(t){return this.on_var_validation=t,this},remove_var:function(t){return delete this.variables[t],this},remove_vars:function(){return this.variables={},this.on_var_not_found=null,this},get_operators:function(){return this.operators},get_functions:function(){return this.functions},remove_operator:function(t){delete this.operators[t]},set_division_by_zero_to_zero:function(){return this.add_operator(new d("/",!1,180,function(t,r){return t=Number(t),0==(r=Number(r))?0:t/r})),this},get_cache:function(){return this.cache},clear_cache:function(){this.cache=[]},add_defaults:function(){var n=this,e=this.default_operators(),a=this.default_functions();return Object.keys(e).forEach(function(t){var r=e[t];n.add_operator(new d(t,r[2],r[1],r[0]))}),Object.keys(a).forEach(function(t){var r=a[t];n.add_function(t,r)}),this.on_var_validation=this.default_var_validation,this.variables=this.default_vars(),this},default_operators:function(){return{"+":[function(t,r){return(t=h(t,0))+(r=h(r,0))},170,!1],"-":[function(t,r){return(t=h(t,0))-(r=h(r,0))},170,!1],uPos:[function(t){return t=h(t,0)},200,!1],uNeg:[function(t){return 0-(t=h(t,0))},200,!1],"*":[function(t,r){return(t=h(t,0))*(r=h(r,0))},180,!1],"/":[function(t,r){return t=h(t,0),r=h(r,0),c(r)?A.trigger("Division By Zero","DivisionByZeroError",0):t/r},180,!1],"^":[function(t,r){return t=h(t,0),r=h(r,0),Math.pow(t,r)},220,!0],"%":[function(t,r){return(t=h(t,0))%(r=h(r,0))},180,!1],"&&":[function(t,r){return t=String(t),r=String(r),t.isNumeric()&&(t=h(t,0)),r.isNumeric()&&(r=h(r,0)),t&&r?1:0},100,!1],"||":[function(t,r){return t=String(t),r=String(r),t.isNumeric()&&(t=h(t,0)),r.isNumeric()&&(r=h(r,0)),t||r?1:0},90,!1],"==":[function(t,r){return t=String(t),r=String(r),t.isNumeric()&&r.isNumeric()?h(t)===h(r)?1:0:0===n(t,r)?1:0},140,!1],"!=":[function(t,r){return t=String(t),r=String(r),t.isNumeric()&&r.isNumeric()?h(t)!==h(r)?1:0:0===n(t,r)?1:0},140,!1],">=":[function(t,r){return t=String(t),r=String(r),t.isNumeric()&&(t=h(t,0)),(r=r.isNumeric()?h(r,0):r)<=t?1:0},150,!1],">":[function(t,r){return t=String(t),r=String(r),t.isNumeric()&&(t=h(t,0)),(r=r.isNumeric()?h(r,0):r)<t?1:0},150,!1],"<=":[function(t,r){return t=String(t),r=String(r),(t=t.isNumeric()?h(t,0):t)<=(r=r.isNumeric()?h(r,0):r)?1:0},150,!1],"<":[function(t,r){return t=String(t),r=String(r),(t=t.isNumeric()?h(t,0):t)<(r=r.isNumeric()?h(r,0):r)?1:0},150,!1]}},default_functions:function(){var u=this;return{abs:Math.abs,acos:Math.acos,acosh:Math.acosh,arcsin:Math.asin,arcctg:function(t){return Math.PI/2-Math.atan(t)},arccot:function(t){return Math.PI/2-Math.atan(t)},arccotan:function(t){return Math.PI/2-Math.atan(t)},arcsec:function(t){return Math.acos(1/t)},arccosec:function(t){return Math.asin(1/t)},arccsc:function(t){return Math.asin(1/t)},arccos:Math.acos,arctan:Math.atan,arctg:Math.atan,array:function(...t){return t},asin:Math.asin,atan:Math.atan,atan2:Math.atan2,atanh:Math.atanh,atn:Math.atan,avg:function(t,...r){return Array.isArray(t)&&0===t.length?A.trigger("Array must contain at least one element!","InvalidArgumentError",0):(r=[].concat.apply([],[t,...r])).reduce(function(t,r){return h(r,0)+h(t,0)})/r.length},average:function(t,...r){return Array.isArray(t)&&0===t.length?A.trigger("Array must contain at least one element!","InvalidArgumentError",0):(r=[].concat.apply([],[t,...r])).reduce(function(t,r){return h(r,0)+h(t,0)})/r.length},bindec:t,ceil:Math.ceil,cos:Math.cos,cosec:function(t){return Math.sin(1/t)},csc:function(t){return Math.sin(1/t)},cosh:Math.cosh,ctg:function(t){return Math.cos(t)/Math.sin(t)},cot:function(t){return Math.cos(t)/Math.sin(t)},cotan:function(t){return Math.cos(t)/Math.sin(t)},cotg:function(t){return Math.cos(t)/Math.sin(t)},ctn:function(t){return Math.cos(t)/Math.sin(t)},decbin:r,dechex:e,decoct:a,deg2rad:i,exp:Math.exp,expm1:Math.expm1,floor:Math.floor,int:Math.floor,fmod:function(t,r){return t%r},hexdec:_,hypot:g,if:function(t,r,n){t=0===t||1===t||!0===t||!1===t?t:u.execute(t);return t?u.execute(r):u.execute(n)},intdiv:function(t,r){return Math.trunc(Math.trunc(t)/Math.trunc(r))},ln:Math.log,lg:Math.log10,log:Math.log,log1p:Math.log1p,max:function(t,...r){return Array.isArray(t)&&0===t.length?A.trigger("Array must contain at least one element!","InvalidArgumentError",0):(t=(t=Array.isArray(t)?t:[t,...r]).map(h),Math.max(...t))},min:function(t,...r){return Array.isArray(t)&&0===t.length?A.trigger("Array must contain at least one element!","InvalidArgumentError",0):(t=(t=Array.isArray(t)?t:[t,...r]).map(h),Math.min(...t))},octdec:p,pi:function(){return Math.PI},pow:Math.pow,rad2deg:function(t){return 57.29577951308232*t},round:o,sin:Math.sin,sinh:Math.sinh,sec:function(t){return 1/Math.cos(t)},sqrt:Math.sqrt,tan:Math.tan,tanh:Math.tanh,tn:Math.tan,tg:Math.tan,lookuptable:function(t,r){var n,e=0,a=0,i=s.TMEPOJS;if(i&&(i=s&&s.jQuery&&s.jQuery.epoAPI&&s.jQuery.epoAPI.util.parseJSON(i.lookupTables))){if(Array.isArray(r)&&(a=r[1],r=r[0]),c(r))return 0;c(a)&&(a=0),t=Array.isArray(t)?(n=t[0],t[1]):(n=t,""),(i=(i=i[r])&&i[a])&&(void 0===(r=(i=i.data)[n])&&n&&void 0!==n&&(0===h(n)?r=i[Object.keys(i)[0]]:n&&(r=i[n=u.find_lookup_table_index(n,i)])),void 0!==r&&(t=t&&void 0!==t?u.find_lookup_table_index(t,r):Object.keys(r)[0],e=h("max"===t?r[Object.keys(r)[Object.keys(r).length-1]]:r[t])))}return e},concat:function(t,...r){return Array.isArray(t)&&0===t.length?A.trigger("Array must contain at least one element!","InvalidArgumentError",0):(Array.isArray(t)?t:[t,...r]).join("")}}},find_lookup_table_index:function(n,t){var r,t=Object.keys(t);return n=h(n),r=t.map(function(t){return"max"===t?t:h(t)}).reduce(function(t,r){return"max"===r&&t<n?r:"max"===t&&r<n?t:t<r?t<n&&n<=r||r<n?r:t:r<n&&n<=t||t<n||"max"===r?t:r}),t=t.map(function(t){return"max"===t?t:h(t)}),!(n>Math.max(...t)||n<Math.min(...t))&&r},default_vars:function(){return{pi:3.141592653589793,e:2.718281828459045}},default_var_validation:function(t,r){return/boolean|number|string/.test(typeof r)||Array.isArray(r)||void 0===r?r:A.trigger("Variable ("+t+") type ("+l(r)+") is not scalar or array!",0)}},v=function(t,r){var n={tokens:[],input:"",operators:{},number_buffer:"",string_buffer:"",allow_negative:!0,in_single_quoted_string:!1,in_double_quoted_string:!1,is_number:function(t){return"0"<=t&&t<="9"},is_alpha:function(t){return"a"<=t&&t<="z"||"A"<=t&&t<="Z"||"_"===t},is_dot:function(t){return"."===t},is_lp:function(t){return"("===t},is_rp:function(t){return")"===t},is_comma:function(t){return","===t},empty_number_buffer_as_literal:function(){this.number_buffer.length&&(this.tokens.push(m(b.LITERAL,this.number_buffer)),this.number_buffer="")},empty_str_buffer_as_variable:function(){""!==this.string_buffer&&(this.tokens.push(m(b.VARIABLE,this.string_buffer)),this.string_buffer="")},tokenize:function(){var r=!1,n=this,e=[];return this.tokens=[],this.input.toString().split("").forEach(function(t){switch(!0){case n.in_single_quoted_string:"\\"===t?r=!r||(n.string_buffer+="\\",!1):"'"===t?r?(n.string_buffer+="'",r=!1):(n.tokens.push(m(b.STRING,n.string_buffer)),n.in_single_quoted_string=!1,n.string_buffer=""):(r&&(n.string_buffer+="\\",r=!1),n.string_buffer+=t);break;case n.in_double_quoted_string:"\\"===t?r=!r||(n.string_buffer+="\\",!1):'"'===t?r?(n.string_buffer+='"',r=!1):(n.tokens.push(m(b.STRING,n.string_buffer)),n.in_double_quoted_string=!1,n.string_buffer=""):(r&&(n.string_buffer+="\\",r=!1),n.string_buffer+=t);break;case"["===t:n.tokens.push(m(b.FUNCTION,"array")),n.allow_negative=!0,n.tokens.push(m(b.LEFTPARENTHESIS,""));break;case" "===t||"\n"===t||"\r"===t||"\t"===t:break;case n.is_number(t):""!==n.string_buffer?n.string_buffer+=t:(n.number_buffer+=t,n.allow_negative=!1);break;case"e"===t.toLowerCase():if(n.number_buffer.length&&-1!==n.number_buffer.indexOf(".")){n.number_buffer+="e",n.allow_negative=!1;break}case n.is_alpha(t):n.number_buffer.length&&(n.empty_number_buffer_as_literal(),n.tokens.push(m(b.OPERATOR,"*"))),n.allow_negative=!1,n.string_buffer+=t;break;case'"'===t:n.in_double_quoted_string=!0;break;case"'"===t:n.in_single_quoted_string=!0;break;case n.is_dot(t):n.number_buffer+=t,n.allow_negative=!1;break;case n.is_lp(t):""!==n.string_buffer?(n.tokens.push(m(b.FUNCTION,n.string_buffer)),n.string_buffer=""):n.number_buffer.length&&(n.empty_number_buffer_as_literal(),n.tokens.push(m(b.OPERATOR,"*"))),n.allow_negative=!0,n.tokens.push(m(b.LEFTPARENTHESIS,t));break;case n.is_rp(t)||"]"===t:n.empty_number_buffer_as_literal(),n.empty_str_buffer_as_variable(),n.allow_negative=!1,n.tokens.push(m(b.RIGHTPARENTHESIS,t));break;case n.is_comma(t):n.empty_number_buffer_as_literal(),n.empty_str_buffer_as_variable(),n.allow_negative=!0,n.tokens.push(m(b.PARAMSEPARATOR,t));break;default:if("-"===t||"+"===t){if(n.allow_negative){n.allow_negative=!1,n.tokens.push(m(b.OPERATOR,"-"===t?"uNeg":"uPos"));break}if(n.number_buffer&&"e"===n.number_buffer[n.number_buffer.length-1]){n.number_buffer+=t;break}}n.empty_number_buffer_as_literal(),n.empty_str_buffer_as_variable(),"$"!==t&&(0<n.tokens.length&&b.OPERATOR===n.tokens[n.tokens.length-1].type?n.tokens[n.tokens.length-1].value+=t:n.tokens.push(m(b.OPERATOR,t))),n.allow_negative=!0}}),this.empty_number_buffer_as_literal(),this.empty_str_buffer_as_variable(),this.tokens.forEach(function(t,r){e[r]=t.type}),e.forEach(function(t,r){0<r&&"space"===t&&"variable"===e[r+1]&&"variable"===e[r-1]&&(n.tokens[r]=new m(b.LITERAL,0),n.tokens.splice(r+1,1),n.tokens.splice(r-1,1))}),this},build_reverse_polish_notation:function(){var r,n,e,a=[],i=[],u=[],o=this;try{this.tokens.forEach(function(t){switch(t.type){case b.LITERAL:case b.VARIABLE:case b.STRING:a.push(t),0<u.length&&0===u[u.length-1]&&u.push(u.pop()+1);break;case b.FUNCTION:0<u.length&&0===u[u.length-1]&&u.push(u.pop()+1),i.push(t),u.push(0);break;case b.LEFTPARENTHESIS:i.push(t);break;case b.PARAMSEPARATOR:for(;b.LEFTPARENTHESIS!==i[i.length-1].type;){if(0===i.length)return A.trigger("Incorrect Brackets","IncorrectBracketsError",a);a.push(i.pop())}u.push(u.pop()+1);break;case b.OPERATOR:if(!f(t.value,o.operators))return A.trigger(t.value,"UnknownOperatorError",a);for(e=o.operators[t.value];0<i.length&&b.OPERATOR===i[i.length-1].type;){if(!f(i[i.length-1].value,o.operators))return A.trigger(i[i.length-1].value,"UnknownOperatorError",a);if(!(o.operators[i[i.length-1].value].priority>=e.priority))break;a.push(i.pop())}i.push(t);break;case b.RIGHTPARENTHESIS:for(;;)try{if(r=i.pop(),b.LEFTPARENTHESIS===r.type)break;a.push(r)}catch(t){return A.trigger("Incorrect Brackets","IncorrectBracketsError",a)}0<i.length&&b.FUNCTION===i[i.length-1].type&&((n=i.pop()).param_count=u.pop(),a.push(n));break;case b.SPACE:}})}catch(t){return a=[],A.trigger(t,"Error",a)}for(;0!==i.length;){if(b.LEFTPARENTHESIS===i[i.length-1].type||b.RIGHTPARENTHESIS===i[i.length-1].type)return A.trigger("Incorrect Brackets","IncorrectBracketsError",a);b.SPACE===i[i.length-1].type?i.pop():a.push(i.pop())}return a}};return n.input=t,n.operators=r,n},b={LITERAL:"literal",VARIABLE:"variable",OPERATOR:"operator",LEFTPARENTHESIS:"LP",RIGHTPARENTHESIS:"RP",FUNCTION:"function",PARAMSEPARATOR:"separator",STRING:"string",SPACE:"space"},m=function(t,r,n){var e={type:b.LITERAL,value:void 0,name:void 0,param_count:null};return e.type=t,e.value=r,e.name=n,e},d=function(t,r,n,e){var a={operator:"",is_right_assoc:!1,priority:0,function:null,places:0};return a.operator=t,a.is_right_assoc=r,a.priority=n,a.function=e,a.places=function(t){var r=/^(function)?\s*[^\(]*\(\s*([^\)]*)\)/m;const n=/^\s*(_?)(.+?)\1\s*$/;return((t||"").toString().replace(/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,"").match(r)||["","",""])[2].split(/,/).map(function(t){return t.replace(n,function(t,r,n){return n.split("=")[0].trim()})}).filter(String).length}(e),a.execute=function(t){var r,n,e=[];if(t.length<this.places)return t.splice(0,t.length),A.trigger("Incorrect Expression","IncorrectExpressionError",new m(b.LITERAL,0));for(r=0;r<this.places;r++)e.unshift(t.pop().value);return n=this.function.apply(null,e),"number"!==l(n)&&"string"!==l(n)&&(n=0),new m(b.LITERAL,n)},a},y=function(t,r){var n={name:"",function:void 0,required_param_count:void 0};return n.name=t,n.function=r,n.required_param_count=r.length,n.execute=function(t,r){var n,e,a,i=[];if((r=r<this.required_param_count?this.required_param_count:r)<this.required_param_count)return t.splice(0,t.length),A.trigger(this.name,"IncorrectNumberOfFunctionParametersError",new m(b.LITERAL,0));if(0<r)for(n=0;n<r;n++)null===(e=t.length?t.pop().value:0)?i.push(e="0"):i.unshift(e);return a=this.function.apply(null,i),m(b.LITERAL,a=a!==1/0&&a!==-1/0?a:0)},n},E=function(t,r){var n={functions:{},operators:{}};return n.functions=t,n.operators=r,n.calculate=function(t,e,a=null,i=!1){var u=this,o=[];if(c(t))return 0;try{t.forEach(function(t){var r,n;if(b.LITERAL===t.type||b.STRING===t.type)o.push(t);else if(b.VARIABLE===t.type)r=t.value,n=null,f(r,e)?n=e[r]:a&&"function"==typeof a?n=a(r):(i.variables[n=r]=n,e[r]=n),o.push(m(b.LITERAL,n,r));else if(b.FUNCTION===t.type){if(!f(t.value,u.functions)){if(i.add_function(t.value,function(){return 0}),u.functions=i.functions,!f(t.value,u.functions))return A.trigger(t.value,"UnknownFunctionError",0);A.trigger(t.value,"UnknownFunctionError",0)}o.push(u.functions[t.value].execute(o,t.param_count))}else if(b.OPERATOR===t.type){if(!f(t.value,u.operators))return A.trigger(t.value,"UnknownOperatorError",0);o.push(u.operators[t.value].execute(o))}})}catch(t){s.TMEPOJS&&s.TMEPOJS.WP_DEBUG&&s.console.log(t)}return null!==(t=o.pop())&&c(o)?(!1===t.value&&(t.value=0),!0===t.value&&(t.value=1),"string"===l(t.value)&&t.value.isNumeric()&&(t.value=h(t.value)),t.value):A.trigger("Stack must be empty","IncorrectExpressionError",0)},n},A={trigger:function(t,r="",n=!1){return s.TMEPOJS&&s.TMEPOJS.WP_DEBUG&&(s.console.log(r+"\n"+t),s.console.trace()),n}};s.tcmexp=u.construct()}(window);