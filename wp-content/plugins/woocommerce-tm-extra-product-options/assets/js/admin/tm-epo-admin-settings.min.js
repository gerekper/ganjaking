!function(i,o,p){"use strict";var c=i.TMEPOADMINSETTINGSJS,_=p.epoAPI.util.getStorage("localStorage"),n=i.confirm,s=i.toastr,a=0;function l(e){var t=p("#tm_epo_consent_for_transmit");t.length&&t.is(":checked")&&0===a?(a=1,p(".tm-license-result").html('<div class="activated"><p>'+c.i18n_sending_data+"</p></div>"),p(".tm-license-button").block({message:null}),t={action:"tm_"+e+"_license",username:p("#tm_epo_envato_username").val(),key:p("#tm_epo_envato_purchasecode").val(),security:c.settings_nonce},p.post(c.ajax_url,t,function(t){t=t&&-1!==t?t&&t.message&&t.result&&("-3"===t.result||"-2"===t.result||"wp_error"===t.result||"server_error"===t.result)||t&&t.message&&t.result&&"4"===t.result?t.message:"":c.i18n_invalid_request;p(".tm-license-result").html(t),p(".tm-license-button").unblock()},"json").always(function(t){p(".tm-license-button").unblock(),a=0,t&&t.result&&"4"===t.result&&("activate"===e&&(p(".tm-deactivate-license").removeClass("tm-hidden"),p(".tm-activate-license").removeClass("tm-hidden").addClass("tm-hidden")),"deactivate"===e)&&(p(".tm-deactivate-license").removeClass("tm-hidden").addClass("tm-hidden"),p(".tm-activate-license").removeClass("tm-hidden"))})):p(".tm-license-result").html('<div class="error"><p>'+c.i18n_must_concent+"</p></div>")}function r(t){var t=t.val(),e=p("#tm_epo_options_placement_custom_hook").closest("tr");"custom"===t?e.show():e.hide()}function m(t){var t=t.val(),e=p("#tm_epo_totals_box_placement_custom_hook").closest("tr");"custom"===t?e.show():e.hide()}function d(t){var t=t.val(),e=p("#tm_epo_show_options_total").closest("tr"),o=p("#tm_epo_show_final_total").closest("tr"),s=p("#tm_epo_enable_final_total_box_all").closest("tr"),a=p("#tm_epo_enable_original_final_total").closest("tr"),n=p("#tm_epo_enable_vat_options_total").closest("tr"),l=p("#tm_epo_show_unit_price").closest("tr"),i=p("#tm_epo_fees_on_unit_price").closest("tr"),c=p("#tm_epo_total_price_as_unit_price").closest("tr"),_=p("#tm_epo_hide_totals_until_any").closest("tr"),r=p("#tm_epo_hide_totals_until_all_required").closest("tr"),m=p("#tm_epo_hide_totals_until_all").closest("tr");"disable"===t?(e.hide(),o.hide(),s.hide(),a.hide(),n.hide(),l.hide(),i.hide(),c.hide(),_.hide(),r.hide(),m.hide()):(e.show(),o.show(),s.show(),a.show(),n.show(),l.show(),i.show(),c.show(),_.show(),r.show(),m.show(),h(p("#tm_epo_show_options_total")),u(p("#tm_epo_show_final_total")))}function h(t){var t=t.val(),e=p("#tm_epo_enable_vat_options_total").closest("tr");"hide"===t?e.hide():e.show()}function u(t){var t=t.val(),e=p("#tm_epo_enable_original_final_total").closest("tr"),o=p("#tm_epo_total_price_as_unit_price").closest("tr");"hide"===t?(e.hide(),o.hide()):(e.show(),o.show())}function f(t){var t=t.val(),e=p("#tm_epo_options_placement").closest("tr"),o=p("#tm_epo_totals_box_placement").closest("tr"),s=p("#tm_epo_options_placement_custom_hook").closest("tr"),a=p("#tm_epo_totals_box_placement_custom_hook").closest("tr");"action"===t?(e.hide(),o.hide(),s.hide(),a.hide()):(e.show(),o.show(),r(p("#tm_epo_options_placement")),m(p("#tm_epo_totals_box_placement")))}function v(t){var t=t.val(),e=p("#tm_epo_floating_totals_box_visibility").closest("tr"),o=p("#tm_epo_floating_totals_box_add_button").closest("tr"),s=p("#tm_epo_floating_totals_box_pixels").closest("tr");"disable"===t?(e.hide(),o.hide(),s.hide()):(e.show(),o.show(),b(p("#tm_epo_floating_totals_box_visibility")))}function b(t){var t=t.val(),e=p("#tm_epo_floating_totals_box").val(),o=p("#tm_epo_floating_totals_box_pixels").closest("tr");"always"===t||"disable"===e?o.hide():o.show()}function w(t){var t=t.is(":checked"),e=p("#tm_epo_show_price_inside_option_hidden_even").closest("tr"),o=p("#tm_epo_multiply_price_inside_option").closest("tr");t?(e.show(),o.show()):(e.hide(),o.hide())}function g(t){var t=t.is(":checked"),e=p("#tm_epo_show_upload_image_replacement").closest("tr");t?e.hide():e.show()}function x(t){t=t.val();p(".tm-epo-field-label").find(".tc-epo-style-wrapper, .tm-epo-style").removeClass("circle circle 2 square square2 round round2").addClass(t)}function y(t){var e=p("#tm_epo_css_styles_style").closest("tr");t.is(":checked")?e.show():e.hide()}function k(t){t=t.val();p(".tm-border-type").removeClass("square circle round shadow thinline").addClass(t)}function C(t){return t.closest("tr")}function I(t,e,o,s){C(o).addClass("tm-hidden"),C(o.filter("."+t)).removeClass("tm-hidden"),s.find(".tm-section-desc .tm-section-menu-item").removeClass("active"),e.addClass("active")}function j(t,e,o){t.block({message:null}),p.post(c.ajax_url,e,function(t){t&&(1===t.error?s.error(t.message,c.i18n_epo):(s.success(t.message,c.i18n_epo),o&&i.location.reload()))},"json").always(function(){t.unblock()})}p(function(){var s,a,t,e=p(".tm-settings-wrap");0<e.length&&((t=e.find(":checkbox")).closest("label").addClass("tm-epo-switch-wrapper-label"),t.wrap('<span class="tm-epo-switch-wrapper tc"></span>'),t.after('<span class="tc-label tm-epo-switch tc"></span>'),e.find("input.tm-color-picker").spectrum({showInput:!0,showInitial:!0,allowEmpty:!0,showAlpha:!0,showPalette:!0,clickoutFiresChange:!1,type:"color",preferredFormat:"hex",theme:"epo",chooseText:c.i18n_close,cancelText:c.i18n_cancel}),p(".forminp .description").toArray().forEach(function(t){t=p(t);t.closest("tr").find(".titledesc").append(t)}),p("#tm_epo_consent_for_transmit").closest("tr").after(p('<tr valign="top"><th scope="row" class="titledesc tm-license-div"></th><td class="forminp forminp-license"></td></tr>')),p(".tm-license-div").append(p(".tm-license-button")),p(".forminp-license").append(p(".tm-license-result")),p(i).on("tc-opentab.tmtabs tc-isopentab.tmtabs",function(t,e){var o,s,a,n=e.table.find(".tm-section-desc .tm-section-menu-item");0<n.length&&(_&&(o=_.getItem("tmadminextratab")),s=n.filter('[data-menu="'+o+'"]'),a=e.table.find("select,input,text,textarea"),I(o=o&&0!==s.length?o:(s=p(n).eq(0)).attr("data-menu"),s,a,e.table))}),p(o).on("keydown.tmtabs",".tm-section-menu-item",function(t){var e,o=p(this);13===t.keyCode&&o.trigger("click"),39===t.keyCode&&(e=o.next(".tm-section-menu-item")),(e=37===t.keyCode?o.prev(".tm-section-menu-item"):e)&&e.length&&(o.trigger("blur"),e.trigger(" focus").trigger("click"),t.preventDefault())}),p(o).on("click",".tm-section-menu-item",function(){var t=p(this),e=t.attr("data-menu"),o=t.closest(".tm-tab");I(e,t,o.find("select,input,text,textarea"),o),_&&_.setItem("tmadminextratab",e)}),p(i).on("tc-tmtabs-clicked",function(t,e){var o,s,a,n,l,i=e.table.find(".tm-section-desc .tm-section-menu-item");0<i.length&&(_&&(o=_.getItem("tmadminextratab")),_&&(s=_.getItem("tmadminextratab-context")),a=e.header.attr(e.options.dataattribute),l=e.table.find("select,input,text,textarea"),o&&s===a?n=i.filter('[data-menu="'+o+'"]'):o=(n=p(i).eq(0)).attr("data-menu"),_&&_.setItem("tmadminextratab-context",a),0<n.length)&&!n.is(".active")&&I(o,n,l,e.table)}),p(o).on("click",".tc-save-button",function(t){var e,o,n,s=p(this).closest("form");e=p("#tm_epo_math"),o=p(".constantrow"),n={},o.toArray().forEach(function(t,e){var t=p(t),o=t.find(".constant-name"),s=o.val(),t=t.find(".constant-value"),a=t.val(),o=o.closest(".constant-label-wrap"),t=t.closest(".constant-label-wrap");""===s?o.addClass("tm-error"):o.removeClass("tm-error"),""===a?t.addClass("tm-error"):t.removeClass("tm-error"),""===s&&""===a||(n["m"+e]={name:String(s),value:String(a)})}),e.val(JSON.stringify(n)),o=s.tcSerializeObject(),o=p.extend(!0,o,{action:"tm_save_settings",save:"save",security:c.settings_nonce}),t.preventDefault(),j(s,o)}),p(o).on("click",".tc-reset-button",function(t){var e,o,s,a,n=p(this).closest("form"),l=p.extend(!0,{},{action:"tm_reset_settings",save:"save",security:c.settings_nonce});t.preventDefault(),t=c.i18n_reset_settings,e=j,o=this,s=[n,l,!0],t=p.epoAPI.template.html(i.wp.template("tc-floatbox"),{id:"tc-floatbox-content",title:t,html:"",uniqid:"",update:c.i18n_yes,cancel:c.i18n_no}),a=!1,p.tcFloatBox({closefadeouttime:0,overlayopacity:.6,animateOut:"",fps:1,ismodal:!0,refresh:"fixed",width:"50%",height:"auto",classname:"flasho tc-wrapper tc-question",data:t,cancelEvent:function(t){a||(a=!0,t.destroy())},cancelClass:".floatbox-cancel",updateEvent:function(t){a||(a=!0,e.apply(o,s),t.destroy())},updateClass:".floatbox-update",isconfirm:!0})}),p(".tm-settings-wrap .tm-tabs").tcTabs({scroll:!1}),p(".tm-activate-license").on("click",function(t){t.preventDefault(),l("activate")}),p(".tm-deactivate-license").on("click",function(t){t.preventDefault(),l("deactivate")}),p("#tm_epo_final_total_box").on("change",function(){d(p(this))}),p("#tm_epo_show_options_total").on("change",function(){h(p(this))}),p("#tm_epo_show_final_total").on("change",function(){u(p(this))}),p("#tm_epo_display").on("change",function(){f(p(this))}),p("#tm_epo_options_placement").on("change",function(){r(p(this))}),p("#tm_epo_totals_box_placement").on("change",function(){m(p(this))}),p("#tm_epo_css_styles").on("change",function(){y(p(this))}),p("#tm_epo_css_styles_style").on("change",function(){x(p(this))}),p("#tm_epo_css_selected_border").on("change",function(){k(p(this))}),p("#tm_epo_floating_totals_box").on("change",function(){v(p(this))}),p("#tm_epo_floating_totals_box_visibility").on("change",function(){b(p(this))}),p("#tm_epo_show_price_inside_option").on("change",function(){w(p(this))}),p("#tm_epo_show_hide_uploaded_file_url_cart").on("change",function(){g(p(this))}),d(p("#tm_epo_final_total_box")),h(p("#tm_epo_show_options_total")),u(p("#tm_epo_show_final_total")),f(p("#tm_epo_display")),r(p("#tm_epo_options_placement")),m(p("#tm_epo_totals_box_placement")),t=p("#tm_epo_css_styles_style"),p(t).closest("td").css("position","relative").append('<label class="tm-epo-field-label"><span class="tc-epo-style-wrapper"><input type="checkbox" checked><span class="tm-epo-style"></span></span></label><label class="tm-epo-field-label"><span class="tc-epo-style-wrapper"><input type="radio" checked><span class="tm-epo-style"></span></span></label>'),x(p("#tm_epo_css_styles_style")),y(p("#tm_epo_css_styles")),e=p("#tm_epo_css_selected_border"),p(e).closest("td").css("position","relative").append('<div class="tm-border-type"></div>'),k(p("#tm_epo_css_selected_border")),v(p("#tm_epo_floating_totals_box")),b(p("#tm_epo_floating_totals_box_visibility")),w(p("#tm_epo_show_price_inside_option")),g(p("#tm_epo_show_hide_uploaded_file_url_cart")),t=p("#tm_epo_math"),a="",t.closest("tr").hide(),s=(s=p.epoAPI.util.parseJSON(t.val()))||{},Object.keys(s).forEach(function(t,e){var o=s[t].name,t=s[t].value;a+=p.epoAPI.template.html(i.wp.template("tc-constant-template"),{id:e,labelname:c.i18n_constant_name,labelvalue:c.i18n_constant_value,constantname:o,constantvalue:t,labelnameclass:""===o?" tm-error":"",labelvalueclass:""===t?" tm-error":""})}),p(".tc-add-constant").closest("tr").before(a),p(o).on("click",".tc-add-constant",function(){var t=p(this).closest("tr"),e=p(".constantrow").length;t.before(p.epoAPI.template.html(i.wp.template("tc-constant-template"),{id:e,labelname:c.i18n_constant_name,labelvalue:c.i18n_constant_value}))}),p(o).on("click",".tc-constant-delete .delete",function(){p(this).closest("tr").remove()}),p(o).on("change blur keyup",".constant-name, .constant-value",function(){var t=p(this),e=t.closest(".constant-label-wrap");""===t.val()?e.addClass("tm-error"):e.removeClass("tm-error")}),p(o).on("click.cpf",".tm-mn-movetodir,.tm-mn-deldir,.tm-mn-delfile",function(t){var e=p(this),o=p(".forminp-tm_html");t.preventDefault(),0<o.length&&(o.data("doing_ajax")||e.is(".tm-mn-deldir")&&!n(c.i18n_mn_delete_folder)||e.is(".tm-mn-delfile")&&!n(c.i18n_mn_delete_file)||(e.prepend('<i class="tm-icon tcfa tcfa-spin tcfa-spinner"></i>'),o.data("doing_ajax",1).block({message:null}),t={action:"tm_mn_movetodir",dir:e.attr("data-tm-dir"),security:c.settings_nonce},e.is(".tm-mn-deldir")?(t.action="tm_mn_deldir",t.tmdir=e.attr("data-tm-deldir")):e.is(".tm-mn-delfile")&&(t.action="tm_mn_delfile",t.tmfile=e.attr("data-tm-delfile"),t.tmdir=e.attr("data-tm-deldir")),p.post(c.ajax_url,t,function(t){t&&t.result&&""!==t.result?o.html(t.result):t&&t.error&&t.message&&(t=p.epoAPI.template.html(i.wp.template("tc-floatbox-import"),{id:"tc-floatbox-content",title:c.i18n_error_title,html:'<div class="tm-inner">'+t.message+"</div>",cancel:c.i18n_cancel}),p.tcFloatBox({closefadeouttime:0,animateOut:"",fps:1,ismodal:!0,refresh:"fixed",width:"50%",height:"300px",classname:"flasho tc-wrapper tm-error tc-color-error",data:t}))},"json").always(function(){o.data("doing_ajax",0).unblock(),e.find(".tm-icon").remove()})))})),p.tcToolTip()})}(window,document,window.jQuery);