"function"!=typeof Object.create&&(Object.create=function(t){function e(){}return e.prototype=t,new e}),function(h,n){h.fn.socialfeed=function(t){var u=h.extend({plugin_folder:"",template:"template.html",show_media:!1,readMore:"Read More Â»",media_min_width:300,length:500,date_format:"ll",date_locale:"en",adminPosts:!1,totalPostsNumber:null,messagedPosts:0,adminPostsNumber:0,since:{years:" years ago",months:" months ago",weeks:" weeks ago",minutes:" minutes ago",seconds:" seconds ago"}},t),l=h(this),e=["facebook","twitter"],d=0,m=0;e.forEach(function(t){u[t]&&(u[t].accounts?d+=u[t].limit*u[t].accounts.length:u[t].urls?d+=u[t].limit*u[t].urls.length:d+=u[t].limit)});var c={request:function(t,e){h.ajax({url:t,dataType:"jsonp",success:e})},get_request:function(t,e){h.get(t,e,"json")},wrapLinks:function(t,e){return t.replace(/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi,c.wrapLinkTemplate)},wrapLinkTemplate:function(t){return'<a target="_blank" href="'+t+'">'+t+"</a>"},shorten:function(t){return(t=h.trim(t)).length>u.length?jQuery.trim(t).substring(0,u.length).split(" ").slice(0,-1).join(" ")+"...":t},stripHTML:function(t){return null==t?"":t.replace(/(<([^>]+)>)|nbsp;|\s{2,}|/gi,"")}};function o(t,e){this.content=e,this.content.social_network=t,this.content.attachment=this.content.attachment===n?"":this.content.attachment,this.content.time_ago=e.dt_create,this.content.dt_create=this.content.dt_create.valueOf(),this.content.text=c.wrapLinks(c.shorten(e.message+" "+e.description),e.social_network),this.content.moderation_passed=!u.moderation||u.moderation(this.content),f[t].posts.push(this)}var f={template:!(o.prototype={render:function(){var t=f.template(this.content),e=this.content;if(0!==h(l).children("[social-feed-id="+e.id+"]").length)return!1;if(0===h(l).children().length)h(l).append(t);else{var a=-1;if(this.content.social_network,h.each(h(l).children(),function(){}),h(l).append(t),0<=a){a++;var o=h(l).children("div:nth-child("+a+")"),n=h(l).children("div:last-child");h(n).insertBefore(o)}}if(u.media_min_width){var i="[social-feed-id="+e.id+"] img.attachment",r=h(i),s=new Image,c=r.attr("src");h(s).on("load",function(){s.width<u.media_min_width&&r.hide(),delete s}).on("error",function(){r.hide()}).attr({src:c})}u.totalPostsNumber&&(d=u.messagedPosts),++m==(u.adminPosts?u.adminPostsNumber:d)&&u.callback&&u.callback()}}),init:function(){f.getTemplate(function(){e.forEach(function(e){u[e]&&(u[e].accounts?u[e].accounts.forEach(function(t){f[e].getData(t)}):u[e].urls?u[e].urls.forEach(function(t){f[e].getData(t)}):f[e].getData())})})},getTimeAgo:function(t,e){var a=0;"fb"===e&&(t=t.replace(/-/g,"/").replace("T"," ").split("+")[0],a=60*new Date(t).getTimezoneOffset()*1e3);var o=Date.now()-new Date(t).getTime()+a;return o<6e4?1<(o=Math.round(o/1e3))?o+" seconds ago":o+" second ago":o<36e5?1<(o=Math.round(o/6e4))?o+" minutes ago":o+" minute ago":o<864e5?1<(o=Math.round(o/36e5))?o+" hours ago":o+" hour ago":o<2592e6?1<(o=Math.round(o/864e5))?o+" days ago":o+" day ago":o<31536e6?1<(o=Math.round(o/2592e6))?o+u.since.months:o+" month ago":1<(o=Math.round(o/31536e6))?o+u.since.years:o+" year ago"},getTemplate:function(e){return f.template?e():u.template_html?(f.template=doT.template(u.template_html),e()):void h.get(u.template,function(t){return f.template=doT.template(t),e()})},twitter:{posts:[],loaded:!1,api:"https://api.twitter.com/1.1/statuses/user_timeline.json",getData:function(t){var e=new Codebird;switch(e.setToken(u.twitter.token,u.twitter.secret)||e.setConsumerKey(u.twitter.consumer_key,u.twitter.consumer_secret),u.twitter.proxy!==n&&e.setProxy(u.twitter.proxy),t[0]){case"@":var a=t.substr(1);e.__call("statuses_userTimeline",{id:a,count:u.twitter.limit,tweet_mode:void 0===u.twitter.tweet_mode?"compatibility":u.twitter.tweet_mode},f.twitter.utility.getPosts,!0);break;case"#":e.__call("search_tweets",{q:t,count:u.twitter.limit,tweet_mode:void 0===u.twitter.tweet_mode?"compatibility":u.twitter.tweet_mode},function(t){jQuery.ajax({url:f.twitter.utility.getPosts(t.statuses)}).done(function(){u.callback()})},!0)}},utility:{getPosts:function(t){var e=1;t&&h.each(t,function(){new o("twitter",f.twitter.utility.unifyPostData(this,e)).render(),e+=e})},unifyPostData:function(t,e){var a={};function o(t,e){return e=e||0,Math.floor(t*Math.pow(10,e))/Math.pow(10,e)}function n(t){return 1e9<=t?o(t/1e9,1)+"G":1e6<=t?o(t/1e6,1)+"M":1e4<=t?o(t/1e3,1)+"K":t}if(t.id&&(a.counter=e,a.id=t.id_str,a.screen_name=t.user.screen_name,a.retweet_count=t.retweet_count,a.favorite_count=t.favorite_count,a.showHeader="yes"===u.twitter.header,a.dt_create=f.getTimeAgo(t.created_at,"twitter"),a.author_link="https://twitter.com/"+t.user.screen_name,a.author_picture=t.user.profile_image_url_https,a.author_picture_hq=a.author_picture.replace("_normal",""),a.cover_picture=t.user.profile_banner_url,a.readMore=u.readMore,a.post_url=a.author_link+"/status/"+t.id_str,a.author_name=t.user.name,a.message=void 0===t.text?t.full_text:t.text,a.description="",a.link="https://twitter.com/"+t.user.screen_name+"/status/"+t.id_str,a.followers_count=n(t.user.followers_count),a.following_count=n(t.user.friends_count),a.tweets_count=n(t.user.statuses_count),!0===u.show_media&&t.entities.media&&0<t.entities.media.length)){var i=t.entities.media[0].media_url_https;i&&(a.attachment='<img class="attachment" src="'+i+'" />')}return a}}},facebook:{posts:[],graph:"https://graph.facebook.com/",loaded:!1,getData:function(t){if(u.facebook.feedObject)f.facebook.utility.getPosts(u.facebook.feedObject);else{function e(t){c.request(t,f.facebook.utility.getPosts)}var a="?fields=id,from,message,created_time,admin_creator,story";a+=!0===u.show_media?",full_picture":"";var o,n="&limit="+u.facebook.limit,i="&access_token="+u.facebook.access_token+"&callback=?";switch(t[0]){case"@":var r=t.substr(1);f.facebook.utility.getUserId(r,function(t){""!==t.id&&(o=f.facebook.graph+"v5.0/"+t.id+"/posts"+a+n+i,e(o))});break;case"!":var s=t.substr(1);o=f.facebook.graph+"v5.0/"+s+"/feed"+a+n+i,e(o);break;default:e(o)}}},utility:{getUserId:function(t,e){var a="https://graph.facebook.com/"+t+"?&access_token="+u.facebook.access_token+"&callback=?";h.get(a,e,"json")},prepareAttachment:function(t){var e=t.full_picture;return-1!==e.indexOf("_b.")||(-1!==e.indexOf("safe_image.php")?e=f.facebook.utility.getExternalImageURL(e,"url"):-1!==e.indexOf("app_full_proxy.php")?e=f.facebook.utility.getExternalImageURL(e,"src"):t.object_id&&(e=f.facebook.graph+t.object_id+"/picture/?type=normal")),'<img class="attachment" src="'+e+'" />'},getExternalImageURL:function(t,e){return-1===(t=decodeURIComponent(t).split(e+"=")[1]).indexOf("fbcdn-sphotos")?t.split("&")[0]:t},getPosts:function(t){var a=u.adminPosts;t.data&&(u.totalPostsNumber=t.data.length),t.data&&t.data.forEach(function(t){var e=u.show_media&&t.full_picture||t.message;null!==t.from&&e&&(u.messagedPosts++,a?t.admin_creator&&(u.adminPostsNumber++,new o("facebook",f.facebook.utility.unifyPostData(t)).render()):new o("facebook",f.facebook.utility.unifyPostData(t)).render())})},unifyPostData:function(t){var e={},a=t.message?t.message:t.story;if(e.id=t.id,e.dt_create=f.getTimeAgo(t.created_time,"fb"),e.author_link="http://facebook.com/"+t.from.id,e.author_picture=f.facebook.graph+t.from.id+"/picture",e.readMore=u.readMore,e.author_name=t.from.name,e.name=t.name||"",e.message=a||"",e.description=t.description?t.description:"",e.link=t.link?t.link:"http://facebook.com/"+t.id,!0===u.show_media&&t.full_picture){var o=f.facebook.utility.prepareAttachment(t);o&&(e.attachment=o)}return e}}}};return this.each(function(){f.init(),u.update_period&&setInterval(function(){return f.init()},u.update_period)})}}(jQuery);