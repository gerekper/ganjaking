<?php
 namespace MailPoetVendor\Symfony\Component\Validator\Constraints; if (!defined('ABSPATH')) exit; use MailPoetVendor\Symfony\Component\PropertyAccess\Exception\NoSuchPropertyException; use MailPoetVendor\Symfony\Component\PropertyAccess\PropertyAccess; use MailPoetVendor\Symfony\Component\PropertyAccess\PropertyAccessorInterface; use MailPoetVendor\Symfony\Component\Validator\Constraint; use MailPoetVendor\Symfony\Component\Validator\ConstraintValidator; use MailPoetVendor\Symfony\Component\Validator\Exception\ConstraintDefinitionException; use MailPoetVendor\Symfony\Component\Validator\Exception\UnexpectedTypeException; abstract class AbstractComparisonValidator extends \MailPoetVendor\Symfony\Component\Validator\ConstraintValidator { private $propertyAccessor; public function __construct(\MailPoetVendor\Symfony\Component\PropertyAccess\PropertyAccessorInterface $propertyAccessor = null) { $this->propertyAccessor = $propertyAccessor; } public function validate($value, \MailPoetVendor\Symfony\Component\Validator\Constraint $constraint) { if (!$constraint instanceof \MailPoetVendor\Symfony\Component\Validator\Constraints\AbstractComparison) { throw new \MailPoetVendor\Symfony\Component\Validator\Exception\UnexpectedTypeException($constraint, \MailPoetVendor\Symfony\Component\Validator\Constraints\AbstractComparison::class); } if (null === $value) { return; } if ($path = $constraint->propertyPath) { if (null === ($object = $this->context->getObject())) { return; } try { $comparedValue = $this->getPropertyAccessor()->getValue($object, $path); } catch (\MailPoetVendor\Symfony\Component\PropertyAccess\Exception\NoSuchPropertyException $e) { throw new \MailPoetVendor\Symfony\Component\Validator\Exception\ConstraintDefinitionException(\sprintf('Invalid property path "%s" provided to "%s" constraint: ', $path, \get_class($constraint)) . $e->getMessage(), 0, $e); } } else { $comparedValue = $constraint->value; } if (\is_string($comparedValue) && $value instanceof \DateTimeInterface) { $dateTimeClass = $value instanceof \DateTimeImmutable ? \DateTimeImmutable::class : \DateTime::class; try { $comparedValue = new $dateTimeClass($comparedValue); } catch (\Exception $e) { throw new \MailPoetVendor\Symfony\Component\Validator\Exception\ConstraintDefinitionException(\sprintf('The compared value "%s" could not be converted to a "%s" instance in the "%s" constraint.', $comparedValue, $dateTimeClass, \get_class($constraint))); } } if (!$this->compareValues($value, $comparedValue)) { $violationBuilder = $this->context->buildViolation($constraint->message)->setParameter('{{ value }}', $this->formatValue($value, self::OBJECT_TO_STRING | self::PRETTY_DATE))->setParameter('{{ compared_value }}', $this->formatValue($comparedValue, self::OBJECT_TO_STRING | self::PRETTY_DATE))->setParameter('{{ compared_value_type }}', $this->formatTypeOf($comparedValue))->setCode($this->getErrorCode()); if (null !== $path) { $violationBuilder->setParameter('{{ compared_value_path }}', $path); } $violationBuilder->addViolation(); } } private function getPropertyAccessor() : \MailPoetVendor\Symfony\Component\PropertyAccess\PropertyAccessorInterface { if (null === $this->propertyAccessor) { $this->propertyAccessor = \MailPoetVendor\Symfony\Component\PropertyAccess\PropertyAccess::createPropertyAccessor(); } return $this->propertyAccessor; } protected abstract function compareValues($value1, $value2); protected function getErrorCode() { return null; } } 