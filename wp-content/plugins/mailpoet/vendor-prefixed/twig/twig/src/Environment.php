<?php
 namespace MailPoetVendor\Twig; if (!defined('ABSPATH')) exit; use MailPoetVendor\Twig\Cache\CacheInterface; use MailPoetVendor\Twig\Cache\FilesystemCache; use MailPoetVendor\Twig\Cache\NullCache; use MailPoetVendor\Twig\Error\Error; use MailPoetVendor\Twig\Error\LoaderError; use MailPoetVendor\Twig\Error\RuntimeError; use MailPoetVendor\Twig\Error\SyntaxError; use MailPoetVendor\Twig\Extension\CoreExtension; use MailPoetVendor\Twig\Extension\EscaperExtension; use MailPoetVendor\Twig\Extension\ExtensionInterface; use MailPoetVendor\Twig\Extension\OptimizerExtension; use MailPoetVendor\Twig\Loader\ArrayLoader; use MailPoetVendor\Twig\Loader\ChainLoader; use MailPoetVendor\Twig\Loader\LoaderInterface; use MailPoetVendor\Twig\Node\ModuleNode; use MailPoetVendor\Twig\Node\Node; use MailPoetVendor\Twig\NodeVisitor\NodeVisitorInterface; use MailPoetVendor\Twig\RuntimeLoader\RuntimeLoaderInterface; use MailPoetVendor\Twig\TokenParser\TokenParserInterface; class Environment { const VERSION = '2.13.1'; const VERSION_ID = 21301; const MAJOR_VERSION = 2; const MINOR_VERSION = 13; const RELEASE_VERSION = 1; const EXTRA_VERSION = ''; private $charset; private $loader; private $debug; private $autoReload; private $cache; private $lexer; private $parser; private $compiler; private $baseTemplateClass; private $globals = []; private $resolvedGlobals; private $loadedTemplates; private $strictVariables; private $templateClassPrefix = '__TwigTemplate_'; private $originalCache; private $extensionSet; private $runtimeLoaders = []; private $runtimes = []; private $optionsHash; public function __construct(\MailPoetVendor\Twig\Loader\LoaderInterface $loader, $options = []) { $this->setLoader($loader); $options = \array_merge(['debug' => \false, 'charset' => 'UTF-8', 'base_template_class' => \MailPoetVendor\Twig\Template::class, 'strict_variables' => \false, 'autoescape' => 'html', 'cache' => \false, 'auto_reload' => null, 'optimizations' => -1], $options); $this->debug = (bool) $options['debug']; $this->setCharset($options['charset']); $this->baseTemplateClass = '\\' . \ltrim($options['base_template_class'], '\\'); if ('\\' . \MailPoetVendor\Twig\Template::class !== $this->baseTemplateClass && '\\Twig_Template' !== $this->baseTemplateClass) { @\trigger_error('The "base_template_class" option on ' . __CLASS__ . ' is deprecated since Twig 2.7.0.', \E_USER_DEPRECATED); } $this->autoReload = null === $options['auto_reload'] ? $this->debug : (bool) $options['auto_reload']; $this->strictVariables = (bool) $options['strict_variables']; $this->setCache($options['cache']); $this->extensionSet = new \MailPoetVendor\Twig\ExtensionSet(); $this->addExtension(new \MailPoetVendor\Twig\Extension\CoreExtension()); $this->addExtension(new \MailPoetVendor\Twig\Extension\EscaperExtension($options['autoescape'])); $this->addExtension(new \MailPoetVendor\Twig\Extension\OptimizerExtension($options['optimizations'])); } public function getBaseTemplateClass() { if (1 > \func_num_args() || \func_get_arg(0)) { @\trigger_error('The ' . __METHOD__ . ' is deprecated since Twig 2.7.0.', \E_USER_DEPRECATED); } return $this->baseTemplateClass; } public function setBaseTemplateClass($class) { @\trigger_error('The ' . __METHOD__ . ' is deprecated since Twig 2.7.0.', \E_USER_DEPRECATED); $this->baseTemplateClass = $class; $this->updateOptionsHash(); } public function enableDebug() { $this->debug = \true; $this->updateOptionsHash(); } public function disableDebug() { $this->debug = \false; $this->updateOptionsHash(); } public function isDebug() { return $this->debug; } public function enableAutoReload() { $this->autoReload = \true; } public function disableAutoReload() { $this->autoReload = \false; } public function isAutoReload() { return $this->autoReload; } public function enableStrictVariables() { $this->strictVariables = \true; $this->updateOptionsHash(); } public function disableStrictVariables() { $this->strictVariables = \false; $this->updateOptionsHash(); } public function isStrictVariables() { return $this->strictVariables; } public function getCache($original = \true) { return $original ? $this->originalCache : $this->cache; } public function setCache($cache) { if (\is_string($cache)) { $this->originalCache = $cache; $this->cache = new \MailPoetVendor\Twig\Cache\FilesystemCache($cache); } elseif (\false === $cache) { $this->originalCache = $cache; $this->cache = new \MailPoetVendor\Twig\Cache\NullCache(); } elseif ($cache instanceof \MailPoetVendor\Twig\Cache\CacheInterface) { $this->originalCache = $this->cache = $cache; } else { throw new \LogicException(\sprintf('Cache can only be a string, false, or a \\Twig\\Cache\\CacheInterface implementation.')); } } public function getTemplateClass($name, $index = null) { $key = $this->getLoader()->getCacheKey($name) . $this->optionsHash; return $this->templateClassPrefix . \hash('sha256', $key) . (null === $index ? '' : '___' . $index); } public function render($name, array $context = []) { return $this->load($name)->render($context); } public function display($name, array $context = []) { $this->load($name)->display($context); } public function load($name) { if ($name instanceof \MailPoetVendor\Twig\TemplateWrapper) { return $name; } if ($name instanceof \MailPoetVendor\Twig\Template) { @\trigger_error('Passing a \\Twig\\Template instance to ' . __METHOD__ . ' is deprecated since Twig 2.7.0, use \\Twig\\TemplateWrapper instead.', \E_USER_DEPRECATED); return new \MailPoetVendor\Twig\TemplateWrapper($this, $name); } return new \MailPoetVendor\Twig\TemplateWrapper($this, $this->loadTemplate($name)); } public function loadTemplate($name, $index = null) { return $this->loadClass($this->getTemplateClass($name), $name, $index); } public function loadClass($cls, $name, $index = null) { $mainCls = $cls; if (null !== $index) { $cls .= '___' . $index; } if (isset($this->loadedTemplates[$cls])) { return $this->loadedTemplates[$cls]; } if (!\class_exists($cls, \false)) { $key = $this->cache->generateKey($name, $mainCls); if (!$this->isAutoReload() || $this->isTemplateFresh($name, $this->cache->getTimestamp($key))) { $this->cache->load($key); } $source = null; if (!\class_exists($cls, \false)) { $source = $this->getLoader()->getSourceContext($name); $content = $this->compileSource($source); $this->cache->write($key, $content); $this->cache->load($key); if (!\class_exists($mainCls, \false)) { eval('?>' . $content); } if (!\class_exists($cls, \false)) { throw new \MailPoetVendor\Twig\Error\RuntimeError(\sprintf('Failed to load Twig template "%s", index "%s": cache might be corrupted.', $name, $index), -1, $source); } } } $this->extensionSet->initRuntime($this); return $this->loadedTemplates[$cls] = new $cls($this); } public function createTemplate($template, string $name = null) { $hash = \hash('sha256', $template, \false); if (null !== $name) { $name = \sprintf('%s (string template %s)', $name, $hash); } else { $name = \sprintf('__string_template__%s', $hash); } $loader = new \MailPoetVendor\Twig\Loader\ChainLoader([new \MailPoetVendor\Twig\Loader\ArrayLoader([$name => $template]), $current = $this->getLoader()]); $this->setLoader($loader); try { return new \MailPoetVendor\Twig\TemplateWrapper($this, $this->loadTemplate($name)); } finally { $this->setLoader($current); } } public function isTemplateFresh($name, $time) { return $this->extensionSet->getLastModified() <= $time && $this->getLoader()->isFresh($name, $time); } public function resolveTemplate($names) { if (!\is_array($names)) { $names = [$names]; } foreach ($names as $name) { if ($name instanceof \MailPoetVendor\Twig\Template) { return $name; } if ($name instanceof \MailPoetVendor\Twig\TemplateWrapper) { return $name; } try { return $this->loadTemplate($name); } catch (\MailPoetVendor\Twig\Error\LoaderError $e) { if (1 === \count($names)) { throw $e; } } } throw new \MailPoetVendor\Twig\Error\LoaderError(\sprintf('Unable to find one of the following templates: "%s".', \implode('", "', $names))); } public function setLexer(\MailPoetVendor\Twig\Lexer $lexer) { $this->lexer = $lexer; } public function tokenize(\MailPoetVendor\Twig\Source $source) { if (null === $this->lexer) { $this->lexer = new \MailPoetVendor\Twig\Lexer($this); } return $this->lexer->tokenize($source); } public function setParser(\MailPoetVendor\Twig\Parser $parser) { $this->parser = $parser; } public function parse(\MailPoetVendor\Twig\TokenStream $stream) { if (null === $this->parser) { $this->parser = new \MailPoetVendor\Twig\Parser($this); } return $this->parser->parse($stream); } public function setCompiler(\MailPoetVendor\Twig\Compiler $compiler) { $this->compiler = $compiler; } public function compile(\MailPoetVendor\Twig\Node\Node $node) { if (null === $this->compiler) { $this->compiler = new \MailPoetVendor\Twig\Compiler($this); } return $this->compiler->compile($node)->getSource(); } public function compileSource(\MailPoetVendor\Twig\Source $source) { try { return $this->compile($this->parse($this->tokenize($source))); } catch (\MailPoetVendor\Twig\Error\Error $e) { $e->setSourceContext($source); throw $e; } catch (\Exception $e) { throw new \MailPoetVendor\Twig\Error\SyntaxError(\sprintf('An exception has been thrown during the compilation of a template ("%s").', $e->getMessage()), -1, $source, $e); } } public function setLoader(\MailPoetVendor\Twig\Loader\LoaderInterface $loader) { $this->loader = $loader; } public function getLoader() { return $this->loader; } public function setCharset($charset) { if ('UTF8' === ($charset = \strtoupper($charset))) { $charset = 'UTF-8'; } $this->charset = $charset; } public function getCharset() { return $this->charset; } public function hasExtension($class) { return $this->extensionSet->hasExtension($class); } public function addRuntimeLoader(\MailPoetVendor\Twig\RuntimeLoader\RuntimeLoaderInterface $loader) { $this->runtimeLoaders[] = $loader; } public function getExtension($class) { return $this->extensionSet->getExtension($class); } public function getRuntime($class) { if (isset($this->runtimes[$class])) { return $this->runtimes[$class]; } foreach ($this->runtimeLoaders as $loader) { if (null !== ($runtime = $loader->load($class))) { return $this->runtimes[$class] = $runtime; } } throw new \MailPoetVendor\Twig\Error\RuntimeError(\sprintf('Unable to load the "%s" runtime.', $class)); } public function addExtension(\MailPoetVendor\Twig\Extension\ExtensionInterface $extension) { $this->extensionSet->addExtension($extension); $this->updateOptionsHash(); } public function setExtensions(array $extensions) { $this->extensionSet->setExtensions($extensions); $this->updateOptionsHash(); } public function getExtensions() { return $this->extensionSet->getExtensions(); } public function addTokenParser(\MailPoetVendor\Twig\TokenParser\TokenParserInterface $parser) { $this->extensionSet->addTokenParser($parser); } public function getTokenParsers() { return $this->extensionSet->getTokenParsers(); } public function getTags() { $tags = []; foreach ($this->getTokenParsers() as $parser) { $tags[$parser->getTag()] = $parser; } return $tags; } public function addNodeVisitor(\MailPoetVendor\Twig\NodeVisitor\NodeVisitorInterface $visitor) { $this->extensionSet->addNodeVisitor($visitor); } public function getNodeVisitors() { return $this->extensionSet->getNodeVisitors(); } public function addFilter(\MailPoetVendor\Twig\TwigFilter $filter) { $this->extensionSet->addFilter($filter); } public function getFilter($name) { return $this->extensionSet->getFilter($name); } public function registerUndefinedFilterCallback(callable $callable) { $this->extensionSet->registerUndefinedFilterCallback($callable); } public function getFilters() { return $this->extensionSet->getFilters(); } public function addTest(\MailPoetVendor\Twig\TwigTest $test) { $this->extensionSet->addTest($test); } public function getTests() { return $this->extensionSet->getTests(); } public function getTest($name) { return $this->extensionSet->getTest($name); } public function addFunction(\MailPoetVendor\Twig\TwigFunction $function) { $this->extensionSet->addFunction($function); } public function getFunction($name) { return $this->extensionSet->getFunction($name); } public function registerUndefinedFunctionCallback(callable $callable) { $this->extensionSet->registerUndefinedFunctionCallback($callable); } public function getFunctions() { return $this->extensionSet->getFunctions(); } public function addGlobal($name, $value) { if ($this->extensionSet->isInitialized() && !\array_key_exists($name, $this->getGlobals())) { throw new \LogicException(\sprintf('Unable to add global "%s" as the runtime or the extensions have already been initialized.', $name)); } if (null !== $this->resolvedGlobals) { $this->resolvedGlobals[$name] = $value; } else { $this->globals[$name] = $value; } } public function getGlobals() { if ($this->extensionSet->isInitialized()) { if (null === $this->resolvedGlobals) { $this->resolvedGlobals = \array_merge($this->extensionSet->getGlobals(), $this->globals); } return $this->resolvedGlobals; } return \array_merge($this->extensionSet->getGlobals(), $this->globals); } public function mergeGlobals(array $context) { foreach ($this->getGlobals() as $key => $value) { if (!\array_key_exists($key, $context)) { $context[$key] = $value; } } return $context; } public function getUnaryOperators() { return $this->extensionSet->getUnaryOperators(); } public function getBinaryOperators() { return $this->extensionSet->getBinaryOperators(); } private function updateOptionsHash() { $this->optionsHash = \implode(':', [$this->extensionSet->getSignature(), \PHP_MAJOR_VERSION, \PHP_MINOR_VERSION, self::VERSION, (int) $this->debug, $this->baseTemplateClass, (int) $this->strictVariables]); } } \class_alias('MailPoetVendor\\Twig\\Environment', 'MailPoetVendor\\Twig_Environment'); 