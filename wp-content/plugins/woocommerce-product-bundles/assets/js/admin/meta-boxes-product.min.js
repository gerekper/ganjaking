jQuery(function(_){function n(i){var s=this;this.$element=i,this.$content=i.find("div.item-data"),this.$discount=this.$content.find(".discount"),this.$visibility=this.$content.find(".item_visibility"),this.$price_visibility=this.$content.find(".price_visibility"),this.$allowed_variations=this.$content.find("div.allowed_variations"),this.$default_variation_attributes=this.$content.find("div.default_variation_attributes"),this.$custom_title=this.$content.find("div.custom_title"),this.$custom_description=this.$content.find("div.custom_description"),this.$override_title=this.$content.find(".override_title"),this.$override_description=this.$content.find(".override_description"),this.$hide_thumbnail=this.$content.find(".hide_thumbnail"),this.$section_links=this.$content.find(".subsubsub a"),this.$sections=this.$content.find(".options_group"),this.$priced_individually_input=this.$content.find(".priced_individually input"),this.$override_variations_input=this.$content.find(".override_variations input"),this.$override_defaults_input=this.$content.find(".override_default_variation_attributes input"),this.$override_title_input=this.$override_title.find("input"),this.$override_description_input=this.$override_description.find("input"),this.$price_visibility_product_input=this.$price_visibility.find("input.price_visibility_product"),this.$price_visibility_cart_input=this.$price_visibility.find("input.price_visibility_cart"),this.$price_visibility_order_input=this.$price_visibility.find("input.price_visibility_order"),this.$visibility_product_input=this.$visibility.find("input.visibility_product"),this.$visibility_cart_input=this.$visibility.find("input.visibility_cart"),this.$visibility_order_input=this.$visibility.find("input.visibility_order"),this.$min_qty=this.$content.find(".quantity_min"),this.$min_qty_input=this.$min_qty.find("input.item_quantity"),this.$max_qty=this.$content.find(".quantity_max"),this.$max_qty_input=this.$max_qty.find("input.item_quantity"),this.$default_qty=this.$content.find(".quantity_default"),this.$default_qty_input=this.$default_qty.find("input.item_quantity"),this.$optional_checkbox=this.$content.find("div.optional"),this.$optional_checkbox_input=this.$optional_checkbox.find("input.checkbox"),this.max_qty_prev=this.$max_qty_input.val(),this.default_qty_prev=this.$default_qty_input.val(),this.add_error_tip=function(i,t){var e=i.position();0===i.parent().find(".wc_error_tip").length?(i.after('<div class="wc_error_tip">'+t+"</div>"),i.parent().find(".wc_error_tip").css("left",e.left+i.width()-i.width()/2-_(".wc_error_tip").width()/2).css("top",e.top+i.height()+4).fadeIn("100")):i.parent().find(".wc_error_tip").html(t)},this.remove_error_tip=function(i){i.parent().find(".wc_error_tip").fadeOut("100",function(){_(this).remove()})},this.maybe_hide_optional_checkbox=function(i){"min"===i&&(0<s.$min_qty_input.val()?(s.$optional_checkbox.show(),s.$optional_checkbox_input.prop("disabled",!1)):s.$optional_checkbox.data("is_optional_qty_zero")&&"no"===s.$optional_checkbox.data("is_optional_qty_zero")&&(s.$optional_checkbox.hide(),s.$optional_checkbox_input.prop("disabled",!0)))},this.validate_quantity=function(i,t){var e=s.$min_qty_input,n=("max"===i?e=s.$max_qty_input:"default"===i&&(e=s.$default_qty_input),e.val()),d=parseFloat(e.attr("min")),o=parseFloat(e.attr("max")),e=parseFloat(e.attr("step")),a={qty:n,error:""};return 0<=d&&(n<d||isNaN(n))?"max"===i&&""===n||(a.qty="max"===t?s.max_qty_prev:"default"===t?s.default_qty_prev:d,a.error=wc_bundles_admin_params.i18n_qty_low_error.replace("%s",d)):0<o&&o<n?(a.qty="default"===t?s.default_qty_prev:o,a.error=wc_bundles_admin_params.i18n_qty_high_error.replace("%s",o)):0<e&&0<n&&n%e&&(a.qty=e*Math.ceil(n/e),a.error=wc_bundles_admin_params.i18n_qty_step_error.replace("%s",e)),a},this.priced_individually_input_changed=function(){s.$priced_individually_input.is(":checked")?(s.$discount.show(),s.$price_visibility.show()):(s.$discount.hide(),s.$price_visibility.hide())},this.override_variations_input_changed=function(){s.$override_variations_input.is(":checked")?s.$allowed_variations.show():s.$allowed_variations.hide()},this.override_defaults_input_changed=function(){s.$override_defaults_input.is(":checked")?s.$default_variation_attributes.show():s.$default_variation_attributes.hide()},this.override_title_input_changed=function(){s.$override_title_input.is(":checked")?s.$custom_title.show():s.$custom_title.hide()},this.override_description_input_changed=function(){s.$override_description_input.is(":checked")?s.$custom_description.show():s.$custom_description.hide()},this.visibility_product_input_changed=function(){s.$visibility_product_input.is(":checked")?(s.$override_title.show(),s.$override_description.show(),s.$hide_thumbnail.show(),s.override_title_input_changed(),s.override_description_input_changed()):(s.$override_title.hide(),s.$override_description.hide(),s.$hide_thumbnail.hide(),s.$custom_description.hide(),s.$custom_title.hide())},this.toggled_visibility=function(i){s["$visibility_"+i+"_input"].is(":checked")?s["$price_visibility_"+i+"_input"].css("opacity",1):s["$price_visibility_"+i+"_input"].css("opacity",.5)},this.section_changed=function(i){s.$section_links.removeClass("current"),i.addClass("current"),s.$sections.addClass("options_group_hidden"),s.$content.find(".options_group_"+i.data("tab")).removeClass("options_group_hidden")},this.initialize=function(){s.priced_individually_input_changed(),s.override_variations_input_changed(),s.override_defaults_input_changed(),s.override_title_input_changed(),s.override_description_input_changed(),s.visibility_product_input_changed(),s.toggled_visibility("product"),s.toggled_visibility("cart"),s.toggled_visibility("order"),s.$element.sw_select2()},this.initialize()}var d,i,t,e=_("p._wc_pb_edit_in_cart_field"),o=_("select#product-type"),a=_("select#_wc_pb_group_mode"),s=_("#bundled_product_data"),r=s.find(".wc-metaboxes-wrapper"),c=s.find(".toolbar"),l=_(".wc-bundled-items"),u=_(".wc-bundled-item",l),p=_("#bundled_product",s),h={},v=u.length,b={message:null,overlayCSS:{background:"#fff",opacity:.6}},f=s.parent().find("#shipping_product_data"),m=_("input#_virtual"),g=m.prop("checked"),y=!1,$=_("input#_virtual_bundle"),w=f.find(".options_group.bundle_type"),q=w.find(".bundle_type_options li");function k(){0<u.length?(r.removeClass("no-items"),c.removeClass("disabled")):(r.addClass("no-items"),c.addClass("disabled"))}_.fn.wc_bundles_select2=function(){_(document.body).trigger("wc-enhanced-select-init")},_(".bundle_stock_msg").appendTo("._manage_stock_field .description"),_("#_sold_individually").closest(".form-field").addClass("hide_if_bundle"),_("#linked_product_data .grouping.show_if_simple, #linked_product_data .form-field.show_if_grouped").addClass("hide_if_bundle"),_(".show_if_simple:not(.hide_if_bundle)").addClass("show_if_bundle"),_("body").on("woocommerce-product-type-change",function(i,t){"bundle"===t&&(_(".show_if_external").hide(),_(".show_if_bundle").show(),_("input#_manage_stock").trigger("change"),_("#_nyp").trigger("change"),y&&$.prop("checked",m.prop("checked")),$.prop("checked")||m.prop("checked",!1).change(),"unassembled"===q.find("input.bundle_type_option:checked").first().val())&&(f.addClass("bundle_unassembled"),s.addClass("bundle_unassembled"))}),_("form#post").on("submit",function(){var i,t,e;"bundle"===o.val()&&(i=_(this),t=_('<input type="hidden" name="pb_post_control_var" value="1"/>'),e=_('<input type="hidden" name="pb_post_test_var" value="1"/>'),i.prepend(t),i.append(e))}),a.on("change",function(){-1===_.inArray(a.val(),wc_bundles_admin_params.group_modes_with_parent)?e.hide():e.show()}),_("input#_downloadable").on("change",function(){o.trigger("change")}),p.on("change",function(){var i,t=p.val(),t=!!(t&&0<t.length)&&t.shift();return t&&(p.val([]).trigger("change"),s.block(b),v++,i={action:"woocommerce_add_bundled_product",post_id:woocommerce_admin_meta_boxes.post_id,id:v,product_id:t,security:wc_bundles_admin_params.add_bundled_product_nonce},setTimeout(function(){_.post(woocommerce_admin_meta_boxes.ajax_url,i,function(i){var t,e;""!==i.markup?(l.append(i.markup),t=_(".wc-bundled-item",l).last(),e="bundled_item_"+v,t.data("bundled_item_id",e),h[e]=new n(t),s.triggerHandler("wc-bundled-products-changed"),t.find(".woocommerce-help-tip").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200}),t.wc_bundles_select2(),s.trigger("wc-bundles-added-bundled-product")):""!==i.message&&window.alert(i.message),p.selectSW("open"),p.selectSW("close"),s.unblock()})},250)),!1}),r.on("click",".expand_all",function(){return _(this).hasClass("disabled")||_.each(h,function(i,t){t.$element.addClass("open").removeClass("closed")}),!1}).on("click",".close_all",function(){return _(this).hasClass("disabled")||_.each(h,function(i,t){t.$element.addClass("closed").removeClass("open")}),!1}),s.on("wc-bundled-products-changed",function(){(u=_(".wc-bundled-item",l)).each(function(i,t){_(".item_menu_order",t).val(i)}),k()}).one("wc-bundles-added-bundled-product",function(){r.removeClass("wc-bundle-metaboxes-wrapper--boarding")}),l.on("input change","input.item_quantity",function(i){var t,e,n,d=_(this),o=d.closest(".wc-bundled-item").data("bundled_item_id"),a=h[o],o="min",s=(d.hasClass("item_quantity_max")?o="max":d.hasClass("item_quantity_default")&&(o="default"),a.validate_quantity(o,o));s.error?"input"===event.type?setTimeout(function(){a.add_error_tip(d,s.error)},5):d.val(s.qty).change():(a.remove_error_tip(d),"change"===event.type&&(t=a.$min_qty_input.val(),e=a.$max_qty_input.val(),n=a.$default_qty_input.val(),a.$max_qty_input.attr("min",t),"default"!==o&&((s=a.validate_quantity("max",o)).error&&(a.$max_qty_input.val(s.qty),e=s.qty),a.max_qty_prev=e),a.$default_qty_input.attr("min",t),a.$default_qty_input.attr("max",e),(s=a.validate_quantity("default",o)).error&&(a.$default_qty_input.val(s.qty),n=s.qty),a.default_qty_prev=n,a.maybe_hide_optional_checkbox(o)))}).on("click","a.edit-product",function(i){i.stopPropagation()}).on("click","a.remove_row",function(i){var t=_(this).closest(".wc-bundled-item"),e=t.data("bundled_item_id");t.find("*").off(),t.remove(),delete h[e],s.triggerHandler("wc-bundled-products-changed"),i.preventDefault()}).on("change",".priced_individually input",function(){var i=_(this).closest(".wc-bundled-item").data("bundled_item_id");h[i].priced_individually_input_changed()}).on("change",".override_variations input",function(){var i=_(this).closest(".wc-bundled-item").data("bundled_item_id");h[i].override_variations_input_changed()}).on("change",".override_default_variation_attributes input",function(){var i=_(this).closest(".wc-bundled-item").data("bundled_item_id");h[i].override_defaults_input_changed()}).on("change",".override_title input",function(){var i=_(this).closest(".wc-bundled-item").data("bundled_item_id");h[i].override_title_input_changed()}).on("change",".override_description input",function(){var i=_(this).closest(".wc-bundled-item").data("bundled_item_id");h[i].override_description_input_changed()}).on("change","input.visibility_product",function(){var i=_(this).closest(".wc-bundled-item").data("bundled_item_id"),i=h[i];i.visibility_product_input_changed(),i.toggled_visibility("product")}).on("change","input.visibility_cart",function(){var i=_(this).closest(".wc-bundled-item").data("bundled_item_id");h[i].toggled_visibility("cart")}).on("change","input.visibility_order",function(){var i=_(this).closest(".wc-bundled-item").data("bundled_item_id");h[i].toggled_visibility("order")}).on("click",".subsubsub a",function(i){var t=_(this),e=_(this).closest(".wc-bundled-item").data("bundled_item_id");h[e].section_changed(t),i.preventDefault()}),u.each(function(i){var t=_(this),i="bundled_item_"+i;t.data("bundled_item_id",i),h[i]=new n(t)}),l.sortable({items:".wc-bundled-item",cursor:"move",axis:"y",handle:".sort-item",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(i,t){t.item.css("background-color","#f6f6f6")},stop:function(i,t){t.item.removeAttr("style"),s.triggerHandler("wc-bundled-products-changed")}}),k(),w.detach().prependTo(f),f.find(".form-field._weight_field").after(w.find(".form-field.bundle_aggregate_weight_field")),$.on("change",function(){var i=$.prop("checked");m.prop("checked")!==i&&m.prop("checked",i).trigger("change"),i?s.addClass("bundle_virtual"):s.removeClass("bundle_virtual")}),m.on("change",function(){m.prop("checked")!==g&&(y=!0)}),q.on("click",function(){var i=_(this),t=i.find("input").prop("checked","checked").val();q.removeClass("selected"),i.addClass("selected"),"assembled"===t?(f.removeClass("bundle_unassembled"),s.removeClass("bundle_unassembled")):"unassembled"===t&&(f.addClass("bundle_unassembled"),s.addClass("bundle_unassembled"))}),"yes"===wc_bundles_admin_params.is_first_bundle&&(o.val("bundle").trigger("change").trigger("focus"),setTimeout(function(){_(".bundled_products_tab a").trigger("click")},500)),w=s.find(".add_bundled_product"),i=w.find(".sw-expanding-button"),t=_(document.body),i.length?(i.sw_select2(),i.on("click",function(i){i.stopPropagation(),clearTimeout(d);var t=_(this),e=t.find(".select2-search__field");t.addClass("sw-expanding-button--open"),d=setTimeout(function(){e.trigger("focus")},700),p.one("change",function(){t.removeClass("sw-expanding-button--open")})}),t.on("click",".select2-container",function(i){i.stopPropagation()}),t.on("click",function(){i.removeClass("sw-expanding-button--open")})):w.sw_select2(),o.trigger("change"),a.trigger("change")});