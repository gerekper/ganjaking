jQuery(function(c){var e=c("#woocommerce-pinterest-catalog-updating-frequency-days").parents("tr"),t=c("#woocommerce_pinterest_enable_catalog_auto_updating");c(document).on("click","button[data-var]",function(){var e=c(this);!function(e,t){var n=document.querySelector(e);if(!n)return;n.focus();var o=n.value,r=n.selectionStart;n.value=o.slice(0,r)+t+o.slice(r),r+=t.length,n.setSelectionRange(r,r)}(e.data("field"),e.data("var"))}),c(document).on("change",".woocommerce-pinterest-google-category-select",function(e){var t=c(e.target),n=t.val();t.nextAll("select").remove(),t.is(":last-of-type")&&t.parent("fieldset").children(".woocommerce-pinterest-google-categories-mapping").val(n),""!==n&&c.ajax({url:window.ajaxurl,method:"GET",dataType:"json",data:{action:premmerceSettings.get_google_categories_action,parentId:n,_ajax_nonce:premmerceSettings.get_google_categories_nonce},success:function(e){if(0<e.length){var n=t.clone().val("").empty();n.append(new Option(premmerceSettings.not_selected_option_name)),c.each(e,function(e,t){n.append(new Option(t.name,t.id))}),n.insertAfter(t)}}})}),c(document).on("click",".woocommerce-pinterest-category-board-new-select",function(e){e.preventDefault();var t=c(e.target).parent("td").find("fieldset").find(".woocommerce-pinterest-board-select-container"),n=t.first().clone();n.find("select").val(""),n.find("input").val("");var o=t.last(),r=new RegExp("^([^\\[]+\\[\\d+]\\[)(\\d+)(]\\[board_id])"),s=parseInt(o.find("select").attr("name").match(r)[2])+1,i=n.find("select").attr("name");i=i.replace(r,function(e,t,n,o,r,i){return[t,s,o].join("")}),n.find("select").attr("name",i),n.insertAfter(o)}),c(document).on("click",".woocommerce-pinterest-remove-board-select",function(e){e.preventDefault(),c(this).parents(".woocommerce-pinterest-board-select-container").remove()});var o=c("#woocommerce_pinterest_tags_fetching_strategy");o.select2(),c("ul.select2-selection__rendered").sortable({containment:"parent",update:function(e){c(e.target).children("li[title]").each(function(e,n){o.children("option").each(function(){c(n);if(c(this).html()==n.title){var e=c(this),t=e.parent();e.detach(),t.append(e)}})}),o.trigger("change")}}),e.toggle(t.is(":checked")),t.on("change",function(){e.toggle()}),c(document).on("click",".woocommerce-pinterest-copy-catalog-url-button",function(){c(".woocommerce-pinterest-catalog-url-field").select(),document.execCommand("copy")}),c("[name=woocommerce_pinterest_pin_time]").on("change",function(e){var t=[c("#woocommerce_pinterest_pin_defer_day").closest("tr"),c("#woocommerce_pinterest_pin_defer_time").closest("tr"),c("#woocommerce_pinterest_pin_defer_interval").closest("tr")];c("[name=woocommerce_pinterest_pin_defer_interval]").trigger("change"),"defer"===c(this).val()?t.forEach(function(e){e.show()}):t.forEach(function(e){e.hide()})}).trigger("change"),c("[name=woocommerce_pinterest_pin_defer_interval]").on("change",function(e){var t=[c("#woocommerce_pinterest_pin_defer_pins_per_interval").closest("tr")];"-1"===c(this).val()||"defer"!==c("[name=woocommerce_pinterest_pin_time]").val()?t.forEach(function(e){e.hide()}):t.forEach(function(e){e.show()})}).trigger("change"),c("[name=woocommerce_pinterest_pinterest_image_size_type]").on("change",function(e){var t=c("#pinterest_image_size-field");"pinterest_image"===c(this).val()?t.show():t.hide()}).trigger("change"),c(document).on("click","h3.wc-settings-sub-title",function(e){var t=c(this).toggleClass("closed"),n=t.prop("id").replace("woocommerce_pinterest_",""),o=t.hasClass("closed");c.ajax({url:window.ajaxurl,method:"POST",dataType:"json",data:{action:premmerceSettings.update_settings_page_boxes_states_action,sectionId:n,closed:o,_ajax_nonce:premmerceSettings.update_settings_page_boxes_states_nonce}})}),c("#start_pin_all_process_button").on("click",function(e){if(e.preventDefault(),confirm("Are you sure you want to pin product images according to the Pinterest boards settings? Non-boarded products will be skipped?")){var t=c("#woocommerce_pinterest_pin_all_images").prop("checked")?1:0;window.location=c(this).data("url")+"&pin_all_gallery_images="+t}});function n(e){this.element=c(e),this.interval=null,this.init=function(){this.element.length&&(this.interval=setInterval(this.update.bind(this),2e3))},this.update=function(){c.ajax({url:ajaxurl,data:{action:this.element.data("action"),nonce:this.element.data("nonce")}}).done(function(e){if(e.error&&(alert(error),window.location.reload()),e.process_status)if("pending"===e.process_status.status)this.element.closest("tr").css("display","none"),clearInterval(this.interval);else if("processing"===e.process_status.status){this.element.closest("tr").css("display","table-row");var t=e.process_status.processing_category;if(void 0!==t.products_total&&void 0!==t.name&&void 0!==t.products_processed){var n=parseInt(t.products_total),o=parseInt(t.products_processed),r=(o=isNaN(o)?0:o)/(n/100),i=Math.round(i);this.setCategoryName(t.name),this.setProcessedProductCounts(o),this.setTotalProductCounts(n),this.setPercentagePart(r),this.setProgress(Math.min(100,r))}}}.bind(this))},this.setProgress=function(e){this.element.find("progress").val(e)},this.setCategoryName=function(e){this.element.find(".woocommerce-importer-progress__category").text(e)},this.setProcessedProductCounts=function(e){this.element.find(".woocommerce-importer-progress__pushed").text(e)},this.setTotalProductCounts=function(e){this.element.find(".woocommerce-importer-progress__total").text(e)},this.setPercentagePart=function(e){this.element.find(".woocommerce-importer-progress__percents").text(e)}}c(document).ready(function(){new n(".woocommerce-importer-progress").init()})});