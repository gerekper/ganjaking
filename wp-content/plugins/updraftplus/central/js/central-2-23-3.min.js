function updraftcentral_send_command(e,r,a,o){for(var t in default_options={json_parse:!0,alert_on_error:!0,action:"updraft_central_ajax",nonce_key:"nonce",timeout:null,async:!0,type:"POST"},void 0!==uclion.updraftcentral_request_nonce&&uclion.updraftcentral_request_nonce&&(default_options.nonce=uclion.updraftcentral_request_nonce),void 0===o&&(o={}),default_options)o.hasOwnProperty(t)||(o[t]=default_options[t]);e={action:o.action,subaction:e},e[o.nonce_key]=o.nonce,e.action_data=r,r={type:o.type,url:ajaxurl,data:e,success:function(r,e){if(o.json_parse){try{var t=central_parse_json(r)}catch(e){return"function"==typeof o.error_callback?o.error_callback(r,e,502,t):(console.log(e),console.log(r),void(o.alert_on_error&&alert(uclion.unexpectedresponse+" "+r)))}if(t.hasOwnProperty("fatal_error"))return"function"==typeof o.error_callback?o.error_callback(r,e,500,t):(console.error(t.fatal_error_message),o.alert_on_error&&alert(t.fatal_error_message),!1);"function"==typeof a&&a(t,e,r)}else"function"==typeof a&&a(r,e)},error:function(e,r,t){"function"==typeof o.error_callback?o.error_callback(e,r,t):(console.log("updraftcentral_send_command: error: "+r+" ("+t+")"),console.log(e))},dataType:"text",async:o.async};null!=o.timeout&&(r.timeout=o.timeout),jQuery.ajax(r)}function central_parse_json(r,t){if(!(t=void 0!==t))try{return JSON.parse(r)}catch(e){console.log(uclion.plugin_name+": Exception when trying to parse JSON (1) - will attempt to fix/re-parse based upon first/last curly brackets"),console.log(r)}var a=r.indexOf("{"),o=r.lastIndexOf("}");if(-1<a&&-1<o){var e=r.slice(a,o+1);try{var n=JSON.parse(e);return t||console.log(uclion.plugin_name+": JSON re-parse successful"),t?{parsed:n,json_start_pos:a,json_last_pos:o+1}:n}catch(e){console.log(uclion.plugin_name+": Exception when trying to parse JSON (2) - will attempt to fix/re-parse based upon bracket counting");for(var l=a,c=0,u="",s=!1;(0<c||l==a)&&l<=o;){var _=r.charAt(l);s||"{"!=_?s||"}"!=_?'"'==_&&"\\"!=u&&(s=!s):c--:c++,u=_,l++}console.log("Started at cursor="+a+", ended at cursor="+l+" with result following:"),console.log(r.substring(a,l));try{n=JSON.parse(r.substring(a,l));return console.log(uclion.plugin_name+": JSON re-parse successful"),t?{parsed:n,json_start_pos:a,json_last_pos:l}:n}catch(e){throw e}}}throw uclion.plugin_name+": could not parse the JSON"}jQuery(function(r){function e(e){!!jQuery("#updraftcentral_mothership_other").is(":checked")?(jQuery("#updraftcentral_keycreate_mothership").prop("disabled",!1),e?jQuery("#updraftcentral_keycreate_mothership_firewalled_container").show():(jQuery(".updraftcentral_wizard_self_hosted_stage2").show(),jQuery("#updraftcentral_keycreate_mothership_firewalled_container").slideDown(),jQuery("#updraftcentral_keycreate_mothership").trigger("focus"))):(jQuery("#updraftcentral_keycreate_mothership").prop("disabled",!0),e||(jQuery(".updraftcentral_wizard_self_hosted_stage2").hide(),t()))}function t(){jQuery("#updraftcentral_wizard_stage1_error").text("");var r="";if(jQuery("#updraftcentral_mothership_updraftpluscom").is(":checked"))jQuery(".updraftcentral_keycreate_description").hide(),r="updraftplus.com";else if(jQuery("#updraftcentral_mothership_other").is(":checked")){jQuery(".updraftcentral_keycreate_description").show();var t=jQuery("#updraftcentral_keycreate_mothership").val();if(""==t)return void jQuery("#updraftcentral_wizard_stage1_error").text(uclion.updraftcentral_wizard_empty_url);try{r=new URL(t).hostname}catch(e){if(!(r="undefined"==typeof URL?jQuery("<a>").prop("href",t).prop("hostname"):r)||"undefined"!=typeof URL)return void jQuery("#updraftcentral_wizard_stage1_error").text(uclion.updraftcentral_wizard_invalid_url)}}jQuery("#updraftcentral_keycreate_description").val(r),jQuery(".updraftcentral_wizard_stage1").hide(),jQuery(".updraftcentral_wizard_stage2").show()}r("#updraftcentral_keys").on("click","a.updraftcentral_keys_show",function(e){e.preventDefault(),r(this).remove(),r("#updraftcentral_keys_table").slideDown()}),r("#updraftcentral_keycreate_altmethod_moreinfo_get").on("click",function(e){e.preventDefault(),r(this).remove(),r("#updraftcentral_keycreate_altmethod_moreinfo").slideDown()}),jQuery("#updraftcentral_keys").on("click",'input[type="radio"]',function(){e(!1)}),e(!0),jQuery("#updraftcentral_keys").on("click","#updraftcentral_view_log",function(e){e.preventDefault(),jQuery("#updraftcentral_view_log_container").block({message:'<div style="margin: 8px; font-size:150%;"><img src="'+uclion.central_url+'/images/udlogo-rotating.gif" height="80" width="80" style="padding-bottom:10px;"><br>'+uclion.fetching+"</div>"});try{updraftcentral_send_command("get_log",null,function(e){jQuery("#updraftcentral_view_log_container").unblock(),e.hasOwnProperty("log_contents")?jQuery("#updraftcentral_view_log_contents").html('<div style="border:1px solid;padding: 2px;max-height: 400px; overflow-y:scroll;">'+e.log_contents+"</div>"):console.log(e)},{error_callback:function(e,r,t,a){jQuery("#updraftcentral_view_log_container").unblock(),void 0!==a&&a.hasOwnProperty("fatal_error")?(console.error(a.fatal_error_message),alert(a.fatal_error_message)):(a="updraftcentral_send_command: error: "+r+" ("+t+")",console.log(a),alert(a),console.log(e))}})}catch(e){jQuery("#updraft_central_key").html(),console.log(e)}}),jQuery("#updraftcentral_keys").on("click","#updraftcentral_wizard_go",function(e){jQuery("#updraftcentral_wizard_go").hide(),jQuery(".updraftcentral_wizard_success").remove(),jQuery(".create_key_container").show()}),jQuery("#updraftcentral_keys").on("click","#updraftcentral_stage1_go",function(e){e.preventDefault(),jQuery(".updraftcentral_wizard_stage2").hide(),jQuery(".updraftcentral_wizard_stage1").show()}),jQuery("#updraftcentral_keys").on("click","#updraftcentral_stage2_go",function(e){e.preventDefault(),t()}),jQuery("#updraftcentral_keys").on("click","#updraftcentral_keycreate_go",function(e){e.preventDefault();var e=!!jQuery("#updraftcentral_mothership_other").is(":checked"),r=jQuery("#updraftcentral_keycreate_description").val(),t=jQuery("#updraftcentral_keycreate_keysize").val(),a="__updraftpluscom";if(data={key_description:r,key_size:t},e&&"http"!=(a=jQuery("#updraftcentral_keycreate_mothership").val()).substring(0,4))alert(uclion.enter_mothership_url);else{data.mothership_firewalled=jQuery("#updraftcentral_keycreate_mothership_firewalled").is(":checked")?1:0,data.where_send=a,jQuery(".create_key_container").hide(),jQuery(".updraftcentral_wizard_stage1").show(),jQuery(".updraftcentral_wizard_stage2").hide(),jQuery("#updraftcentral_keys").block({message:'<div style="margin: 8px; font-size:150%;"><img src="'+uclion.central_url+'/images/udlogo-rotating.gif" height="80" width="80" style="padding-bottom:10px;"><br>'+uclion.creating_please_allow+"</div>"});try{updraftcentral_send_command("create_key",data,function(e){jQuery("#updraftcentral_keys").unblock();try{if(e.hasOwnProperty("error"))return alert(e.error),void console.log(e);alert(e.r),e.hasOwnProperty("bundle")&&e.hasOwnProperty("keys_guide")?(jQuery("#updraftcentral_keys_content").html(e.keys_guide),jQuery("#updraftcentral_keys_content").append('<div class="updraftcentral_wizard_success">'+e.r+'<br><textarea onclick="this.select();" style="width:620px; height:165px; word-wrap:break-word; border: 1px solid #aaa; border-radius: 3px; padding:4px;">'+e.bundle+"</textarea></div>")):console.log(e),e.hasOwnProperty("keys_table")&&jQuery("#updraftcentral_keys_content").append(e.keys_table),jQuery("#updraftcentral_wizard_go").show()}catch(e){alert(uclion.unexpectedresponse+" "+response),console.log(e)}},{error_callback:function(e,r,t,a){jQuery("#updraftcentral_keys").unblock(),void 0!==a&&a.hasOwnProperty("fatal_error")?(console.error(a.fatal_error_message),alert(a.fatal_error_message)):(a="updraftcentral_send_command: error: "+r+" ("+t+")",console.log(a),alert(a),console.log(e))}})}catch(e){jQuery("#updraft_central_key").html(),console.log(e)}}}),jQuery("#updraftcentral_keys").on("click",".updraftcentral_key_delete",function(e){e.preventDefault();e=jQuery(this).data("key_id");void 0===e?console.log("UpdraftPlus: .updraftcentral_key_delete clicked, but no key ID found"):(jQuery("#updraftcentral_keys").block({message:'<div style="margin: 8px; font-size:150%;"><img src="'+uclion.central_url+'/images/udlogo-rotating.gif" height="80" width="80" style="padding-bottom:10px;"><br>'+uclion.deleting+"</div>"}),updraftcentral_send_command("delete_key",{key_id:e},function(e){jQuery("#updraftcentral_keys").unblock(),e.hasOwnProperty("keys_table")&&jQuery("#updraftcentral_keys_content").html(e.keys_table)},{error_callback:function(e,r,t,a){jQuery("#updraftcentral_keys").unblock(),void 0!==a&&a.hasOwnProperty("fatal_error")?(console.error(a.fatal_error_message),alert(a.fatal_error_message)):(a="updraftcentral_send_command: error: "+r+" ("+t+")",console.log(a),alert(a),console.log(e))}}))})});