/*! woocommerce-free-gift-coupons 2.5.0 */

var WC_Free_Gift_Coupons={};!function(e,i){i.Product=Backbone.Model.extend({defaults:{quantity:1,title:"",product_id:"",variation_id:"",gift_id:""},initialize:function(){this.get("gift_id").length||this.set("gift_id",0<this.get("variation_id")?this.get("variation_id"):this.get("product_id"))}}),i.ProductsCollection=Backbone.Collection.extend({model:i.Product,el:"#wc-free-gift-container"}),i.productView=Backbone.View.extend({model:i.Product,tagName:"tr",events:{"click .delete-product":"removeProduct","change .product-quantity :input":"setQuantity"},template:wp.template("wc-free-gift-product"),render:function(){return this.$el.html(this.template(this.model.toJSON())),this},reorder:function(e,t){this.$el.trigger("update-sort",[this.model,t])},removeProduct:function(e){e.preventDefault(),this.model.destroy(),i.productList.render()},setQuantity:function(e){value=this.$el.find(".product-quantity :input").val(),this.model.set("quantity",value)}}),i.productListTable=Backbone.View.extend({el:"#wc-free-gift-table",template:wp.template("wc-free-gift-products-table-header"),addSingle:function(e){var t=new i.productView({model:e});this.$el.find("tbody").prepend(t.render().el)},addProduct:function(e,t){Product=new i.Product(t),this.collection.add(Product,{at:0}),this.render()},events:{"click .delete-product":"removeProduct",addFreeGiftProduct:"addProduct"},render:function(){return this.$el.children().remove(),this.collection.length&&(this.$el.html(this.template()),this.collection.each(function(e){this.$el.find("tbody").append(new i.productView({model:e}).render().el)},this)),this}}),i.initApplication=function(){i.productCollection=new i.ProductsCollection(woocommerce_free_gift_coupon_meta_i18n.free_gifts),i.productList=new i.productListTable({collection:i.productCollection}),i.productList.render()},jQuery(document).ready(function(o){i.initApplication(),o("#wc-free-gift-table").sortable({items:"tbody > tr",handle:".product-title",axis:"y",opacity:.5,grid:[20,10],tolerance:"pointer"}),o(document.body).trigger("wc-enhanced-select-init"),o("#free_gift_ids").hasClass("select2-hidden-accessible")&&o("#free_gift_ids").on("select2:select",function(e){var t=e.params.data;if(t.id.length){var i={gift_id:t.id,title:t.text};o("#wc-free-gift-table").trigger("addFreeGiftProduct",i),o(this).val([]).change(),o("#wc-free-gift-table").sortable("refresh")}}),o("select#discount_type").change(function(){var e=o(this).val();$toggle_fields=o(".coupon_amount_field"),coupon_types=jQuery.parseJSON(woocommerce_free_gift_coupon_meta_i18n.coupon_types),-1!==o.inArray(e,coupon_types)?(o(".show_if_free_gift").show(),"free_gift"==e?$toggle_fields.hide():$toggle_fields.show()):(o(".show_if_free_gift").hide(),$toggle_fields.show())}).change()})}(jQuery,WC_Free_Gift_Coupons);