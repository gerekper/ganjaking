jQuery(function(c){var n,i=c("#wcsatt_data"),t=i.find("select#_wcsatt_schemes_status"),e=i.find(".additional_scheme_options"),s=e.find("input#_wcsatt_allow_one_off"),a=e.find(".wcsatt_image_select__container"),o=e.find("textarea#_wcsatt_subscription_prompt"),_=i.find(".subscription_schemes"),r=_.find(".subscription_scheme"),p=r.length,d={message:null,overlayCSS:{background:""!==wcsatt_admin_params.post_id?"#fff":"#f1f1f1",opacity:.6}};function l(){0<r.length?(s.prop("disabled",!1),o.prop("disabled",!1)):(s.prop("checked",!0).trigger("change"),s.prop("disabled",!0),o.prop("disabled",!0)),m()}function h(){0<r.length?i.removeClass("planless onboarding"):i.addClass("planless onboarding"),1<r.length?i.addClass("more_than_one_plan"):i.removeClass("more_than_one_plan"),s.is(":checked")?i.addClass("onetime_enabled"):i.removeClass("onetime_enabled")}function u(){var t=c("select#product-type").val(),n=r.length;"subscription"!==t&&"variable-subscription"!==t&&(0<n?c(".subscription_one_time_shipping").show():c(".subscription_one_time_shipping").hide())}function m(){a.removeClass("disabled"),(1===r.length&&!s.is(":checked")||0===r.length&&s.is(":checked"))&&a.addClass("disabled")}function f(){r.each(function(t,n){c(".position",n).val(parseInt(c(n).index(".subscription_schemes .subscription_scheme"),10)),c(n).attr("rel",t)})}c.fn.wcsatt_init_help_tips=function(){c(this).find(".help_tip, .tips, .woocommerce-help-tip").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200})},c.fn.wcsatt_init_type_dependent_inputs=function(){var t=c("select#product-type").val(),n="variable"===t?wcsatt_admin_params.i18n_override_option_variable:wcsatt_admin_params.i18n_override_option,i="variable"===t?wcsatt_admin_params.i18n_inherit_option_variable:wcsatt_admin_params.i18n_inherit_option,t="variable"===t?wcsatt_admin_params.i18n_discount_description_variable:wcsatt_admin_params.i18n_discount_description;c(this).find('.subscription_pricing_method_input [value="inherit"]').text(i),c(this).find('.subscription_pricing_method_input [value="override"]').text(n),c(this).find(".subscription_price_discount .woocommerce-help-tip").attr("data-tip",t).wcsatt_init_help_tips()},c.fn.wcsatt_refresh_days_in_month=function(){var t=c(this),n=t.find(".satt_subscription_payment_sync_date_day"),i=t.find(".subscription_sync_annual"),t=parseInt(t.find(".wc_input_subscription_payment_sync_date_month").val(),10);t?(t=new Date(Date.UTC(2001,t,0)).getUTCDate(),n.val()>t&&n.val(t),n.attr({step:"1",min:"1",max:t}),i.addClass("subscription_sync_annual--synced")):i.removeClass("subscription_sync_annual--synced")},c.fn.wcsatt_refresh_scheme_lengths=function(){var t=c(this),i=t.find(".wc_input_subscription_length"),n=t.find(".wc_input_subscription_period"),t=t.find(".wc_input_subscription_period_interval"),e=i.val(),s=parseInt(t.val(),10),a=!1;i.empty(),c.each(wcsatt_admin_params.subscription_lengths[n.val()],function(t,n){0!=parseInt(t,10)&&0!=parseInt(t,10)%s||i.append(c("<option></option>").attr("value",t).text(n))}),i.children("option").each(function(){if(this.value==e)return!(a=!0)}),a?i.val(e):i.val(0)},""===wcsatt_admin_params.post_id&&(i.on("click","h3",function(){var t=c(this).closest(".wc-metabox"),n=t.find(".wc-metabox-content");t.hasClass("closed")?n.show():n.hide(),t.toggleClass("closed")}),i.find(".wc-metabox").each(function(){var t=c(this),n=t.find(".wc-metabox-content");t.hasClass("closed")&&n.hide()})),c.fn.wcsatt_refresh_sync_options=function(){var t=c(this),n=t.find(".wc_input_subscription_period"),t=t.find(".subscription_sync"),i=t.find(".subscription_sync_annual"),e=t.find(".subscription_sync_week_month"),s=e.find("select"),a=i.find("select"),n=n.val();"day"===n?(t.hide(),s.val(0),a.val(0).trigger("change")):(t.show(),"year"===n?(e.hide(),s.val(0),i.show()):(i.hide(),a.val(0).trigger("change"),s.empty(),c.each(WCSubscriptions.syncOptions[n],function(t,n){t||(n=wcsatt_admin_params.i18n_do_no_sync),s.append(c("<option></option>").attr("value",t).text(n))}),e.show()))},(n=a.find("li")).on("click",function(){if(a.hasClass("disabled"))return!1;var t=c(this);t.find("input").prop("checked",!0),n.removeClass("selected"),t.addClass("selected")}),s.on("change",function(){m()}),"yes"===wcsatt_admin_params.is_onboarding&&setTimeout(function(){c(".satt_options a").trigger("click")},500),c("select#product-type").on("change",function(){0<r.length&&r.wcsatt_init_type_dependent_inputs(),h(),l(),u()}).trigger("change"),c("input#_virtual").on("change",function(){u()}).trigger("change"),i.on("woocommerce_subscription_schemes_changed",function(){r=_.find(".subscription_scheme"),f(),h(),l(),u()}),_.on("change","select.subscription_pricing_method_input",function(){var t=c(this),n=t.closest(".subscription_scheme_product_data"),t=t.val();n.find(".subscription_pricing_method").hide(),n.find(".subscription_pricing_method_"+t).show()}).on("change",".wc_input_subscription_period",function(){var t=c(this).closest(".subscription_scheme");t.wcsatt_refresh_scheme_lengths(),t.wcsatt_refresh_sync_options()}).on("change",".wc_input_subscription_payment_sync_date_month",function(){c(this).closest(".subscription_scheme").wcsatt_refresh_days_in_month()}),i.on("click","span.scheme-remove",function(){var t=c(this).closest(".subscription_scheme");return t.find("*").off(),t.remove(),i.trigger("woocommerce_subscription_schemes_changed"),!1}).on("click",".remove_all",function(){return i.hasClass("no_plans")||(r.each(function(t,n){n=c(n);n.find("*").off(),n.remove()}),i.trigger("woocommerce_subscription_schemes_changed")),!1}).on("click","button.add_subscription_scheme",function(){i.block(d),p++;var t={action:"wcsatt_add_subscription_scheme",post_id:wcsatt_admin_params.post_id,index:p,security:wcsatt_admin_params.add_subscription_scheme_nonce};return c.post(wcsatt_admin_params.wc_ajax_url,t,function(t){_.append(t.markup);var n=_.find(".subscription_scheme").last();n.wcsatt_init_type_dependent_inputs(),n.wcsatt_init_help_tips(),n.find("select.subscription_pricing_method_input").trigger("change"),i.unblock(),i.trigger("woocommerce_subscription_scheme_added",t),i.trigger("woocommerce_subscription_schemes_changed")},"json"),!1}),s.on("change",function(){c(this).is(":checked")?i.find(".wcsatt_default_status").show():i.find(".wcsatt_default_status").hide(),h()}).trigger("change"),t.on("change",function(){i.removeClass("status_inherit status_disable status_override").addClass("status_"+c(this).val())}),c("#_nyp").on("change",function(){c(this).is(":checked")?_.addClass("is_nyp"):_.removeClass("is_nyp")}).trigger("change"),_.find("select.subscription_pricing_method_input").trigger("change"),_.find('select.wc_input_subscription_payment_sync_date_month[value!="0"]').trigger("change"),(e=r.get()).sort(function(t,n){t=parseInt(c(t).attr("rel"),10),n=parseInt(c(n).attr("rel"),10);return t<n?-1:n<t?1:0}),c(e).each(function(t,n){_.append(n)}),_.sortable({items:".subscription_scheme",cursor:"move",axis:"y",handle:"span.scheme-handle",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(t,n){n.item.css("background-color","#f6f6f6")},stop:function(t,n){n.item.removeAttr("style"),f()}})});