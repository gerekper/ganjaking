!function(i,o,t,n){"use strict";var a,e,c,r,l;void 0!==n&&(a=o.Model.extend({url:t,getSyncData:function(){return{}},sync:function(t,e,i){var a=(i=i||{}).action||t,t=i.data||{};return i.data=this.getSyncData(t,a),i.emulateJSON=!0,o.sync.call(this,"create",e,i)}}).extend({defaults:function(){return{id:0,name:"",xmlFile:{},csvFile:{}}},getSyncData:function(t,e){return _.defaults({action:"wc_instagram_"+e,catalog_id:this.get("id")},t)},"delete":function(t){var e={action:"delete_product_catalog",data:{_wpnonce:n.nonce["delete"]}};this.destroy(_.extend({},e,t))},getFile:function(t){return this.get(t+"File")},setFile:function(t,e){return this.set(t+"File",_.extend({},this.getFile(t),e))},fileAction:function(t,i){var a=this;this.fetch({action:t+"_product_catalog_file",data:{format:i,_wpnonce:n.nonce.fileAction},wait:!0,success:function(t,e){e.success&&e.data.file&&a.setFile(i,e.data.file)}})}}),e=o.Collection.extend({model:a}),c=o.View.extend({events:{"click .wc-instagram-product-catalog-copy":"copyLink","aftercopy .wc-instagram-product-catalog-copy":"copyLinkTip","click .wc-instagram-product-catalog-delete":"delete","click .wc-instagram-product-catalog-download-xml":"exportXML","click .wc-instagram-product-catalog-download-csv":"exportCSV"},initialize:function(){this.listenTo(this.model,"destroy",this.remove)},copyLink:function(t){var e=i(t.target);t.preventDefault(),wcClearClipboard(),wcSetClipboard(e.attr("href"),e)},copyLinkTip:function(t){i(t.target).tipTip({attribute:"data-tip",activation:"focus",fadeIn:50,fadeOut:50,delay:0}).trigger("focus")},"delete":function(t){if(t.preventDefault(),!window.confirm(n.confirmDelete))return!1;this.model["delete"]({wait:!0})},exportXML:function(t){t.preventDefault(),new r({model:this.model,format:"xml"})},exportCSV:function(t){t.preventDefault(),new r({model:this.model,format:"csv"})}}),r=i.WCBackboneModal.View.extend({events:function(){return _.extend({},i.WCBackboneModal.View.prototype.events,{"click .request-update":"requestUpdate"})},initialize:function(t){var e=this;this.format=t.format,i.WCBackboneModal.View.prototype.initialize.apply(this,[{target:"wc-instagram-product-catalog-download",string:{format:this.format.toUpperCase(),catalog:this.model.toJSON(),file:this.getFile()}}]),this.listenTo(this.model,"change:"+this.format+"File",function(){e._string.file=e.model.getFile(e.format),e.render()})},render:function(){var t=this;this.$el.empty(),i.WCBackboneModal.View.prototype.render.apply(this),this._string.file.status&&setTimeout(function(){t.fetchFile()},5e3)},getFile:function(){var t=this.model.getFile(this.format);return _.isEmpty(t)&&this.model.fileAction("fetch",this.format),t},fetchFile:function(){this.model.fileAction("fetch",this.format)},requestUpdate:function(t){t.preventDefault(),this.model.setFile(this.format,{status:"requested"}),this.model.fileAction("generate",this.format)}}),l=o.View.extend({initialize:function(){var a=this;this.collection=new e([],{comparator:!1}),this.$el.find("tbody tr").each(function(t,e){var i=a.extractCatalogModel(e);a.collection.add(i),new c({el:e,model:i})}),i(document.body).trigger("init_tooltips")},extractCatalogModel:function(t){var e=i(t).find("td.title > a"),t=new URLSearchParams(e.prop("href"));return new a({id:t.get("catalog_id"),name:e.text()})}}),i(function(){new l({el:".product_catalogs"})}))}(jQuery,(wp,Backbone),ajaxurl,wc_instagram_product_catalogs_params);