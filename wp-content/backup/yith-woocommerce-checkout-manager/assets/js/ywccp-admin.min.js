jQuery(document).ready(function(c){"use strict";var e=c("#add-new"),i=c("#add-new-name"),d=c("#ywccp_field_add_edit_form"),n=c("#ywccp_checkout_fields"),a=function(i,e,t,n,d){if(i.attr("data-row",n),i.attr("data-action",t),!d){var a=i.find("tr.remove_default");a.length&&a.remove()}i.find('select[name^="field_type"]').on("change",function(){var e=i.find("tr[data-hide]"),t=c(this).val();e.length&&c.each(e,function(){var e=c(this).data("hide").split(",");-1<c.inArray(t,e)?c(this).hide():c(this).show()})}).trigger("change"),i.dialog({title:e,modal:!0,width:900,resizable:!1,autoOpen:!1,buttons:[{text:"Save",click:function(){c.edit_add_field(this)&&c(this).dialog("close")}}],close:function(e,t){i.dialog("destroy"),i.remove()}})},r=function(e){var t=n.data("prepend");return e=(e=Array.isArray(e)?e[0].value:e.trim()).replace(/\s/g,"_"),""!=t&&-1===e.indexOf(t)&&(e=t+e),e};i.on("focus",function(){c(this).removeClass("required field-exists")}),e.on("click",function(){var e=i.val();if(""==e)return i.addClass("required"),!1;if(e=r(e),n.find('input.field_name[value="'+e+'"]').length)return i.addClass("field-exists"),!1;var t=d.clone();a(t,ywccp_admin.popup_add_title,"add","",!0),t.find('input[name="field_name[]"]').val(e),t.dialog("open")}),c(document).on("click","button.edit_field",function(){var e=c(this).closest("tr"),t=e.data("row"),i=e.find('input[type="hidden"]'),s=d.clone(),n=e.find('input[type="hidden"][name="field_condition_input_name[]"]');s=l(n,s),c.each(i,function(e,t){var i=c(t).data("name"),n=s.find('td *[name="'+i+'[]"]');if(c(this).hasClass("condition"))for(var d=c(t).val().split("|"),a=d.length,o=0;o<a;o++)"checkbox"==(n=s.find('td *[name="'+i+'[]"]').eq(o)).attr("type")?f(n,d[o]):n.val(d[o]);else if("checkbox"==n.attr("type")){var l=c(t).val();f(n,l)}else n.val(c(t).val())}),a(s,ywccp_admin.popup_edit_title,"edit",t,e.hasClass("is_custom")),s.dialog("open")});var f=function(e,t){0==t?e.removeAttr("checked"):e.attr("checked","checked")};c.edit_add_field=function(l){var s,e,t=n.find("tbody tr"),i=c(l).data("action");if("edit"==i?(e=c(l).data("row"),s=t.filter('[data-row="'+e+'"]')):(s=t.filter(":not(.disabled-row)").last().clone(),e=t.size(),s.attr("data-row",e),s.addClass("is_custom")),c.each(s.find('input[type="hidden"]'),function(e,t){var i=c(t).data("name"),n=c(l).find('td *[name="'+i+'[]"]'),d="",a="";if(n.length){if("checkbox"==n.attr("type"))if(n.hasClass("condition-field"))for(var o=0;o<n.length;o++)a=a+(d=n[o].checked?1:0)+"|";else a=1==(d=n.is(":checked")?1:0)?ywccp_admin.enabled:"";else d=n.serializeArray(),a=("field_name"==i?r:u)(d);c(t).val(a),s.find(".td_"+i).html(a)}else c(t).hasClass("condition")&&c(t).val("")}),"add"==i&&(t.last().after(s),"undefined"!=typeof c.fn.tipTip)){s.find(".tips").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200})}return!0},c(".check-column input").on("change",function(){c(this);var e=c("td.td_select input");c(this).is(":checked")?e.attr("checked","checked"):e.removeAttr("checked")}),c(document).on("click","button.enable_field",function(){var e,t=c(this),i=t.closest("tr"),n=i.find('input[data-name="field_enabled"]');i.toggleClass("disabled-row"),n.length&&n.val(i.hasClass("disabled-row")?"0":"1"),e=t.html(),t.html(t.data("label")),t.data("label",e)});c(document).on("click","button.remove_field",function(){var e=c(this).closest("tr");e.hasClass("is_custom")&&e.fadeOut(400,function(){e.addClass("disabled-row").hide(),e.find('input[data-name="field_deleted"]').val("yes")})});var t=c(".ywccp_multiselect_admin"),o=c(".ywccp_datepicker_admin");t&&c.each(t,function(){var e=c(this),t=e.data("value").split(", ");e.after('<input type="hidden" name="'+e.attr("name")+'" value>'),e.on("change",function(){var e=c(this).val();e=e?e.join(", "):"",c(this).next().val(e)}),e.val(t).trigger("change"),"undefined"!=typeof c.fn.select2&&e.select2()}),"undefined"!=typeof c.fn.datepicker&&o&&c.each(o,function(){c(this).datepicker({dateFormat:c(this).data("format")||"dd-mm-yy"})}),c(document).on("click",".add-new",function(e){e.preventDefault();var t=c(this).closest(".single-condition"),i=jQuery(t).clone();i.find(".condition-field").val("").prop("disabled",!1).prop("checked",!1).removeClass("disabled"),t.after(i)}),c(document).on("click",".remove",function(e){e.preventDefault(),c(this).closest(".single-condition").remove()});var u=function(e){var t,i=e.length,n="";for(t=0;t<i;t++)0!=t&&(n+="|"),n+=e[t].value;return n},l=function(e,t){for(var i=e[0].value.split("|").length,n=t.find("table.wrap-conditions"),d=1;d<i;d++){t.find(".single-condition").eq(0).clone().appendTo(n)}return t};c(document).on("change","select.field_condition_input_name",function(e){"products"==c(this).val()?(c(this).closest(".single-condition").find("select.condition-type").find('option[value="is-set"]').attr("disabled","disabled"),c(this).closest(".single-condition").find("select.condition-type").find('option[value="is-empty"]').attr("disabled","disabled"),c(this).closest(".single-condition").find("select.condition-type").find('option[value="has-value"]').attr("disabled","disabled"),c(this).closest(".single-condition").find("select.condition-type").find('option[value="all-in-cart"]').removeAttr("disabled"),c(this).closest(".single-condition").find("select.condition-type").find('option[value="at-least-one-in-cart"]').removeAttr("disabled")):(c(this).closest(".single-condition").find("select.condition-type").find('option[value="is-set"]').removeAttr("disabled"),c(this).closest(".single-condition").find("select.condition-type").find('option[value="is-empty"]').removeAttr("disabled"),c(this).closest(".single-condition").find("select.condition-type").find('option[value="has-value"]').removeAttr("disabled"),c(this).closest(".single-condition").find("select.condition-type").find('option[value="all-in-cart"]').attr("disabled","disabled"),c(this).closest(".single-condition").find("select.condition-type").find('option[value="at-least-one-in-cart"]').attr("disabled","disabled"))}),c(document).on("change","select.condition-type",function(e){"is-set"==c(this).val()||"is-empty"==c(this).val()?c(this).closest(".single-condition").find("input.field_condition_value").addClass("disabled"):c(this).closest(".single-condition").find("input.field_condition_value").removeClass("disabled")})});